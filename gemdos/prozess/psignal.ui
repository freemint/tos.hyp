!iflang [english]

!begin_node Psignal
(!begin_liste) [Availability]
!item [Name:]
¯Psignal® - Art der Signalbehandlung ver„ndern.
!item [Opcode:]
274
!item [Syntax:]
int32_t Psignal ( int16_t sig, int32_t handler );

!item [Description:]
Die Funktion „ndert die Art und Weise, wie auf das Signal (!I)sig(!i)
reagiert werden soll. Der Parameter (!I)handler(!i) kann 3 verschiedene
Werte annehmen:
!begin_xlist !short [handler]
!item [handler]
Bedeutung
!item [~]
~
!item [0]
Das Signal wird mit der Default-Aktion beantwortet.
!item [1]
Das Signal wird ignoriert. Liegt es gerade an, so wird es gel”scht.
!end_xlist
Jeder andere Wert wird als die Adresse einer Benutzerfunktion interpretiert,
die beim Auftreten des Signals (!I)sig(!i) aufgerufen wird. Dieser Funktion
wird (ber den Stack) ein Long-Wert bergeben, welcher der Signalnummer
entspricht. Auf diese Art ist es m”glich, den Signal-Handler fr mehrere
Signale zu benutzen.

Solange ein Signal bearbeitet wird, kann es nicht erneut gesendet werden. Zu
beachten ist ferner, da (im Gegensatz zu einigen Unix-Versionen) das
Signal-Handling vor der Ausfhrung des Handlers nicht auf den
Default-Handler zurckgesetzt wird.

Der Signalhandler mu entweder mit RTS (Return to Sender) beendet werden,
oder Psigreturn aufrufen, um anzuzeigen, da die Signalbehandlung
abgeschlossen ist. Anschlieend wird die Blockierung des Signals aufgehoben.
(!nolink [Psigreturn]) fhrt zus„tzlich einige interne S„uberungen des Kernels durch,
die notwendig sind, falls der Signal-Handler nicht beendet wird (longjump).

Signalhandler k”nnen beliebige BIOS, XBIOS und GEMDOS Aufrufe machen. AES-
oder VDI-Aufrufe sind hingegen nicht gestattet.  Dies gilt jedoch nicht in
MagiC; hier gibt es einige Unterschiede zu beachten.

Ein Aufruf von Psignal hat den Nebeneffekt, da das Signal demaskiert (d.h.
freigegeben) wird. So kann ein Prozess beim Abarbeiten eines Signals dieses
zurcksetzen und es sich erneut zusenden, um sich beispielsweise selbst zu
suspendieren, w„hrend ein Signal fr Job-Control bearbeitet wird. Die
Signalbearbeitung ist gegenber Pfork/Pvfork abgesichert.

Signale, die von einem Prozess ignoriert werden, werden auch vom Child nach
einem Pexec-Aufruf ignoriert. Auerdem werden Signale, die von einem
Signal-Handler abgefangen werden, im Child-Prozess auf den Defaultwert
zurckgesetzt.

!item [(!nolink [Return]) Value:]
Die Funktion liefert den alten Wert des Signal-Handlers zurck. Dies ist
entweder 0, 1 oder die Adresse des Handlers.

Im Fehlerfall werden folgende Werte zurckgeliefert:
!begin_xlist !short [ERANGE:]
!item [EACCDN:]
das Signal kann nicht abgefangen werden.
!item [ERANGE:]
(!I)sig(!i) ist kein gltiges Signal.
!end_xlist

!item [Availability:]
This function is available under all MiNT versions integrated with MultiTOS
and (!nolink [MagiC]) since Version 4.50

!item [Group:]
Process Functions

!item [See Also:] (!link [Binding] [Bindings for Psignal]) ~ Pkill  ~
          Psigaction ~  Psigblock ~  Psigreturn ~ Signale
(!ende_liste)


!begin_node Bindings for Psignal
!ignore_index
(!begin_liste) [Assembler:]
!item [C:]
int32_t Psignal ( int16_t sig, int32_t handler );
!item [Assembler:]
!begin_verbatim
move.l    handler,-(sp)  ; Offset 4
move.w    sig,-(sp)      ; Offset 2
move.w    #274,-(sp)     ; Offset 0
trap      #1             ; GEMDOS
addq.l    #8,sp          ; correct stack
!end_verbatim
!ifdest [html]
!item [GFA-Basic]
!begin_raw
<A HREF="http://www.milanstation.de/at/gfahutil/gfau7gd.htm">GFA-H-Util GEMDOS</A>
!end_raw
!endif
(!ende_liste)
!end_node
!end_node

!else

!begin_node Psignal
(!begin_liste) [Beschreibung]
!item [Name:]
¯Psignal® - Art der Signalbehandlung ver„ndern.
!item [Gemdosnummer:]
274
!item [Deklaration:]
int32_t Psignal ( int16_t sig, int32_t handler );

!item [Beschreibung:]
Die Funktion „ndert die Art und Weise, wie auf das Signal (!I)sig(!i)
reagiert werden soll. Der Parameter (!I)handler(!i) kann 3 verschiedene
Werte annehmen:
!begin_xlist !short [handler]
!item [handler]
Bedeutung
!item [~]
~
!item [0]
Das Signal wird mit der Default-Aktion beantwortet.
!item [1]
Das Signal wird ignoriert. Liegt es gerade an, so wird es gel”scht.
!end_xlist
Jeder andere Wert wird als die Adresse einer Benutzerfunktion interpretiert,
die beim Auftreten des Signals (!I)sig(!i) aufgerufen wird. Dieser Funktion
wird (ber den Stack) ein Long-Wert bergeben, welcher der Signalnummer
entspricht. Auf diese Art ist es m”glich, den Signal-Handler fr mehrere
Signale zu benutzen.

Solange ein Signal bearbeitet wird, kann es nicht erneut gesendet werden. Zu
beachten ist ferner, da (im Gegensatz zu einigen Unix-Versionen) das
Signal-Handling vor der Ausfhrung des Handlers nicht auf den
Default-Handler zurckgesetzt wird.

Der Signalhandler mu entweder mit RTS (Return to Sender) beendet werden,
oder Psigreturn aufrufen, um anzuzeigen, da die Signalbehandlung
abgeschlossen ist. Anschlieend wird die Blockierung des Signals aufgehoben.
(!nolink [Psigreturn]) fhrt zus„tzlich einige interne S„uberungen des Kernels durch,
die notwendig sind, falls der Signal-Handler nicht beendet wird (longjump).

Signalhandler k”nnen beliebige BIOS, XBIOS und GEMDOS Aufrufe machen. AES-
oder VDI-Aufrufe sind hingegen nicht gestattet.  Dies gilt jedoch nicht in
MagiC; hier gibt es einige Unterschiede zu beachten.

Ein Aufruf von Psignal hat den Nebeneffekt, da das Signal demaskiert (d.h.
freigegeben) wird. So kann ein Prozess beim Abarbeiten eines Signals dieses
zurcksetzen und es sich erneut zusenden, um sich beispielsweise selbst zu
suspendieren, w„hrend ein Signal fr Job-Control bearbeitet wird. Die
Signalbearbeitung ist gegenber Pfork/Pvfork abgesichert.

Signale, die von einem Prozess ignoriert werden, werden auch vom Child nach
einem Pexec-Aufruf ignoriert. Auerdem werden Signale, die von einem
Signal-Handler abgefangen werden, im Child-Prozess auf den Defaultwert
zurckgesetzt.

!item [Ergebnis:]
Die Funktion liefert den alten Wert des Signal-Handlers zurck. Dies ist
entweder 0, 1 oder die Adresse des Handlers.

Im Fehlerfall werden folgende Werte zurckgeliefert:
!begin_xlist !short [ERANGE:]
!item [EACCDN:]
das Signal kann nicht abgefangen werden.
!item [ERANGE:]
(!I)sig(!i) ist kein gltiges Signal.
!end_xlist

!item [Verfgbar:]
This function is available under all MiNT versions integrated with MultiTOS
and (!nolink [MagiC]) since Version 4.50

!item [Gruppe:]
Prozessfunktionen

!item [Querverweis:] (!link [Binding] [Bindings fr Psignal]) ~ Pkill  ~
					Psigaction ~  Psigblock ~  Psigreturn ~ Signale
(!ende_liste)


!begin_node Bindings fr Psignal
!ignore_index
(!begin_liste) [Assembler:]
!item [C:]
int32_t Psignal ( int16_t sig, int32_t handler );
!item [Assembler:]
!begin_verbatim
move.l    handler,-(sp)  ; Offset 4
move.w    sig,-(sp)      ; Offset 2
move.w    #274,-(sp)     ; Offset 0
trap      #1             ; GEMDOS aufrufen
addq.l    #8,sp          ; Stack korrigieren
!end_verbatim
!ifdest [html]
!item [GFA-Basic]
!begin_raw
<A HREF="http://www.milanstation.de/at/gfahutil/gfau7gd.htm">GFA-H-Util GEMDOS</A>
!end_raw
!endif
(!ende_liste)
!end_node
!end_node

!endif
