<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 02.08.2025 -->
<html lang="de">
<head>
<title>
Die Anleitung zum TOS: Memory-Control-Block (MCB) in MagiC
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="de">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="typedefs.html"><img src="udo_up.gif" alt="Typdefinitionen" title="Typdefinitionen" border="0" width="24" height="24">Typdefinitionen</a>
<a name="UDO_nav_lf_HEAD" href="MacVersion.html"><img src="udo_lf.gif" alt="MacVersion" title="MacVersion" border="0" width="24" height="24">MacVersion</a>
<a name="UDO_nav_rg_HEAD" href="MD.html"><img src="udo_rg.gif" alt="Memory-Deskriptor (MD) in TOS" title="Memory-Deskriptor (MD) in TOS" border="0" width="24" height="24">Memory-Deskriptor (MD) in TOS</a>

<hr>

<h1><a name="Memory-Control-Block_20_28MCB_29_20in_20MagiC">I.10 Memory-Control-Block (MCB) in MagiC</a></h1>
<a name="Speicherverwaltung_20in_20MagiC"></a>
<a name="MagiC_2C_20Speicherverwaltung_20in"></a>
<a name="MCB"></a>
<pre>typedef struct
{
    int32_t mcb_magic;        /* 'ANDR' oder 'KROM' (letzter)    */
    int32_t mcb_len;          /* Nettolänge                      */
    int32_t mcb_owner;        /* Zeiger auf <a href="gemdos_structures.html#PD">PD</a>-Struktur          */
    int32_t mcb_prev;         /* vorh. Block oder NULL           */
    int8_t mcb_data[0];
} MCB;
</pre>
<p><b>Hinweis:</b> Die Komponente <i>mcb_magic</i> besitzt den
Wert 'KROM', falls kein weiterer MCB folgt, und anderenfalls den Wert
'ANDR'. Im letzteren Fall liegt der nächste MCB <i>mcb_len</i> Bytes
hinter dem aktuellen MCB. Die Liste ist per <i>mcb_prev</i>
rückwärts verkettet, was viele Operationen erheblich beschleunigt.
</p>
<a name="core_20dump"></a>
<a name="Systemauszug_20_28core_20dump_29"></a>
<a name="core_20dump_2C_20Name_20f_C3_BCr"></a>
<p>Bei allen Speicheroperationen wird immer die Komponente
<i>mcb_magic</i> überprüft, und das System bei einem Fehler sofort
angehalten. Beim Anhalten aufgrund eines Speicherfehlers werden die
Adresse des fehlerhaften MCB sowie die Daten (4 Langworte) ausgegeben.
Anschließend wird man gefragt, auf welches Laufwerk man einen
<b>Systemauszug (core dump)</b> speichern möchte. Gibt man ein
gültiges Laufwerk an, so wird der gesamte ST-Speicher von 0 bis
<a href="bios_sysvars.html#phystop">phystop</a> auf das Wurzelverzeichnis des angegebenen Laufwerks
geschrieben, und zwar unter dem Namen &quot;_sys_&quot;. Die Datei
kann natürlich je nach ST-Modell bis zu 4 oder gar 16 MB lang werden.
</p>
<p>Speicherresidente Programme (beenden sich über <a href="gemdos_process.html#Ptermres">Ptermres</a>)
arbeiten jetzt im Gegensatz zu früher einfach nur so, daß die
Blöcke <i>nicht</i> freigegeben werden, alle MCBs bleiben intakt und
werden auch weiterhin benutzt (jedesmal, wenn man in die Menüleiste
klickt, wird der freie Speicher ausgegeben, dazu wird die gesamte
Liste einmal durchlaufen und dabei alle MCBs überprüft). Wer
möchte, kann also speicherresidente Programme (oder auch Teile davon)
nachträglich freigeben.
</p>
<p>Querverweis: <a href="gemdos_main.html">GEMDOS</a> &nbsp; <a href="magic.html">MagiC</a> &nbsp; <a href="MD.html">MD</a> &nbsp; <a href="gemdos_memory.html">Speicherverwaltung</a>
</p>
<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="typedefs.html"><img src="udo_up.gif" alt="Typdefinitionen" title="Typdefinitionen" border="0" width="24" height="24">Typdefinitionen</a>
<a name="UDO_nav_lf_FOOT" href="MacVersion.html"><img src="udo_lf.gif" alt="MacVersion" title="MacVersion" border="0" width="24" height="24">MacVersion</a>
<a name="UDO_nav_rg_FOOT" href="MD.html"><img src="udo_rg.gif" alt="Memory-Deskriptor (MD) in TOS" title="Memory-Deskriptor (MD) in TOS" border="0" width="24" height="24">Memory-Deskriptor (MD) in TOS</a>
</body>
</html>
