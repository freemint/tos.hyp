<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 02.08.2025 -->
<html lang="de">
<head>
<title>
Die Anleitung zum TOS: BIOS Strukturen
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="de">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="bios_main.html"><img src="udo_up.gif" alt="BIOS" title="BIOS" border="0" width="24" height="24">BIOS</a>
<a name="UDO_nav_lf_HEAD" href="bios_functions.html"><img src="udo_lf.gif" alt="BIOS-Funktionsliste" title="BIOS-Funktionsliste" border="0" width="24" height="24">BIOS-Funktionsliste</a>
<a name="UDO_nav_rg_HEAD" href="xbios_main.html"><img src="udo_rg.gif" alt="XBIOS" title="XBIOS" border="0" width="24" height="24">XBIOS</a>

<hr>

<h1><a name="BIOS_20Strukturen">3.12 BIOS Strukturen</a></h1>
<ul class="content">
	<li> 3.12.1 <a href="#BPB">BPB</a>
	<li> 3.12.2 <a href="#MD">MD</a>
	<li> 3.12.3 <a href="#MPB">MPB</a>
	<li> 3.12.4 <a href="#patternrectdata">patternrectdata</a>
	<li> 3.12.5 <a href="#PUN_INFO">PUN_INFO</a>
	<li> 3.12.6 <a href="#solidrectdata">solidrectdata</a>
	</li>
</ul>
<br>
<h3><a name="BPB">3.12.1 BPB</a></h3>
<pre>typedef struct
{
  WORD   recsiz;       /* Bytes pro Sektor                    */
  WORD   clsiz;        /* Sektoren pro Cluster                */
  WORD   clsizb;       /* Bytes pro Cluster                   */
  WORD   rdlen;        /* Verzeichnislänge                    */
  WORD   fsiz;         /* Länge der FAT in Sektoren           */
  WORD   fatrec;       /* Start der 2. FAT                    */
  WORD   datrec;       /* 1. freier Sektor                    */
  WORD   numcl;        /* Gesamtzahl an Cluster               */
  WORD   bflags;       /* Flags als Bitvektor                 */
                       /* Bit 0: 0 (12-Bit-FAT), 1 16-Bit-FAT */
                       /* Bit 1: 0 (zwei FATs), 1 (eine FAT)  */
                       /*        erst ab <a href="tos_main.html">TOS</a> 2.06 verfügbar   */
} BPB ;
</pre>
<p>Querverweis: <a href="About_the_BIOS.html#Getbpb">Getbpb</a>
</p>
<h3><a name="MD">3.12.2 MD</a></h3>
<pre>typedef struct
{
     MD *m_link;         /* next MD (or NULL)          */
     long m_start;       /* saddr of block             */
     long m_length;      /* # bytes in block           */
     <a href="gemdos_structures.html#PD">PD</a> *m_own;          /* owner's process descriptor */
} MD;

</pre>
<p>Querverweis: <a href="bios_main.html">BIOS</a> &nbsp; <a href="About_the_BIOS.html#Getmpb">Getmpb</a> &nbsp; <a href="#MPB">MPB</a>
</p>
<h3><a name="MPB">3.12.3 MPB</a></h3>
<pre>typedef struct
{
    <a href="#MD">MD</a> *mp_mfl;      /* Liste des freien Speicher   */
    <a href="#MD">MD</a> *mp_mal;      /* Liste des belegten Speicher */
    <a href="#MD">MD</a> *mp_rover;    /* verschiebbarer Zeiger       */
} MPB;

</pre>
<p>Querverweis: <a href="bios_main.html">BIOS</a> &nbsp; <a href="About_the_BIOS.html#Getmpb">Getmpb</a>
</p>
<h3><a name="patternrectdata">3.12.4 patternrectdata</a></h3>
<pre>struct patternrectdata
{
  int16_t x1, y1;
  int16_t x2, y2;
  int32_t fg_color;
  int32_t bg_color;
  int16_t mode;
  int32_t *pattern;
  int32_t *patternmask;
}
</pre>
<p>Querverweis: <a href="bios_cookiejar.html#Cookie_2C_20_VDI">_VDI</a>
</p>
<h3><a name="PUN_INFO">3.12.5 PUN_INFO</a></h3>
<p>Diese Struktur ist wie folgt definiert:
</p>
<pre>typedef struct
{
    WORD puns;               /* Anzahl der Geräte               */
    BYTE pun[16];            /* diverse Flags                   */
    LONG part_start[16];     /* Partitionsanfänge               */
    LONG P_cookie;           /* muss &quot;AHDI&quot; sein                */
    LONG *P_cookptr;         /* zeigt auf das vorherige Element */
    UWORD P_version;         /* Versionsnummer (&gt;= 0x0300)      */
    UWORD P_max_sector;      /* maximale Sektorgröße            */
    LONG  reserved[16];      /* reserviert                      */
} PUN_INFO;
</pre>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">puns</td>
<td valign="top"> Enthält die Anzahl vom Hard-Disk-Treiber gefundenen
Festplatten. Mit zwei Dummyeinträgen (0xFF) für die Laufwerke A und
B.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">pun</td>
<td valign="top">
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Bit 0..2:</td>
<td valign="top"> Gerätenummer der Festplatte.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 3:</td>
<td valign="top"> Bei gesetzem Bit handelt es sich um ein Gerät an der
SCSI-Schnittstelle (sonst: ACSI): Diese Bit ist zwar noch nicht
offiziell dokumentiert, kann aber wohl ohne Vorbehalt benutzt werden.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 4:</td>
<td valign="top"> Falcon IDE
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 5:</td>
<td valign="top"> USB
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 6:</td>
<td valign="top"> Wechselmedien
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 7:</td>
<td valign="top"> Wenn dieses Bit gesetzt ist, dann wird das <a href="bios_main.html">BIOS</a>-Gerät nicht
vom Plattentreiber verwaltet (gilt beispielsweise für die beiden
Diskettenlaufwerke auf den Gerätenummern 0 und 1)
<br>&nbsp;

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">part_start</td>
<td valign="top"> Enthält für jede (unterstützte) Gerätenummer die Nummer des
Startsektors auf der betreffenden Festplatte. Wieder mit zwei
Dummyeinträge (0L) für Laufwerk A und B.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">P_cookie</td>
<td valign="top"> Magic-Wert; immer &quot;AHDI&quot;
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">P_cookptr</td>
<td valign="top"> Sollte immer auf das vorherige Strukrurelement zeigen.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">P_version</td>
<td valign="top"> Versionsnummer z.B. 0x0300
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">P_max_sector</td>
<td valign="top"> Beschreibt die größte auftretbare Blockgröße für
<a href="bios_main.html">BIOS</a>-Sektoren.
<br>&nbsp;

</td></tr>
</table>

<p>Beispiel wie man die Adresse der Struktur bekommt:
</p>
<pre>PUN_INFO *GetPunPtr (void)
{
  PUN_INFO *P;
  int32_t oldstack;

  oldstack = <a href="gemdos_system.html#Super">Super</a> (0L);
  P = *((PUN_INFO **)(0x516L));
  <a href="gemdos_system.html#Super">Super</a> ((void *)oldstack);

  if (P)
    if (P-&gt;P_cookptr == &amp;(P-&gt;P_cookie)) /* Cookie ok? */
      if (P-&gt;P_version &gt;= 0x300)
        return P;

  return 0L;
}
</pre>
<p>Querverweis: <a href="xhdi.html#XHDI">XHDI-Spezifikation</a> &nbsp; <a href="bios_sysvars.html#pun_ptr">pun_ptr</a>
</p>
<h3><a name="solidrectdata">3.12.6 solidrectdata</a></h3>
<pre>struct solidrectdata
{
  int16_t x1, y1;
  int16_t x2, y2;
  int32_t fg_color;
  int32_t bg_color;
  int16_t mode;
}
</pre>
<p>Querverweis: <a href="bios_cookiejar.html#Cookie_2C_20_VDI">_VDI</a>
</p>
<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="bios_main.html"><img src="udo_up.gif" alt="BIOS" title="BIOS" border="0" width="24" height="24">BIOS</a>
<a name="UDO_nav_lf_FOOT" href="bios_functions.html"><img src="udo_lf.gif" alt="BIOS-Funktionsliste" title="BIOS-Funktionsliste" border="0" width="24" height="24">BIOS-Funktionsliste</a>
<a name="UDO_nav_rg_FOOT" href="xbios_main.html"><img src="udo_rg.gif" alt="XBIOS" title="XBIOS" border="0" width="24" height="24">XBIOS</a>
</body>
</html>
