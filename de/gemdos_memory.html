<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 02.08.2025 -->
<html lang="de">
<head>
<title>
Die Anleitung zum TOS: Speicherverwaltung
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="de">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="gemdos_main.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24">GEMDOS</a>
<a name="UDO_nav_lf_HEAD" href="gemdos_process.html"><img src="udo_lf.gif" alt="Prozessfunktionen" title="Prozessfunktionen" border="0" width="24" height="24">Prozessfunktionen</a>
<a name="UDO_nav_rg_HEAD" href="gemdos_network.html"><img src="udo_rg.gif" alt="Netzwerkfunktionen" title="Netzwerkfunktionen" border="0" width="24" height="24">Netzwerkfunktionen</a>

<hr>

<h1><a name="Speicherverwaltung">5.12 Speicherverwaltung</a></h1>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Maccess">Maccess</a>&nbsp;&nbsp;</td>
<td valign="top"> Speicherbereich auf Zugriff prüfen.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Maddalt">Maddalt</a>&nbsp;&nbsp;</td>
<td valign="top"> Alternativen Speicher anmelden.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Malloc">Malloc</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Speicher reservieren bzw. freien Speicher erfragen.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Mfree">Mfree</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Speicherbereich freigeben.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Mshrink">Mshrink</a>&nbsp;&nbsp;</td>
<td valign="top"> Speicherbereich verkleinern/vergrößern.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Mvalidate">Mvalidate</a></td>
<td valign="top"> Prozess-Speicherbereich auf Zugriff prüfen.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Mxalloc">Mxalloc</a>&nbsp;&nbsp;</td>
<td valign="top"> Speicherbereich reservieren.

</td></tr>
</table>

<p><b>Achtung:</b> An dieser Stelle sei darauf hingewiesen, daß
im Hinblick auf zukünftige Betriebssystem-Versionen zur Kommunikation
zwischen verschiedenen Programmen benutzte oder über Zeiger
zugewiesene Speicherbereiche <i>global</i> sein müssen
(<a href="#Mxalloc">Mxalloc</a>-Funktion mit Global-Flag). Andernfalls wird es beim Einsatz
auf Rechnern mit PMMU (z.B. Atari-TT oder Falcon) zu
Speicherschutzverletzungen kommen.
</p>
<p>Querverweis: <a href="gemdos_tpa.html">Programmstart und TPA</a> &nbsp; <a href="gemdos_process.html">Prozessfunktionen</a> &nbsp;
<a href="MD.html#Speicherverwaltung_20in_20TOS">Speicherverwaltung in TOS</a> &nbsp; <a href="magic_MCB.html#Speicherverwaltung_20in_20MagiC">Speicherverwaltung in MagiC</a>
</p>
<h3><a name="Maccess">5.12.1 Maccess</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> Maccess - verify accessibility of a region of memory
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 381 (0x17d)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Maccess ( void *start, int32_t size, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Maccess verifies accessibility for the calling process's memory
page(s) containing any part of the address range in the interval
[addr, addr+len-1].
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">start</td>
<td valign="top"> Start address of the memory block to be verified list
</td></tr>

<tr><td nowrap="nowrap" valign="top">size</td>
<td valign="top"> Length of the memory block
</td></tr>

<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top"> mode is either 1 to check for read access, or 0 to check for
read/write access.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="VT_52_terminal.html#Return">Return</a> value:</td>
<td valign="top"> The function returns the value 0 on success, else a negative
error code.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> This function is available as of FreeMiNT 1.15.12.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> Memory management
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Maccess">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Mvalidate">Mvalidate</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Maccess">5.12.1.1 Bindings for Maccess</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Maccess">Maccess</a> ( void *start, int32_t size, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    mode,-(sp)   ; Offset 10
move.l    size,-(sp)   ; Offset 6
pea       start        ; Offset 2
move.w    #381,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $C(sp),sp    ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Maddalt">5.12.2 Maddalt</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Inform Gemdos of alternative memory« - Alternativen Speicher
anmelden.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top"> 20
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top"> int32_t Maddalt ( void *start, int32_t size );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top"> Die <a href="gemdos_main.html">GEMDOS</a>-Routine Maddalt erlaubt es, einen Block von
Alternate-RAM in die Speicherliste des GEMDOS aufzunehmen. Es gilt:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Bedeutung
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">start</td>
<td valign="top"> Anfangsadresse des Speichers
</td></tr>

<tr><td nowrap="nowrap" valign="top">size</td>
<td valign="top"> Länge des Speicherbereichs

</td></tr>
</table>

<br><b>Hinweis:</b> Der Block bleibt Eigentum von DOS und darf
nicht zurückgefordert werden. Wenn hinzugefügte Blöcke nicht
hintereinander liegen, ist die Anzahl der hinzufügbaren Blöcke auf
ca. 12 beschränkt.
<br>&nbsp;
<br>Nützlich könnte diese Funktion etwa beim Einsatz von
VME-Bus-Karten im Atari-TT sein, wenn deren Speicher für GEMDOS
zugänglich gemacht werden soll.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top"> Die Funktion liefert den Wert 0, oder eine negative
Fehlermeldung.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top"> Die Funktion ist erst ab GEMDOS 0.19 verfügbar.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"> <a href="#Speicherverwaltung">Speicherverwaltung</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"> <a href="#Bindings_20f_C3_BCr_20Maddalt">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Maddalt">5.12.2.1 Bindings für Maddalt</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Maddalt">Maddalt</a> ( void *start, int32_t size );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    size,-(sp)   ; Offset 6
pea       start        ; Offset 2
move.w    #20,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a> aufrufen
lea       $A(sp),sp    ; Stack korrigieren
</pre>

</td></tr>
</table>

<h3><a name="Malloc">5.12.3 Malloc</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »memory allocation« - Speicherplatz reservieren.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top"> 72
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top"> void *Malloc ( int32_t number );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top"> Die <a href="gemdos_main.html">GEMDOS</a>-Routine Malloc reserviert Speicherplatz, oder
berechnet die Größe des verfügbaren Speichers. Für den Parameter
<i>number</i> gilt:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Wert</td>
<td valign="top"> Bedeutung
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">-1</td>
<td valign="top"> Länge des größten verfügbaren Blocks ermitteln
</td></tr>

<tr><td nowrap="nowrap" valign="top">sonst</td>
<td valign="top"> Anzahl der zu reservierenden Bytes

</td></tr>
</table>

<br><b>Hinweis:</b> Man darf sich nie darauf verlassen, daß
tatsächlich so viele Bytes wie gewünscht alloziert wurden.
Konstruktionen der Art Malloc(Malloc(-1L)) sind besonders in
Multitasking-Systemen schlicht indiskutabel (Stichwort: Task-Wechsel).
<br>&nbsp;
<br>Unter <a href="tos_main.html">TOS</a> untersützt das <a href="gemdos_main.html">GEMDOS</a> nur eine begrenzte Anzahl von
Speicherblöcke. Aus diesem Grund sollte man die Funktion nicht zu
häüfig innerhalb eines Programms nutzen, sondern größere
Speicherblöcke (mindestens 16KBytes) reservieren und selbst
verwalten.
<br>&nbsp;
<br><b>Ferner sollte man folgende Punkte beachten:</b>
<br>&nbsp;
<ul>
<li><p> der Speicherblock muß nicht leer sein
<br>&nbsp;
</p></li>
<li><p> nacheinander allozierte Speicherblöcke müssen nicht zwingend
zusammenhängen
<br>&nbsp;
</p></li>
<li><p> niemals auf Speicherbereiche zugreifen, der nicht dem eigenen
Prozess gehört. In Systemen mit Speicherschutz kommt es sonst zu
einer Exception.
<br>&nbsp;
</p></li>
</ul>

<br>In <a href="magic.html">MagiC</a> wird dieser Aufruf auf <a href="#Mxalloc">Mxalloc</a> mit den Modi 0 bzw. 3
zurückgeführt (abhängig von den Konfigurationsbits im
Programmdatei-Header). Die Konfigurationsbits werden z.Zt. in der
Basepage abgelegt.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top"> Die Funktion liefert als Ergebnis die Anfangsadresse des
reservierten Bereichs. Ein Nullzeiger bedeutet, daß nicht mehr
genügend Speicher zur Verfügung steht. Im Fall <i>number</i> = -1
wird die Länge des größten verfügbaren Speicherblocks
zurückgegeben.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top"> Alle <a href="gemdos_main.html">GEMDOS</a> Versionen. GEMDOS Versionen kleiner 0.15 liefern
für den Aufruf Malloc( 0L ) einen Zeiger auf ungültigen Speicher
statt daß der Aufruf fehlschlägt wie er sollte.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"> <a href="#Speicherverwaltung">Speicherverwaltung</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"> <a href="#Bindings_20f_C3_BCr_20Malloc">Bindings für Malloc</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Maddalt">Maddalt</a> &nbsp; <a href="gemdos_programs.html#Die_20Programmflags">Programmflags</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Malloc">5.12.3.1 Bindings für Malloc</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void *<a href="#Malloc">Malloc</a> ( int32_t number );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    number,-(sp) ; Offset 2
move.w    #72,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a> aufrufen
addq.l    #6,sp        ; Stack korrigieren
</pre>

</td></tr>
</table>

<h3><a name="Mfree">5.12.4 Mfree</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »memory free« - Speicherplatz freigeben.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top"> 73
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top"> int32_t Mfree ( void *block );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top"> Die <a href="gemdos_main.html">GEMDOS</a>-Routine Mfree gibt einen mit <a href="#Malloc">Malloc</a> reservierten
Speicherbereich wieder frei.
<br>&nbsp;
<br>Der Parameter <i>block</i> enthält die Anfangsadresse des
freizugebenden Speicherbereichs.
<br>&nbsp;
<br><b>Hinweis:</b> In fast allen GEMDOS-Versionen wird nicht
überprüft, ob der freizugebende Block dem betreffenden Prozess auch
gehört. Daher ist vor allem in Multitasking-Systemen besondere
Vorsicht angebracht.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top"> Die Funktion liefert folgende Resultate:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Wert</td>
<td valign="top"> Bedeutung
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a></td>
<td valign="top"> kein Fehler aufgetreten
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EIMBA">EIMBA</a></td>
<td valign="top"> falsche Speicherblockadresse

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top"> Alle GEMDOS Versionen.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"> <a href="#Speicherverwaltung">Speicherverwaltung</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"> <a href="#Bindings_20f_C3_BCr_20Mfree">Binding</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Maddalt">Maddalt</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Mfree">5.12.4.1 Bindings für Mfree</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Mfree">Mfree</a> ( void *block );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       block        ; Offset 2
move.w    #73,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a> aufrufen
addq.l    #6,sp        ; Stack korrigieren
</pre>

</td></tr>
</table>

<h3><a name="Mshrink">5.12.5 Mshrink</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »memory shrink« - Speicherbereich verkürzen oder
vergrößern.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top"> 74
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top"> int32_t Mshrink ( void *block, int32_t newsiz );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top"> Die <a href="gemdos_main.html">GEMDOS</a>-Routine Mshrink verkürzt oder vergrößert einen
bereits reservierten Speicherbereich. Es gilt:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Bedeutung
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">block</td>
<td valign="top"> Anfangsadresse des Speicherblocks
</td></tr>

<tr><td nowrap="nowrap" valign="top">newsiz</td>
<td valign="top"> neue (geänderte) Länge des Blocks; <b>in MagiC
zusätzlich:</b>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">-1 =</td>
<td valign="top"> ermitteln der größtmöglichen Größe des Speicherblocks
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0 =</td>
<td valign="top"> Block freigeben

</td></tr>
</table>


</td></tr>
</table>

<br><b>Hinweis:</b> Es wird i.d.R. nicht überprüft, ob der
Speicherblock dem Aufrufer überhaupt gehört. Die Möglichkeit einen
Speicherblock zu <i>vergrößern</i>, steht z.Zt. nur in <a href="magic.html">MagiC</a> zur
Verfügung. Allerdings funktioniert dies nur, wenn über dem
betreffenden Block ein genügend großer freier Block vorhanden ist,
und die <a href="magic_programs.html#TOS-Kompatibilit_C3_A4t">TOS-Kompatibilität</a> deaktiviert wurde.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top"> Die Funktion liefert folgende Resultate:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a> :</td>
<td valign="top"> kein Fehler aufgetreten
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EIMBA">EIMBA</a> :</td>
<td valign="top"> falsche Blockadresse
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EGSBF">EGSBF</a> :</td>
<td valign="top"> Block würde vergrößert

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top"> Alle GEMDOS Versionen.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"> <a href="#Speicherverwaltung">Speicherverwaltung</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"> <a href="#Bindings_20f_C3_BCr_20Mshrink">Binding</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mfree">Mfree</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Mshrink">5.12.5.1 Bindings für Mshrink</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Mshrink">Mshrink</a> ( void *block, int32_t newsiz );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    newsiz,-(sp)  ; Offset 8
pea       block         ; Offset 4
move.w    #0,-(sp)      ; Offset 2
move.w    #74,-(sp)     ; Offset 0
trap      #1            ; <a href="gemdos_main.html">GEMDOS</a> aufrufen
lea       $C(sp),sp     ; Stack korrigieren
</pre>
<br><b>Hinweis:</b> Der Null-Parameter wird beim C-Binding
normalerweise automatisch hinzugefügt.
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Mvalidate">5.12.6 Mvalidate</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> Mvalidate - verify access to a process memory region
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 321 (0x141)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Mvalidate ( int16_t pid, void *start, int32_t size,
int32_t *flags );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Mvalidate verifies accessibility for the specified process's
memory page(s) containing any part of the address range in the
interval [addr, addr+len-1].
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">pid</td>
<td valign="top"> Process id of the process to check. May be 0 for the current
process.
</td></tr>

<tr><td nowrap="nowrap" valign="top">start</td>
<td valign="top"> Start address of the memory block to be verified.
</td></tr>

<tr><td nowrap="nowrap" valign="top">size</td>
<td valign="top"> Length of the memory block.
</td></tr>

<tr><td nowrap="nowrap" valign="top">flags</td>
<td valign="top"> Upon a successfull call, will contain the protection flags of
the specified memory region.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="VT_52_terminal.html#Return">Return</a> value:</td>
<td valign="top"> The function returns the value 0 on success, else a negative
error code.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> This function is available as of FreeMiNT 1.15.12.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> Memory management
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Mvalidate">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Maccess">Maccess</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Mvalidate">5.12.6.1 Bindings for Mvalidate</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Mvalidate">Mvalidate</a> ( int16_t pid, void *start, int32_t size,
int32_t *flags );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       flags        ; Offset 12
move.l    size,-(sp)   ; Offset 8
pea       start        ; Offset 4
move.w    pid,-(sp)    ; Offset 2
move.w    #321,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $10(sp),sp   ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Mxalloc">5.12.7 Mxalloc</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Allocate memory (with preference)« - Speicherplatz
reservieren.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top"> 68
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top"> void *Mxalloc ( int32_t amount, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top"> Die <a href="gemdos_main.html">GEMDOS</a>-Routine Mxalloc reserviert einen Speicherbereich der
Größe <i>amount</i>. Über die Bits des Parameters <i>mode</i>
kann die gewünschte Speicherart spezifiziert werden; es gilt:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Bits</td>
<td valign="top"> Bedeutung
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0-2</td>
<td valign="top"> <b>Behandlung des TT-RAMs</b>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top"> nur ST-RAM
</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top"> nur TT-RAM
</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top"> egal, ST-RAM bevorzugt
</td></tr>

<tr><td nowrap="nowrap" valign="top">3 =</td>
<td valign="top"> egal, TT-RAM bevorzugt

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top"> reserviert
</td></tr>

<tr><td nowrap="nowrap" valign="top">4-7</td>
<td valign="top"> <b>Speicherschutz-Modus</b>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top"> Abhängig von den Programmflags
</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top"> Privat
</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top"> Global
</td></tr>

<tr><td nowrap="nowrap" valign="top">3 =</td>
<td valign="top"> <a href="gemdos_system.html#Super">Super</a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">4 =</td>
<td valign="top"> nur lesbar

</td></tr>
</table>

<br>Alle anderen Werte sind undefiniert, und für zukünftige Zwecke
reserviert.
</td></tr>

<tr><td nowrap="nowrap" valign="top">14</td>
<td valign="top"> <b>No-<a href="c_task_royal.html#Free">Free</a>-Modus</b>
<br>Wenn dieses Bit gesetzt ist und der Besitzer dieses Speichers
terminiert, wird der Speicherbereich nicht freigegeben, sondern an das
Betriebssystem vererbt. Dieser Modus ist nur für das Betriebssystem
interessant, und steht normalen Anwenderprogrammen nicht zur
Verfügung.

</td></tr>
</table>

<br>Alle weiteren Bits sind für zukünftige Zwecke reserviert. Mit
dem Wert -1 für <i>amount</i> kann man die Länge des größten
zusammenhängend verfügbaren Speicherblocks (abhängig von
<i>mode</i>) erfragen.
<br>&nbsp;
<br>Unter <a href="magic.html">MagiC</a> werden alle Speicherallozierungen mitprotokolliert.
Wenn die mit LIMITMEM vorgegebene Beschränkung überschritten wird,
wird ein Nullzeiger zurückgegeben. Im Fall <i>amount</i> = -1 wird
das Minimum von freiem Speicher und noch nicht ausgeschöpfter
LIMITMEM-Beschränkung zurückgegeben. Ausnahmen sind Aufrufe des
Bildschirm-Managers (SCRENMGR), der die Menüs kontrolliert. Dadurch
wird sichergestellt, daß auch per LIMITMEM beschränkte Programme
keine Probleme mit dem Redraw bei Menüs haben.
<br>&nbsp;
<br><b>Hinweis:</b> Ein Problem besteht darin, festzustellen, wann
die erweiterten Modi (Bits 3 und folgende) benutzt werden dürfen.
Einige ältere Versionen des GEMDOS kommen nämlich nicht mit diesen
Modi zurecht, und sorgen z.T. für den Absturz der Applikation bzw.
des ganzen Systems. Aus diesem Grund testen viele Programmierer
explizit auf das Vorhandensein von MiNT/MultiTOS oder Versionen von
MagiC &gt;= 2.0. Alternativ kann auch die Funktion <a href="#Mxmask">Mxmask</a> benutzt
werden.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top"> Die Funktion liefert als Ergebnis die Anfangsadresse des
reservierten Bereichs als typenlosen Zeiger. Mxalloc liefert als
Ergebnis eine 0, wenn nicht mehr genügend Speicher vorhanden ist.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top"> Diese Funktion existiert erst ab GEMDOS-Version 0.19.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"> <a href="#Speicherverwaltung">Speicherverwaltung</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"> <a href="#Bindings_20f_C3_BCr_20Mxalloc">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Maddalt">Maddalt</a> &nbsp; <a href="gemdos_programs.html#Die_20Programmflags">Programmflags</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Mxalloc">5.12.7.1 Bindings für Mxalloc</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void *<a href="#Mxalloc">Mxalloc</a> ( int32_t amount, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    mode,-(sp)    ; Offset 6
move.l    amount,-(sp)  ; Offset 2
move.w    #68,-(sp)     ; Offset 0
trap      #1            ; <a href="gemdos_main.html">GEMDOS</a> aufrufen
addq.l    #8,sp         ; Stack korrigieren
</pre>

</td></tr>
</table>

<h4><a name="Mxmask">5.12.7.2 Mxmask</a></h4>
<pre>/*
   Mxmask() liefert eine Bitmaske mit der man das Moduswort eines
   <a href="#Mxalloc">Mxalloc</a>() Aufrufs maskieren sollte, falls man Protectionbits
   benutzen möchte. Dies ist notwendig, da <a href="#Mxalloc">Mxalloc</a>() bei der Angabe
   von Protectionbits leider in einigen <a href="gemdos_main.html">GEMDOS</a> Implementierungen
   fehlerhafte Resultate liefert, die in der Folge zum Absturz des
   Systems fuehren koennen. ((c) 1994 Martin Osieka)
   Anwendungsbeispiel:
   mxMask = Mxmask();
   p = mxMask ? <a href="#Mxalloc">Mxalloc</a>( size, 0x43 &amp; mxMask) : <a href="#Malloc">Malloc</a>( size); */

SHORT Mxmask (void)
{
    void *svStack;      /* Supervisor-Stack */
    int32_t sRAM, sRAMg;   /* ST-RAM          */
    int32_t aRAM, aRAMg;   /* Alternate RAM   */

    /*
    // Beispieltabelle moeglicher Werte:
    //           | newfashion  | oldfashion
    // sRAM aRAM | sRAMg aRAMg | sRAMg aRAMg
    //   1    0  |   1     0   |   1     1
    //   0    2  |   0     2   |   2     2
    //   1    2  |   1     2   |   3     3
    */

    svStack = (void *) <a href="gemdos_system.html#Super">Super</a>( 0);  /* unterbinde Taskwechsel */

    sRAM  = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 0);
    /* im Fehlerfall <a href="#Mxalloc">Mxalloc</a>( -1, 3) */
    sRAMg = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 0x40);
    aRAM  = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 1);
    /* im Fehlerfall <a href="#Mxalloc">Mxalloc</a>( -1, 3) */
    aRAMg = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 0x41);

    <a href="gemdos_system.html#Super">Super</a>( svStack);  /* erlaube Taskwechsel */

    if (sRAM == -32)
        return 0x0000;  /* <a href="#Mxalloc">Mxalloc</a>() ist nicht implementiert */

    else if ( ((sRAM + aRAM) == sRAMg) &amp;&amp; ((sRAM + aRAM) == aRAMg) )
        return 0x0003;  /* oldfashion <a href="#Mxalloc">Mxalloc</a>() */

    else
        return 0xFFFF;

} /* Mxmask */
</pre>
<p>Querverweis: <a href="gemdos_main.html">GEMDOS</a> &nbsp; <a href="#Speicherverwaltung">Speicherverwaltung</a>
</p>
<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="gemdos_main.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24">GEMDOS</a>
<a name="UDO_nav_lf_FOOT" href="gemdos_process.html"><img src="udo_lf.gif" alt="Prozessfunktionen" title="Prozessfunktionen" border="0" width="24" height="24">Prozessfunktionen</a>
<a name="UDO_nav_rg_FOOT" href="gemdos_network.html"><img src="udo_rg.gif" alt="Netzwerkfunktionen" title="Netzwerkfunktionen" border="0" width="24" height="24">Netzwerkfunktionen</a>
</body>
</html>
