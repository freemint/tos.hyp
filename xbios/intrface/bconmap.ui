!iflang [english]


!begin_node Bconmap
(!begin_liste) [Availability]

!item [Name:]
¯Select serial port® - w„hlt eine Default-Schnittstelle aus.

!item [Opcode:]
44

!item [Syntax:]
(!link [Bindings fr Bconmap] [Bindings fr Bconmap])

!item [Description:]
Die XBIOS-Routine Bconmap w„hlt eine der seriellen Schnittstellen fr die
Biosausgabe aus. Darber hinaus kann ein Zeiger auf die BCONMAP-Struktur
abgefragt werden, ber die man die maximale (!nolink [BIOS]) Ger„tenummer
abfragen und auerdem neue Ger„tetreiber installieren kann. (!I)devno(!i)
kann die folgenden Werte annehmen:
!begin_table [r|l]
devno !! Bedeutung
!hline
-402 !! device / RSVF-list remove (HSMODA)
-401 !! Eintrag anh„ngen  (HSMODA)
-400 !! ausgew„hlten Eintrag berschreiben (HSMODA)
-2 !! Zeiger auf (!nolink [BCONMAP])-Struktur liefern 
-1 !! nur aktuellen Kanal abfragen
0 !! Test, ob Bconmap vorhanden ist
6 !! ST-kompatibler RS232-Port
7 !! SCC Kanal B
8 !! TTMFP RS232-Port
9 !! SCC Kanal A
>10 !! eigene Treiber
!end_table
Die Funktion beeinflut sowohl die (!nolink [BIOS])-Vektortabelle in den
(!link [Systemvariablen][Die Systemvariablen]), als auch das Verhalten der
Funktionen (!nolink [Rsconf]) und (!nolink [Iorec]).

(!B)Hinweis:(!b) Laut Atari sollte man seine TOS-Version folgendermaen auf
das Vorhandensein von Bconmap testen:
!begin_verbatim
WORD has_bconmap ( VOID )
{
   return (0L == Bconmap (0));
}
!end_verbatim

(!B)HSMODA(!b) (!ln)
Diese Funktionen sind nur vorhanden falls Paket HSMODA installiert ist.

(!U)int32_t Bconmap((int16_t)-400, (int16_t)dev_nr, (int32_t)ptr_to_6_longs)(!u)(!nl)
Die Konstante MAPT_OVE wird als -400 definiert. Diese Funktion dient dem 
šberschreiben bereits existierender MAPTAB-Eintr„ge. dev_nr ist eine 
Ger„tenummer ab 6 aufw„rts, die in der MAPTAB bereits existieren muá, 
andernfalls wird der Fehlercode -15 EUNDEV zurckgegeben. ptr_to_6_longs 
zeigt auf eine Struktur, die einem MAPTAB-Eintrag entspricht. Diese 
Struktur wird auf den entsprechenden Platz in der MAPTAB kopiert. Ist das 
angesprochende Ger„t das aktuell per Bconmap fr AUX eingestellte, so 
werden die eben eingeh„ngten Routinen auch nach xco* und in die aktuellen 
rsconf und iorec-Zellen kopiert. Diese Funktion dient nur zum Einh„ngen 
MagiC-freundlicher Routinen. Als Erfolgsmeldung wird die Ger„tenummer 
zurckgegeben, auf die der Eintrag erfolgte, also dev_nr.

Um Ger„te auf den BIOS-Nummern zu installieren, die fest zu einem Computer 
geh”ren, ist immer MAPT_OVE zu benutzen. Fr den ST betrifft das z.B. #6, 
beim MegaSTE #6 bis #8 und beim TT #6 bis #9.

(!U)int32_t Bconmap((int16_t)-401, (int32_t)ptr_to_6_longs)(!u)(!nl)
Die Konstante MAPT_APP wird als -401 definiert. Diese Funktion dient dem 
Anfgen eines Kanals an die MAPTAB oder dem Beschreiben eines leeren 
Kanals. ptr_to_6_longs zeigt auf eine Struktur, die einem MAPTAB-Eintrag 
entspricht. Rckmeldung ist entweder die von dieser Funktion fr den 
Eintrag gew„hlte Kanalnummer, oder der Fehlercode -12 EGENRL, falls kein 
Platz fr eine MAPTAB-Vergr”áerung ist. Hier kann es nicht vorkommen, das 
die Vektoren sofort nach xco* bertragen werden, da ein bisher nicht 
vorhandener oder belegter Kanal nicht als AUX eingestellt sein kann.

MAPT_APP sucht sich den ersten freien Kanal hinter den fest zum Computer 
geh”renden BIOS-Nummern und kann deshalb nur zum Installieren zus„tzlicher 
Ger„te benutzt werden.

(!U)int32_t Bconmap((int16_t)-402, (int16_t) dev_nr, (int32_t)ptr_to_listentry)(!u)(!nl)
Die Konstante MAPT_DEL wird als -402 definiert. Diese Funktion dient zum 
L”schen eines Ger„tes aus der MAPTAB und zum Aush„ngen einer RSVF-Liste 
aus der RSVF-Verkettung.

dev_nr ist entweder die BIOS-Kanalnummer des aus der MAPTAB zu 
entfernenden Ger„tes oder -1 fr Nichtstun. Der entsprechende 
MAPTAB-Eintrag wird freigeben indem spezielle Dummy-Routinenzeiger 
eingetragen werden, die auf den Assemblerbefehl RTS zeigen. Der 
Iorec-Zeiger-Eintrag wird auf 0 gesetzt. Ist der gel”schte Kanal auch als 
BIOS-AUX-Device eingestellt gewesen, so wird BIOS-AUX auf Nummer 6 
umgestellt, auch wenn gerade Nummer 6 gel”scht wurde.

ptr_to_listentry ist entweder der Zeiger auf die auszuh„ngende RSVF-Liste 
oder 0 fr Nichtstun. Der Zeiger mu auf den Anfang einer Liste verweisen, 
die daraufhin komplett entfernt wird, auch wenn sie mehr als ein 
Schnittstellenobjekt und End- oder Verkettungsobjekt enth„lt.

Im Erfolgsfall gibt MAPT_DEL 1 zurck, im Fehlerfall -1.

# Quelle: Quelltexte des Pakets misc_def.s und drvintst.s, drvin.txt

!item [(!nolink [Return]) Value:]
(!nolink [Bconmap]) liefert die alte Einstellung. Falls (!I)devno(!i) gleich
-2 ist, liefert die Funktion einen Zeiger auf BCONMAP zurck.

!item [Group:]
Schnittstellenprogrammierung

!item [Availability:]
Diese Funktion ist nur vorhanden falls das Paket HSMODA installiert ist.

!item [See Also:]
(!link [Binding] [Bindings fr Bconmap]) ~ Bconout ~ Bconin ~ Bcostat ~
Bconstat ~ Iorec   ~  Rsconf

(!ende_liste)


!begin_node Bindings fr Bconmap
!ignore_index
(!begin_liste) [Assembler:]
!item [C:]
#include <tos.h>

int32_t Bconmap( int16_t devno );
!item [Assembler:]
!begin_verbatim
move.w    devno,-(sp)  ; Offset 2
move.w    #44,-(sp)    ; Offset 0
trap      #14          ; XBIOS aufrufen
addq.l    #4,sp        ; Stack korrigieren
!end_verbatim
!ifdest [html]
!item [GFA-Basic]
!begin_raw
<A HREF="http://www.milanstation.de/at/gfahutil/gfau7xbi.htm">GFA-H-Util XBios</A>
!end_raw
!endif
(!ende_liste)
!end_node
!end_node


!else


!begin_node Bconmap
(!begin_liste) [Beschreibung]

!item [Name:]
¯Select serial port® - w„hlt eine Default-Schnittstelle aus.

!item [Xbiosnummer:]
44

!item [Binding:]
(!link [Bindings fr Bconmap] [Bindings fr Bconmap])

!item [Beschreibung:]
Die XBIOS-Routine Bconmap w„hlt eine der seriellen Schnittstellen fr die
Biosausgabe aus. Darber hinaus kann ein Zeiger auf die BCONMAP-Struktur
abgefragt werden, ber die man die maximale (!nolink [BIOS]) Ger„tenummer
abfragen und auerdem neue Ger„tetreiber installieren kann. (!I)devno(!i)
kann die folgenden Werte annehmen:
!begin_table [r|l]
devno !! Bedeutung
!hline
-402 !! device / RSVF-list remove (HSMODA)
-401 !! Eintrag anh„ngen  (HSMODA)
-400 !! ausgew„hlten Eintrag berschreiben (HSMODA)
-2 !! Zeiger auf (!nolink [BCONMAP])-Struktur liefern 
-1 !! nur aktuellen Kanal abfragen
0 !! Test, ob Bconmap vorhanden ist
6 !! ST-kompatibler RS232-Port
7 !! SCC Kanal B
8 !! TTMFP RS232-Port
9 !! SCC Kanal A
>10 !! eigene Treiber
!end_table
Die Funktion beeinflut sowohl die (!nolink [BIOS])-Vektortabelle in den
(!link [Systemvariablen][Die Systemvariablen]), als auch das Verhalten der
Funktionen (!nolink [Rsconf]) und (!nolink [Iorec]).

(!B)Hinweis:(!b) Laut Atari sollte man seine TOS-Version folgendermaen auf
das Vorhandensein von Bconmap testen:
!begin_verbatim
WORD has_bconmap ( VOID )
{
   return (0L == Bconmap (0));
}
!end_verbatim

(!B)HSMODA(!b) (!ln)
Diese Funktionen sind nur vorhanden falls Paket HSMODA installiert ist.

(!U)int32_t Bconmap((int16_t)-400, (int16_t)dev_nr, (int32_t)ptr_to_6_longs)(!u)(!nl)
Die Konstante MAPT_OVE wird als -400 definiert. Diese Funktion dient dem 
šberschreiben bereits existierender MAPTAB-Eintr„ge. dev_nr ist eine 
Ger„tenummer ab 6 aufw„rts, die in der MAPTAB bereits existieren muá, 
andernfalls wird der Fehlercode -15 EUNDEV zurckgegeben. ptr_to_6_longs 
zeigt auf eine Struktur, die einem MAPTAB-Eintrag entspricht. Diese 
Struktur wird auf den entsprechenden Platz in der MAPTAB kopiert. Ist das 
angesprochende Ger„t das aktuell per Bconmap fr AUX eingestellte, so 
werden die eben eingeh„ngten Routinen auch nach xco* und in die aktuellen 
rsconf und iorec-Zellen kopiert. Diese Funktion dient nur zum Einh„ngen 
MagiC-freundlicher Routinen. Als Erfolgsmeldung wird die Ger„tenummer 
zurckgegeben, auf die der Eintrag erfolgte, also dev_nr.

Um Ger„te auf den BIOS-Nummern zu installieren, die fest zu einem Computer 
geh”ren, ist immer MAPT_OVE zu benutzen. Fr den ST betrifft das z.B. #6, 
beim MegaSTE #6 bis #8 und beim TT #6 bis #9.

(!U)int32_t Bconmap((int16_t)-401, (int32_t)ptr_to_6_longs)(!u)(!nl)
Die Konstante MAPT_APP wird als -401 definiert. Diese Funktion dient dem 
Anfgen eines Kanals an die MAPTAB oder dem Beschreiben eines leeren 
Kanals. ptr_to_6_longs zeigt auf eine Struktur, die einem MAPTAB-Eintrag 
entspricht. Rckmeldung ist entweder die von dieser Funktion fr den 
Eintrag gew„hlte Kanalnummer, oder der Fehlercode -12 EGENRL, falls kein 
Platz fr eine MAPTAB-Vergr”áerung ist. Hier kann es nicht vorkommen, das 
die Vektoren sofort nach xco* bertragen werden, da ein bisher nicht 
vorhandener oder belegter Kanal nicht als AUX eingestellt sein kann.

MAPT_APP sucht sich den ersten freien Kanal hinter den fest zum Computer 
geh”renden BIOS-Nummern und kann deshalb nur zum Installieren zus„tzlicher 
Ger„te benutzt werden.

(!U)int32_t Bconmap((int16_t)-402, (int16_t)dev_nr, (int32_t)ptr_to_listentry)(!u)(!nl)
Die Konstante MAPT_DEL wird als -402 definiert. Diese Funktion dient zum 
L”schen eines Ger„tes aus der MAPTAB und zum Aush„ngen einer RSVF-Liste 
aus der RSVF-Verkettung.

dev_nr ist entweder die BIOS-Kanalnummer des aus der MAPTAB zu 
entfernenden Ger„tes oder -1 fr Nichtstun. Der entsprechende 
MAPTAB-Eintrag wird freigeben indem spezielle Dummy-Routinenzeiger 
eingetragen werden, die auf den Assemblerbefehl RTS zeigen. Der 
Iorec-Zeiger-Eintrag wird auf 0 gesetzt. Ist der gel”schte Kanal auch als 
BIOS-AUX-Device eingestellt gewesen, so wird BIOS-AUX auf Nummer 6 
umgestellt, auch wenn gerade Nummer 6 gel”scht wurde.

ptr_to_listentry ist entweder der Zeiger auf die auszuh„ngende RSVF-Liste 
oder 0 fr Nichtstun. Der Zeiger mu auf den Anfang einer Liste verweisen, 
die daraufhin komplett entfernt wird, auch wenn sie mehr als ein 
Schnittstellenobjekt und End- oder Verkettungsobjekt enth„lt.

Im Erfolgsfall gibt MAPT_DEL 1 zurck, im Fehlerfall -1.

# Quelle: Quelltexte des Pakets misc_def.s und drvintst.s, drvin.txt

!item [Ergebnis:]
(!nolink [Bconmap]) liefert die alte Einstellung. Falls (!I)devno(!i) gleich
-2 ist liefert die Funktion einen Zeiger auf BCONMAP zurck.

!item [Gruppe:]
Schnittstellenprogrammierung

!item [Verfgbar:]
Diese Funktion ist nur vorhanden falls das Paket HSMODA installiert ist.

!item [Querverweis:]
(!link [Binding] [Bindings fr Bconmap]) ~ Bconout ~ Bconin ~ Bcostat ~
Bconstat ~ Iorec   ~  Rsconf

(!ende_liste)


!begin_node Bindings fr Bconmap
!ignore_index
(!begin_liste) [Assembler:]
!item [C:]
#include <tos.h>

int32_t Bconmap( int16_t devno );
!item [Assembler:]
!begin_verbatim
move.w    devno,-(sp)  ; Offset 2
move.w    #44,-(sp)    ; Offset 0
trap      #14          ; XBIOS aufrufen
addq.l    #4,sp        ; Stack korrigieren
!end_verbatim
!ifdest [html]
!item [GFA-Basic]
!begin_raw
<A HREF="http://www.milanstation.de/at/gfahutil/gfau7xbi.htm">GFA-H-Util XBios</A>
!end_raw
!endif
(!ende_liste)
!end_node
!end_node


!endif