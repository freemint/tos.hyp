!begin_node Gettime
(!begin_liste) [Beschreibung:]
!item [Name:]
¯get time® - Zeit ermitteln.
!item [Xbiosnummer:]
23
!item [Binding:]
(!link [Bindings fr Gettime] [Bindings fr Gettime])
!item [Beschreibung:]
Die XBIOS-Routine Gettime ermittelt Datum und Uhrzeit aus der Hardware-Uhr
des Rechners.
!item [Ergebnis:]
Die Funktion liefert Datum und Uhrzeit, welche wie folgt codiert sind:
!begin_table [r|l]
Bit !! Beschreibung
!hline
  0-4 !! Sekunden in Einheiten von 2 (0-29)
 5-10 !! Minuten (0-59)
11-15 !! Stunden (0-23)
16-20 !! Tag im Monat (1-31)
21-24 !! Monat (1-12)
25-31 !! Jahr (0-119, 0 steht fr 1980)
!end_table
!item [Gruppe:]
Datum, Uhrzeit und Zeitgeber
!item [Querverweis:]    (!link [Binding] [Bindings fr Gettime]) ~  Settime
(!ende_liste)
!end_node



!begin_node Bindings fr Gettime
!ignore_index
(!begin_liste) [Assembler:]
!item [C:]
 #include <portab.h> (!nl)
 #include <tos.h>

ULONG Gettime ( VOID );
!item [Assembler:]
!begin_verbatim
move.w    #23,-(sp)    ; Offset 0
trap      #14          ; XBIOS aufrufen
addq.l    #2,sp        ; Stack korrigieren
!end_verbatim
!ifdest [html]
!item [GFA-Basic]
!begin_raw
<A HREF="http://www.milanstation.de/at/gfahutil/gfau7xbi.htm">GFA-H-Util XBios</A>
!end_raw
!endif
(!ende_liste)
!end_node


!begin_node NVMaccess
(!begin_liste) [Beschreibung:]
!item [Name:]
¯NVMacess® - Konfiguration des "non volatile memory" der Echtzeituhr.
!item [Xbiosnummer:]
46
!item [Binding:]
(!link [Bindings fr NVMaccess] [Bindings fr NVMaccess])
!item [Beschreibung:]
Die XBIOS-Routine NVMaccess erm”glicht die Konfiguration des NVM der
Echtzeituhr. Diese verfgt ber 50 Bytes nicht-flchtiges RAM, wobei die
letzten zwei Bytes als Prfsumme verwendet werden. Es gilt:
!begin_table [l|l]
Parameter !! Bedeutung
!hline
op !! 0 = NVM auslesen und Prfsumme checken
~  !! 1 = NVM beschreiben, Prfsumme checken
~  !! ~~~~und neu setzen
~  !! ~
~  !! 2 = NVM initialisieren und Prfsumme setzen
~  !! ~
start !! Startbyte
(!nolink [count]) !! Anzahl der zu bertragenden Bytes
buffer !! Puffer aus bzw. in den geschrieben wird
!end_table
!item [Ergebnis:]
Die Funktion liefert den Wert 0, wenn kein Fehler aufgetreten ist. Ein Wert
von -5 bedeutet, da die Argumente nicht im erlaubten Bereich waren. Ein
Rckgabewert von -12 kennzeichnet eine nicht konsistente Prfsumme.
!item [Gruppe:]
Datum, Uhrzeit und Zeitgeber

!item [Querverweis]  (!link [Binding] [Bindings fr NVMaccess]) ~  (!link [Belegung des NVM][Die Belegung des NVM der Echtzeit-Uhr])

(!ende_liste)
!end_node


!begin_node Bindings fr NVMaccess
!ignore_index
(!begin_liste) [Assembler:]
!item [C:]
 #include <portab.h> (!nl)
 #include <tos.h>

WORD NVMaccess ( WORD op, WORD start, WORD count, BYTE *buffer );
!item [Assembler:]
!begin_verbatim
pea       buffer       ; Offset 8
move.w    count,-(sp)  ; Offset 6
move.w    start,-(sp)  ; Offset 4
move.w    op,-(sp)     ; Offset 2
move.w    #46,-(sp)    ; Offset 0
trap      #14          ; XBIOS aufrufen
lea       $C(sp),sp    ; Stack korrigieren
!end_verbatim
!ifdest [html]
!item [GFA-Basic]
!begin_raw
<A HREF="http://www.milanstation.de/at/gfahutil/gfau7xbi.htm">GFA-H-Util XBios</A>
!end_raw
!endif
(!ende_liste)
!end_node


!begin_node Settime
(!begin_liste) [Beschreibung:]
!item [Name:]
¯set time® - Zeit einstellen.
!item [Xbiosnummer:]
22
!item [Binding:]
(!link [Bindings fr Settime] [Bindings fr Settime])
!item [Beschreibung:]
Die XBIOS-Routine Settime stellt Datum und Uhrzeit neu ein. Der 32-Bit
Parameter (!I)time(!i) wird wie folgt aufgesplittet:
!begin_table [r|l]
time !! Bedeutung
!hline
0-4 !! Sekunden in Einheiten von 2 (0-29)
5-10 !! Minuten (0-59)
11-15 !! Stunden (0-23)
16-20 !! Tag im Monat (1-31)
21-24 !! Monat (1-12)
25-31 !! Jahr (1980 subtrahieren)
!end_table
!item [Ergebnis:]
Die Funktion liefert kein Ergebnis.
!item [Gruppe:]
Datum, Uhrzeit und Zeitgeber
!item [Querverweis:]    (!link [Binding] [Bindings fr Settime]) ~  Gettime
(!ende_liste)
!end_node


!begin_node Bindings fr Settime
!ignore_index
(!begin_liste) [Assembler:]
!item [C:]
 #include <portab.h> (!nl)
 #include <tos.h>

VOID Settime ( ULONG time );
!item [Assembler:]
!begin_verbatim
move.l    time,-(sp)   ; Offset 2
move.w    #22,-(sp)    ; Offset 0
trap      #14          ; XBIOS aufrufen
addq.l    #6,sp        ; Stack korrigieren
!end_verbatim
!ifdest [html]
!item [GFA-Basic]
!begin_raw
<A HREF="http://www.milanstation.de/at/gfahutil/gfau7xbi.htm">GFA-H-Util XBios</A>
!end_raw
!endif
(!ende_liste)
!end_node


!begin_node Xbtimer
(!begin_liste) [Beschreibung:]
!item [Name:]
¯timer init® - initialisiert die Zeitgeber im MFP-Chip.
!item [Xbiosnummer:]
31
!item [Binding:]
(!link [Bindings fr Xbtimer] [Bindings fr Xbtimer])
!item [Beschreibung:]
Die XBIOS-Routine Xbtimer initialisiert einen von vier Zeitgebern (A-D) im
Multifunktionsperipheriechip 68901. Es gilt:
!begin_table [l|l]
Parameter !! Bedeutung
!hline
timer !! Nummer des Timers:
~     !! 0 = A (fr eigene Programme nutzbar)
~     !! 1 = B (Horizontal Blank Interrupt)
~     !! 2 = C (Systemtimer (200 Hz))
~     !! 3 = D (Generator fr die Baudraten)
~ !! ~
(!nolink [control]) !! Wert fr entsprechende Timer-Register
data !! Wert fr entsprechende Timer-Register
vector !! Zeiger auf Interrupt-Routine
!end_table
!item [Ergebnis:]
Die Funktion liefert kein Ergebnis.
!item [Gruppe:]
Datum, Uhrzeit und Zeitgeber
!item [Querverweis:]    (!link [Binding] [Bindings fr Xbtimer])
(!ende_liste)
!end_node



!begin_node Bindings fr Xbtimer
!ignore_index
(!begin_liste) [Assembler:]
!item [C:]
 #include <portab.h> (!nl)
 #include <tos.h>

VOID Xbtimer ( WORD timer, WORD control, WORD data, VOID (*vector)( ) );
!item [Assembler:]
!begin_verbatim
pea       vector        ; Offset 8
move.w    data,-(sp)    ; Offset 6
move.w    control,-(sp) ; Offset 4
move.w    timer,-(sp)   ; Offset 2
move.w    #31,-(sp)     ; Offset 0
trap      #14           ; XBIOS aufrufen
lea       $C(sp),sp     ; Stack korrigieren
!end_verbatim
!ifdest [html]
!item [GFA-Basic]
!begin_raw
<A HREF="http://www.milanstation.de/at/gfahutil/gfau7xbi.htm">GFA-H-Util XBios</A>
!end_raw
!endif
(!ende_liste)
!end_node


!begin_node Die Belegung des NVM der Echtzeit-Uhr
!label Non-Volatile-Memory, Belegung des

Die Echtzeit-Uhr im Atari-TT und Falcon030 verfgt ber 50 Bytes
nichtflchtiges RAM, welches von Programmen zu Konfigurationszwecken
benutzt werden kann. Es gilt folgende Belegung:

!begin_table [c|l|l]
Byte !! Bits !! Bedeutung
!hline
0-1 !! ~   !! Bootpr„ferenz
2-5 !! ~   !! Reserviert
6   !! ~   !! Sprache
7   !! ~   !! Tastatur-Layout
8   !! ~   !! DateTime
9   !! ~   !! Trenner fr Datumsangaben
10  !! ~   !! Bootverz”gerung
11-13  !! ~   !! Reserviert
14-15  !! ~   !! Videomode
16 !! 0..2 !! SCSI-ID (0-7)
16 !! 3..6 !! 0, reserviert
16 !! 7    !! Flag fr Bus-Arbitration.
~  !! ~    !! Es gilt:
~  !! ~    !! ~
~  !! ~    !! 0 = (!nolink [Arbitration]) ein
~  !! ~    !! 1 = (!nolink [Arbitration]) aus
!end_table
Alle weiteren Bytes sind z.Zt. nicht dokumentiert. Wie man sieht, l„t sich
insbesondere die SCSI-ID von TT oder Falcon ber das NVM festlegen.

Querverweis: NVMaccess ~ (!link [XHDI-Spezifikation][XHDI])

!end_node
