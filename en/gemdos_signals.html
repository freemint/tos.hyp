<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 2025/12/20 -->
<html lang="en">
<head>
<title>
The documentation for TOS: Signals
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="gemdos_main.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24">GEMDOS</a>
<a name="UDO_nav_lf_HEAD" href="gemdos_tpa.html"><img src="udo_lf.gif" alt="Program launch and TPA" title="Program launch and TPA" border="0" width="24" height="24">Program launch and TPA</a>
<a name="UDO_nav_rg_HEAD" href="gemdos_trap.html"><img src="udo_rg.gif" alt="gemdos-trap" title="gemdos-trap" border="0" width="24" height="24">gemdos-trap</a>

<hr>

<h1><a name="Signals">5.7 Signals</a></h1>
<p>The &quot;signal&quot; concept, originating from the U*NIX
world, is also available in the operating systems MultiTOS (actually
the underlying MiNT) and <a href="magic.html">MagiC</a> (as of Version 4.50). Signals can be
thought of as natural number messages that represent a given exception
condition. They are comparable to an interrupt or a CPU exception, but
with the difference that they deal with a pure <i>software</i>
implementation.
</p>
<p><b>Each process possesses:</b>
</p>
<ul>
<li><p> A bit-vector of the pending signal. This describes those
signals that are still waiting to be processed, perhaps because they
are currently blocked by the signal mask, or because the process is in
a state where it cannot process signals.
<br>&nbsp;
</p></li>
<li><p> A signal mask. This 32-bit value defines those signals that are
currently blocked as a bit-vector; if, say, bit 30 is set in this
vector, then the signal SIGUSR2 is blocked. The signal mask is not
just impacted explicitly (i.e. by system calls) but also
<i>implicitly</i> by other processes. During the processing of a
signal, for instance, it is blocked, yet others may occur. After the
signal has been processed it is released again and any signals waiting
can then be processed. One should note that some signals (e.g.
SIGKILL, SIGSTOP, SIGCONT) can <i>not</i> be masked.
<br>&nbsp;
</p></li>
<li><p> A table in the form <a href="gemdos_structures.html#struct_20sigaction">struct sigaction</a>.
<br>&nbsp;
</p></li>
</ul>

<p>At a <a href="gemdos_process.html#Pexec">Pexec</a> the signal mask and the pending value (see above) of
the child process will be zeroed. The element <i>sa_handler</i> of
the <a href="gemdos_structures.html#sigaction">sigaction</a> structure is inherited, during which a non-0 or 1 value
is always set to 0. The elements <i>sa_mask</i> and <i>sa_flags</i>
of the structure are zeroed.
</p>
<p>Most signals can be caught by a program (perhaps to call up a
given routine on receipt), ignored, or also blocked. Blocked signals
will be ignored until the blockade is lifted again. <b>Re
terminology:</b> One says that a signal is <i>sent</i> to a process
when the exception that is represented by the signal occurs, or the
signal is sent by another process via <a href="gemdos_process.html#Pkill">Pkill</a>. On the other hand a
signal is <i>caught</i> by a process when the corresponding process
awakes and starts the actions matching the signal. One should note
that the signal handling takes up time: Between sending a signal and
the execution of the matching action a considerable period of time may
pass.
</p>
<a name="Signals_2C_20List_20of"></a>
<p>In total there are 31 possible signals (0 to 30) available, not
all of which however have been assigned a fixed meaning. The following
list describes (as far as known) all possible signals in the form:
Signal number, Name of the signal, Meaning of the signal for the
receiving process. <b>Unless explicitly noted otherwise, the default
action on the receipt of a signal is the killing (termination) of the
receiving process</b>.
</p>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Number Name</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
<a name="SIGNULL"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp; SIGNULL</td>
<td valign="top"> Null: This signal has no default action, because strictly
speaking it is not really a signal at all. Together with <a href="gemdos_process.html#Pkill">Pkill</a> it can
be used, however, to test for the existence of a child process. The
signal can <i>not</i> be masked or caught.
<a name="SIGHUP"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp; SIGHUP</td>
<td valign="top"> Hang up: Is normally sent when the terminal with which a
process is connected is no longer valid. After receiving this signal
the process should make no further output to the terminal. In <a href="magic.html">MagiC</a>
the VT52 will send the signal when a terminal window has been closed.
<a name="SIGINT"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp; SIGINT</td>
<td valign="top"> Interrupt: Is usually sent when the user presses the key
combination ^C to interrupt a process. This signal is used by later
versions of MagiC in place of previous ways of handling ^C.
<a name="SIGQUIT"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp; SIGQUIT</td>
<td valign="top"> Quit: Generally this is sent when the user presses the key
combination ^\. This signal should be 'harder' than SIGINT, and at
present is not sent by MagiC or VT52.
<a name="SIGILL"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp; SIGILL</td>
<td valign="top"> Illegal instruction: Corresponds to the exception vector of the
same name of the 68k processor. The signal should <i>not</i> be
caught. In MiNT the signal can be caught, i.e. the vector will be
diverted for almost every process. In MagiC however this does not
work at present, so that here 8 bombs will always appear.
<a name="SIGTRAP"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp; SIGTRAP</td>
<td valign="top"> Trap: Corresponds to the 'Trace' exception vector of the 68k
processor, and is sent after each instruction is executed with the
system in single-step 'trace' mode. This signal should be caught only
by <b>debuggers</b>. In MiNT the signal can be caught, i.e. the
vector will be diverted for almost every process. In MagiC however
this does not work at present, so that here 9 bombs will always
appear.
<a name="SIGABRT"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp; SIGABRT</td>
<td valign="top"> Abort: Is normally used by the library function abort in ANSI
C, and should <i>not</i> be caught. This signal is not sent by the
operating system itself.
<a name="SIGPRIV"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp; SIGPRIV</td>
<td valign="top"> Privilege violation: Corresponds to the exception vector of the
same name of the 68k processor, when a process tries to execute an
instruction in user-mode that may be executed only in supervisor-mode.
The signal should <i>not</i> be caught. In MiNT, however, this is
possible, so that the exception vector will be diverted for almost
every process. But in MagiC this does not work at present, so that
here 8 bombs will always appear.
<a name="SIGFPE"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp; SIGFPE</td>
<td valign="top"> Floating point exception: The default action consists of
ignoring the signal. It corresponds to the 68k exception vector
'Division by zero' or a floating point exception. The signal may be
ignored or caught. In MiNT the signal may be caught, so the vector
will be diverted for almost every process. In MagiC however this does
not work at present.
<a name="SIGKILL"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;9&nbsp;&nbsp; SIGKILL</td>
<td valign="top"> Kill: Forcibly terminates the receiving process. The signal
cannot be masked or caught; therefore this signal should only be sent
if SIGTERM failed. The signal is not presently sent by <a href="magic.html">MagiC</a> itself.
<a name="SIGBUS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;10&nbsp;&nbsp; SIGBUS</td>
<td valign="top"> Bus error: Corresponds to the exception vector of the same name
of the 68k processor. The signal should <i>not</i> be ignored or
caught. In MiNT the signal may be caught, i.e. the exception vector
will be diverted for almost every process. In MagiC however this does
not work at present, so that 2 bombs will always appear. In MiNT,
SIGBUS, SIGSEGV and SIGPRIV are reset to the default routine of the
system on first receipt of the signals, so that a <i>double</i>
bus/address/privilege error always kills the process.
<a name="SIGSEGV"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;11&nbsp;&nbsp; SIGSEGV</td>
<td valign="top"> Segmentation violation: Corresponds to an 'address error'
exception vector of the 68k processor. The signal should <i>not</i>
be caught or ignored. In MiNT the signal may be caught, i.e. the
exception vector will be diverted for almost every process. In MagiC
however this does not work at present, so 3 bombs always appear.
<a name="SIGSYS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;12&nbsp;&nbsp; SIGSYS</td>
<td valign="top"> Bad system call: Sent when an argument to a system call is bad
or out of range and the call does not have means to report the error.
Is not sent by MagiC at present.
<a name="SIGPIPE"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;13&nbsp;&nbsp; SIGPIPE</td>
<td valign="top"> Pipe error: Is sent when an attempt is made to write to a pipe
that no longer exists or has no readers, and can be masked in
<a href="proto_dd.html">Drag&amp;Drop protocol</a>, for instance. This signal is not sent by
MagiC at present.
<a name="SIGALRM"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;14&nbsp;&nbsp; SIGALRM</td>
<td valign="top"> Alarm: Is used by MiNT for <a href="gemdos_datetime.html#Talarm">Talarm</a>, and serves for handling
timeouts, for instance. In MagiC this signal is not sent at present.
<a name="SIGTERM"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;15&nbsp;&nbsp; SIGTERM</td>
<td valign="top"> Terminate: Standard request for the process to clean up and
exit; sent by MiNT, for instance, when deleting a program file in the
U:\PROC directory. At present ignored by MagiC.
<a name="SIGURG"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;16&nbsp;&nbsp; SIGURG</td>
<td valign="top"> This signal is currently not defined.
<a name="SIGSTOP"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;17&nbsp;&nbsp; SIGSTOP</td>
<td valign="top"> Stop: The default action serves to suspend the receiving
process. The signal can <i>not</i> be blocked, caught or ignored. In
MagiC it causes all threads of a process to be paused. When paused,
no mouse or keyboard clicks are lost in MagiC; on a restart of the
process with SIGCONT all the corresponding messages will be evaluated.
<a name="SIGTSTP"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;18&nbsp;&nbsp; SIGTSTP</td>
<td valign="top"> Terminal stop: The default action is suspension of the
receiving process until a SIGCONT is caught. The signal corresponds to
SIGSTOP, and is usually initiated by the user pressing the key
combination ^Z. It can <i>not</i> be masked or caught. The signal is
not sent by MagiC and VT52 at present.
<a name="SIGCONT"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;19&nbsp;&nbsp; SIGCONT</td>
<td valign="top"> Continue: The default action is to resume the process that was
previously suspended with SIGSTOP or <a href="gemdos_process.html#Pause">Pause</a>. Though the signal cannot
be masked or ignored, one can install a handling routine for this
signal. In MagiC all threads will be awakened that were paused with a
<a href="gemdos_process.html#Pause">Pause</a> call or a SIGSTOP signal.
<a name="SIGCHLD"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;20&nbsp;&nbsp; SIGCHLD</td>
<td valign="top"> Child terminated: The default action is to ignore the signal.
It is sent to the parent process both on termination as well as
pausing of a child process. In MiNT one can arrange that this signal
is sent only on termination, and in addition one can determine which
child process was affected. As MagiC until now only knows the waiting
<a href="gemdos_process.html#Pexec">Pexec</a> (i.e. the parent waits until the child terminates), this signal
does not exist there. Processes that are created with <a href="shel.html#shel_write">shel_write</a> are
<i>not</i> real child processes, but fully independent ones; in such
cases one therefore has to wait for the arrival of a <a href="evnt.html#CH_EXIT">CH_EXIT</a> message.
<a name="SIGTTIN"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;21&nbsp;&nbsp; SIGTTIN</td>
<td valign="top"> Terminal input error: The default action consists of pausing
the receiving process. As a rule, a process is attempting to read from
a terminal in a process group that does not belong to it. This signal
is not sent by MagiC or VT52 at present.
<a name="SIGTTOU"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;22&nbsp;&nbsp; SIGTTOU</td>
<td valign="top"> Terminal output error: The default action consists of pausing
the receiving process. As a rule, a process is attempting to output to
a terminal in a process group that does not belong to it. This signal
is not sent by MagiC or VT52 at present.
<a name="SIGIO"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;23&nbsp;&nbsp; SIGIO</td>
<td valign="top"> I/O possible: Sent to show that input/output is possible on a
file descriptor.
<a name="SIGXCPU"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;24&nbsp;&nbsp; SIGXCPU</td>
<td valign="top"> Exhaustion of CPU limit: The calculation time contingent set by
<a href="gemdos_process.html#Psetlimit">Psetlimit</a> or by the extended <a href="shel.html#shel_write">shel_write</a> modes has elapsed. As the
limitation of CPU time is not yet implemented in MagiC, this signal
is not sent at present under this OS.
<a name="SIGXFSZ"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;25&nbsp;&nbsp; SIGXFSZ</td>
<td valign="top"> File size limit exceeded: Sent to a process if it tries to
modify a file in a way that makes it exceed the maximum file size
limit of the process.
<a name="SIGVTALRM"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;26&nbsp;&nbsp; SIGVTALRM</td>
<td valign="top"> Time limit expired: Sent to a process that has exceeded its
maximum time limit.
<a name="SIGPROF"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;27&nbsp;&nbsp; SIGPROF</td>
<td valign="top"> Profiling time expired: Sent to a process to tell it that its
profiling time has expired.
<a name="SIGWINCH"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;28&nbsp;&nbsp; SIGWINCH</td>
<td valign="top"> Window changed: The default action is to ignore the signal.
Normally it is sent if the size of the terminal (i.e. number of lines
or columns) has altered. A program that is running in a terminal
window can then reconfigure itself to match the new size of the
window. For obtaining the current window size one can use in MiNT
<a href="gemdos_file.html#Fcntl">Fcntl</a> Opcodes, which however are not yet implemented in MagiC. Hence
the signal is currently not sent by MagiC or VT52.
<a name="SIGUSR1"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;29&nbsp;&nbsp; SIGUSR1</td>
<td valign="top"> User-defined:
<a name="SIGUSR2"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;30&nbsp;&nbsp; SIGUSR2</td>
<td valign="top"> User-defined: These two signals may be sent by user programs.
As a process is killed by default on receipt of this signal, it should
only be sent if the receiver is known.
<a name="SIGPWR"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;31&nbsp;&nbsp; SIGPWR</td>
<td valign="top"> The system is restart due to a power failure.

</td></tr>
</table>

<p>See also:
<br><a href="#Signal-handler_20in_20MagiC">Signal-handler in MagiC</a> &nbsp; <a href="gemdos_process.html">Process functions</a> &nbsp; <a href="#Sample_20code_20for_20signals">Sample code</a> &nbsp; <a href="gemdos_process.html#Psigaction">Psigaction</a>
&nbsp; <a href="gemdos_process.html#Psignal">Psignal</a> &nbsp; <a href="gemdos_process.html#Pkill">Pkill</a> &nbsp; <a href="gemdos_pipes.html">Test for pipes</a>
</p>
<h3><a name="Signal-handler_20in_20MagiC">5.7.1 Signal-handler in MagiC</a></h3>
<p>As <a href="magic.html">MagiC</a>'s signal-handlers differ somewhat from those in MiNT or
in MultiTOS, we will deal here with the most important differences and
features. First of all it must be realised that in MagiC, <a href="aes_about.html">AES</a> and
<a href="About_the_VDI.html">VDI</a> calls from within a signal-handler are <i>permitted</i> (quite
in contrast to MiNT).
</p>
<p>A signal-handler runs in user-mode and employs the user stack of
the main thread, while this sleeps. In MiNT the supervisor stack of
the process is used. Hence, according to the MiNT documentation, the
nesting of signals more than 4 deep makes a process crash due to stack
overflow. In MagiC each signal-handler is its <i>own</i> thread with
its <i>own</i> supervisor stack, so that the worst that can happen is
the extremely rare case of user stack overflow. However, if too little
memory is available for a new thread when handling a signal, then an
&quot;<a href="magic_errors.html#Out_20of_20internal_20memory">Out of internal memory</a>&quot; alert will appear, and one should
terminate a program as soon as possible. MagiC requires about 7 kb of
memory for handling each signal.
</p>
<p>In MagiC, the same applies for signals as for threads (a
signal-handler is a thread), i.e. the corresponding system libraries
have to be <i>reentrant.</i> However, there is a complication because
the main thread is halted while processing the signal. So if the main
thread has set a signal (<a href="wind.html#wind_update">wind_update</a> for example), a deadlock occurs
if the signal-handler also wants to set these signals. Furthermore, in
MagiC a process may be interrupted at almost any point (MagiC is
reentrant, even DOS is interruptible), so that the main thread may in
some cases block important areas of the system (files, directories,
semaphores). Due to this it is possible that certain files cannot be
deleted or opened, for instance.
</p>
<p>With normal termination of a signal-handler all semaphores
blocked by the handler are released automatically. Furthermore,
windows, screen background and menu bar of the signal-handler will be
released if appropriate. Note that a signal-handler has its own AES
message-queue, i.e. evnt_message and <a href="appl.html#appl_write">appl_write</a> should be used with
care.
</p>
<p>On <a href="gemdos_process.html#Psigreturn">Psigreturn</a> the semaphores of all signal-handlers as well as
those of the main thread will be released. However the windows, screen
background and menu bar of the signal-handler will not be released.
Though this would not have been much of a problem, it may not be
necessary in practice. <a href="gemdos_process.html#Psigreturn">Psigreturn</a> restores the supervisor stack of the
main thread, i.e. a setjmp/longjmp mechanism only needs to set the
USP. This is not sufficiently documented in the MiNT documentation,
and also works only if the main thread is waiting via a GEMDOS call.
If AES comes into play, MultiTOS crashes! Hence <a href="gemdos_process.html#Psigreturn">Psigreturn</a> should
be avoided if possible. <a href="gemdos_process.html#Psigreturn">Psigreturn</a> in MagiC is not of the type VOID
as in MiNT, but of the type LONG. If the function is called from a
non-signal-handler, <a href="gemdos_process.html#Psigreturn">Psigreturn</a> returns the value <a href="gemdos_errors.html#EACCDN">EACCDN</a>, otherwise
<a href="gemdos_errors.html#E_OK">E_OK</a>. If <a href="gemdos_process.html#Psigreturn">Psigreturn</a> has returned <a href="gemdos_errors.html#E_OK">E_OK</a>, then (as in MiNT) under <i>no
circumstances</i> should the handling procedure be terminated in the
normal way via rts, because the jump-back address on the user stack is
invalid after execution of <a href="gemdos_process.html#Psigreturn">Psigreturn</a>.
</p>
<p>A problem exists in MagiC with the existing versions of VT52. A
signal-handler <i>cannot</i> yet perform keyboard scans in VT52; the
keys will not be received. This may alter in a later version, however.
</p>
<p>See also: <a href="gemdos_process.html">Process functions</a> &nbsp; <a href="#Signals">Signals</a> &nbsp; <a href="magic_threads.html">Threads</a>
</p>
<h3><a name="Sample_20code_20for_20signals">5.7.2 Sample code for signals</a></h3>
<p>The first program installs a signal-handler for the two signals
<a href="gemdos_signals.html#SIGUSR1">SIGUSR1</a> and <a href="gemdos_signals.html#SIGUSR2">SIGUSR2</a>. With that one can test the nesting of both
signals, if both are sent consecutively. The program should run in VT52
or in MINIWIN. If one presses Ctrl-Alt-Esc during the
&quot;for()&quot; delay loop, one can see that MagiC creates its own
thread for each signal-handler. This has the advantage that under
MagiC no events (mouse, timer, ...) will be lost while a signal is
being processed.
</p>
<pre>------------------------------ snip --------------------------
#include &lt;tos.h&gt;
#include &lt;stdio.h&gt;

void cdecl handler(long signr)
{
    long i;

    printf(&quot;Handler: Signal %ld received.\n&quot;, signr);
    <a href="gemdos_chrinout.html#Cconws">Cconws</a>(&quot;<a href="powerdos.html#Wait">Wait</a>...&quot;);
    for (i = 0; i &lt; 7000000L; i++)
        ;
    <a href="gemdos_chrinout.html#Cconws">Cconws</a>(&quot;...OK\r\n&quot;);
}

int main( void )
{
    long ret;

    printf(&quot;My ProcID is %d.\n&quot;, <a href="gemdos_process.html#Pgetpid">Pgetpid</a>());
    ret = (long) <a href="gemdos_process.html#Psignal">Psignal</a>(<a href="gemdos_signals.html#SIGUSR1">SIGUSR1</a>, handler);
    printf(&quot;<a href="gemdos_process.html#Psignal">Psignal</a> =&gt; %ld\n&quot;, ret);
    ret = (long) <a href="gemdos_process.html#Psignal">Psignal</a>(<a href="gemdos_signals.html#SIGUSR2">SIGUSR2</a>, handler);
    printf(&quot;<a href="gemdos_process.html#Psignal">Psignal</a> =&gt; %ld\n&quot;, ret);
    <a href="gemdos_chrinout.html#Cconin">Cconin</a>();
    return(0);
}
------------------------------ snap --------------------------
</pre>
<p>The second program shows the treatment of the <a href="gemdos_process.html#Psigreturn">Psigreturn</a> call.
Under MiNT this program only works if one doesn't use any AES calls
(<a href="evnt.html#evnt_keybd">evnt_keybd</a> or <a href="evnt.html#evnt_multi">evnt_multi</a>), but uses, say, <a href="gemdos_chrinout.html#Cconin">Cconin</a>. This means that the
following program works under MagiC but crashes under MultiTOS (MiNT
1.08+AES 4.1). The problem lies probably in the restoration of the
supervisor stack (system stack pointer), where MultiTOS fails due to
the non-homogenous concept AES&lt;-&gt;MiNT.
</p>
<pre>------------------------------ snip ---------------------------
#include &lt;tos.h&gt;
#include &lt;<a href="aes_fundamentals.html#aes">aes</a>.h&gt;
#include &lt;setjmp.h&gt;
#include &lt;tosdefs.h&gt;
#include &lt;stdio.h&gt;

jmp_buf env;

void cdecl handler(long signr)
{
    printf(&quot;Handler: Signal %ld received.\n&quot;, signr);
    <a href="gemdos_chrinout.html#Cconws">Cconws</a>(&quot;Perform <a href="gemdos_process.html#Psigreturn">Psigreturn</a>()\r\n&quot;);
    <a href="gemdos_process.html#Psigreturn">Psigreturn</a>();
    longjmp(env, 1);
}

int main( void )
{
    long ssp;

    <a href="appl.html#appl_init">appl_init</a>();
    printf(&quot;My ProcID is %d.\n&quot;, <a href="gemdos_process.html#Pgetpid">Pgetpid</a>());
    <a href="gemdos_process.html#Psignal">Psignal</a>(<a href="gemdos_signals.html#SIGUSR1">SIGUSR1</a>, handler);

    if  (setjmp(env))
        <a href="gemdos_chrinout.html#Cconws">Cconws</a>(&quot;Coming from longjmp.\r\n&quot;);
    else    <a href="gemdos_chrinout.html#Cconws">Cconws</a>(&quot;Coming from setjmp.\r\n&quot;);
    ssp = <a href="gemdos_system.html#Super">Super</a>(0L);
    <a href="gemdos_system.html#Super">Super</a>((void *) ssp);
    printf(&quot;ssp = 0%08lx\n&quot;, ssp);
    <a href="evnt.html#evnt_keybd">evnt_keybd</a>();
    return(0);
}
</pre>
<p>See also: <a href="#Signals">Signals</a> &nbsp; <a href="gemdos_process.html">Process functions</a> &nbsp; <a href="gemdos_main.html">GEMDOS</a>
</p>
<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="gemdos_main.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24">GEMDOS</a>
<a name="UDO_nav_lf_FOOT" href="gemdos_tpa.html"><img src="udo_lf.gif" alt="Program launch and TPA" title="Program launch and TPA" border="0" width="24" height="24">Program launch and TPA</a>
<a name="UDO_nav_rg_FOOT" href="gemdos_trap.html"><img src="udo_rg.gif" alt="gemdos-trap" title="gemdos-trap" border="0" width="24" height="24">gemdos-trap</a>
</body>
</html>
