<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 2025/08/02 -->
<html lang="en">
<head>
<title>
The documentation for TOS: System Services Protocol (SSP)
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="protocols.html"><img src="udo_up.gif" alt="Protocols" title="Protocols" border="0" width="24" height="24">Protocols</a>
<a name="UDO_nav_lf_HEAD" href="proto_seproto.html"><img src="udo_lf.gif" alt="SE protocol" title="SE protocol" border="0" width="24" height="24">SE protocol</a>
<a name="UDO_nav_rg_HEAD" href="proto_view.html"><img src="udo_rg.gif" alt="View protocol" title="View protocol" border="0" width="24" height="24">View protocol</a>

<hr>

<h1><a name="System_20Services_20Protocol_20_28SSP_29">15.10 System Services Protocol (SSP)</a></h1>
<p>The purpose of the System Services Protocol (SSP) is described
in '<a href="#What_20is_20SSP_3F">What is SSP?</a>'
</p>
<p><b>Planning phase </b>
</p>
<p><img src="bilder/gif/sspicon_.gif" alt="" title="" border="0" width="66" height="42"></p>
<p>Idea: Joakim Högberg
<br>Server Code and this Specification: Olaf Piesche
</p>
<p>CCurrently involved in specification, planning and future first
implementations:
</p>
<p>Joakim Högberg (AtarICQ)
<br>Lonny Pursell (AtarIRC)
<br>Olaf Piesche(Smurf)
<br>Odd Skancke (TextView)
<br>Jo Even Skarstein (TaskBar)
<br>Ralph Lowinski (GuiTar)
<br>Rafal Kawecki (WAP-Browser, ArchView)
<br>Dan Ackermann (mICQ, AtarICQ-Overlay)
<br>Jan Krivanek (Atack) (aMail, aFTP)
<br>Erik Häll (MyMail)
<br>Martin Elsässer (ACSPro)
<br>Denis Huguet FalcAmp
</p>
<p>Emailed people (got the spec, waiting for reply):
</p>
<p>Joachim Fornallaz (GEMSetup)
</p>
<p><b>News</b>
</p>
<p>UPDATED to V0.9: Nov. 17th, 2000 (see changes!)
</p>
<p>Dec. 9th, 4:39pm
<br>Martin Elsässer has announced interest to implement SSP in
ACSPro. That means that all applications constructed with ACSPro could
support basic SSP functionality from the start!
</p>
<p>Nov. 17th, 1:46pm
<br>AES message definitions added. Basically the protocol is ready.
</p>
<p>Just decided that the Server will feature 2 different debug
modes. Because it will take a short while until we have implemented
the protocol, it might be difficult to find out if the protocol is
implemented correctly in terms of how SPAs and SRAs react to different
messages. The standard debug mode will feature output and logging of
incoming and sent messages and their parameters, but this doesn't show
the reaction of SPAs and SRAs to different messages, if the protocol
implementation in these applications is not finished. This will be
solved by the Server providing an extended debug mode in which it can
simulate both SRAs and SPAs, additionally to the logging.
</p>
<p><a href="proto_ssp.html#SPA">SPA</a> programers: you'll get a dialog window in which you can send
different <a href="proto_ssp.html#Service">service</a> requests directly from the Server, as if another
application requested a service (<a href="proto_ssp.html#SRA">SRA</a> simulation).
</p>
<p><a href="proto_ssp.html#SRA">SRA</a> programmers: You'll have display in the same dialog window
showing different requests coming in, and the Server will simulate
being an <a href="proto_ssp.html#SPA">SPA</a> and sending back acknowledgement (<a href="proto_ssp.html#SPA">SPA</a> simulation)
including simulation of <a href="proto_ssp.html#Service">Service</a> <a href="linea_init.html">Initialization</a> and <a href="proto_ssp.html#DRS">DRS</a> delays.
</p>
<p>The debug modes will not be available in the first official
release version, to keep the Server code small and efficient.
</p>
<p><b>About this spec</b>
</p>
<p>Welcome to the online SSP specs ;)
</p>
<p>I want to ask everybody involved to tell me if you send the
specs to somebody else, so that we can keep track of things and I can
send updates to everybody.
</p>
<p><b>Target for V1.0 is an as complete as possible spec of <a href="powerdos.html#Send">Send</a>
File, Display <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a>, Status Display, Context <a href="xcontrol.html#Popup">Popup</a>,
Compress File and Display Information <a href="#Services">Services</a>.</b>
</p>
<p>These are the services that will be primarily used by the
currently involved applications.
</p>
<p>Changes to the spec will be listed on the '<a href="#SSP_20changes">SSP changes</a>' page.
</p>
<p>Everybody involved is encouraged to come up with suggestions,
improvement, criticism and anything else you can come up with. There
are 2 reasons for not specifying SSP alone and releasing it then. One
is, this way we have a broad base of applications supporting the
protocol at release time already, which will increase the acceptance
of it on the side of the users, and hence also on the side of
developers. The other reason, just as, if not more important, is that
this way not only ideas of one or two persons flow into the project,
but of a variety of developers working on all different kinds of
software. That'll make SSP more versatile and flexible and make it
take several different points of view into account. Read <a href="#SSP_20changes">SSP changes</a>
for everything else ;)
</p>
<h3><a name="SSP_20changes">15.10.1 SSP changes</a></h3>
<p><u>Specification changes as of Nov. 17th, 2000</u>
</p>
<ul>
<li><p> Updated spec version number to V0.9
<br>&nbsp;
</p></li>
<li><p> Little tweaks here and there
<br>&nbsp;
</p></li>
<li><p> Added constant definitions for the AES messages. SSP
reserves messages from 4719 to 4749 (currently using the first 6) for
future use. With this, the protocol is practically ready for
implementation!
<br>&nbsp;
<br>Update to 1.0 will be done as soon as I start implementing the
server (in about a week I hope), and if no more suggestions for
changes are made.
<br>&nbsp;
</p></li>
</ul>

<p>Specification changes as of Nov. 9th, 2000
</p>
<ul>
<li><p> Updated spec version number to V0.85
<br>&nbsp;
</p></li>
<li><p> Added instructions on how to implement SSP as a <a href="proto_ssp.html#SPA">SPA</a> and <a href="proto_ssp.html#SRA">SRA</a>,
including some short sample code.
<br>&nbsp;
</p></li>
</ul>

<p>Specification changes as of Nov. 7th, 2000
</p>
<ul>
<li><p> updated spec version number to V0.8
<br>&nbsp;
</p></li>
<li><p> Added the first <a href="#Defines_20_28SSP_29">constant definitions</a> including a short explanation of the
determintation of services on Server side as reaction to <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> and
its data identification.
<br>&nbsp;
</p></li>
<li><p> Updated <a href="#Services">the services</a> with necessary value of <a href="proto_ssp.html#dataID">dataID</a> for using
specific services.
<br>&nbsp;
</p></li>
</ul>

<p>Specification changes as of Nov. 6th, 2000
</p>
<ul>
<li><p> Updated spec version number to V0.77
<br>&nbsp;
</p></li>
<li><p> Added spec of server registration
<br>&nbsp;
</p></li>
<li><p> Updated Status Display <a href="proto_ssp.html#Service">Service</a> with possibility to remove the
status icon (e.g. when exiting the <a href="proto_ssp.html#SRA">SRA</a>). Shame, I didn't think of that
when I specified it...
<br>&nbsp;
</p></li>
<li><p> Added message directions in the message
descriptionsServer&quot;, to make more clear who sends which message,
and where to
<br>&nbsp;
</p></li>
</ul>

<p>Specification changes as of Nov. 4th, 2000
</p>
<ul>
<li><p> Updated spec version to 0.75
<br>&nbsp;
</p></li>
<li><p> Added what is SSP? section as an introduction.
<br>&nbsp;
</p></li>
<li><p> Changed Timeouts and Errors - the pipeline scheme showed me
something I didn't see before (that's pretty sad...): the <a href="proto_ssp.html#SRA">SRA</a> can't
know if services are Immediate or Delayed Response. Hence, timeouts
will have to be handeled completely by the server. This shows how good
it is to have a thorough plan before implementing something like
this...
<br>&nbsp;
</p></li>
<li><p> Added <a href="#SSP_20message_20pipeline">SSP message pipeline</a> scheme to make the way it works more
transparent ;)
<br>&nbsp;
</p></li>
<li><p> Changed Context <a href="xcontrol.html#Popup">Popup</a> <a href="proto_ssp.html#Service">Service</a> spec to including mouse
parameters into the <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> and <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> messages
<br>&nbsp;
</p></li>
<li><p> Added <a href="proto_ssp.html#SSP_DISPLAYINFO">Information Display Service</a> in conjunction with Status Display <a href="proto_ssp.html#Service">Service</a>. SPAs
providing Status Display should also be able to request Information
Display. Updated the Software list concerning this.
<br>&nbsp;
</p></li>
</ul>

<p>Specification changes as of Nov. 3rd, 2000
</p>
<ul>
<li><p> Introduced this website and wrote some new stuff into 'about
this spec' on the mainpage
<br>&nbsp;
</p></li>
<li><p> Added no-write-rule to general rules concerning shared memory
handling
<br>&nbsp;
</p></li>
<li><p> Added list of prospective SSP implementing software with
possible services for each of the apps
<br>&nbsp;
</p></li>
<li><p> <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a>: changed and updated data type spec for <a href="proto_ssp.html#SRA">SRA</a> service
request
<br>&nbsp;
</p></li>
<li><p> Added handling of folder names to the send file, upload file
and compress file service specs in <a href="#Services">Services</a>, <a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a>,
<a href="proto_ssp.html#SSP_UPLOADFILE">SSP_UPLOADFILE</a>, and <a href="proto_ssp.html#SSP_COMPRESSFILE">SSP_COMPRESSFILE</a>, see the service implementation
notes.
<br>&nbsp;
</p></li>
<li><p> Decided to implement SSP into a text editor shared/static
library under development by Olaf, added the lib to implementing
software list
<br>&nbsp;
</p></li>
<li><p> Moved Jo Even, Odd and Ralph to the involved developers list ;)
<br>&nbsp;
</p></li>
</ul>

<h3><a name="What_20is_20SSP_3F">15.10.2 What is SSP?</a></h3>
<p>SSP is an approach to make functionality of different
applications useable throughout the whole system. All applications are
targeted, although networking applications will probably benefit most
quickly. SSP is a Client-Server architecture. The <a href="proto_ssp.html#SSP-Server">SSP-Server</a>
(background application) has globally registered applications
providing different services (service providing applications or SPAs).
<a href="proto_ssp.html#Service">Service</a> Requesting Applications (<a href="proto_ssp.html#SRA">SRA</a>s) can use the <a href="proto_ssp.html#SPA">SPA</a>'s services
for their own documents.
</p>
<p><b>Example:</b>
</p>
<ul>
<li> User opens popup by right clicking into an image in Smurf
</li>
<li> User chooses 'System <a href="#Services">Services</a>' in the popup and another popup
</li>
<li> with all possible services opens (provided by the <a href="proto_ssp.html#SSP-Server">SSP-Server</a>)
</li>
<li> User chooses '<a href="powerdos.html#Send">Send</a> file' and another popup with registered <a href="powerdos.html#Send">Send</a>
File <a href="proto_ssp.html#Service">Service</a> applications opens (provided by <a href="proto_ssp.html#SSP-Server">SSP-Server</a>)
</li>
<li> User chooses for example AtarICQ
</li>
<li> Smurf sends <a href="proto_ssp.html#Service">Service</a> <a href="linea_init.html">Initialization</a> Request (SIR) for <a href="powerdos.html#Send">Send</a> File
and chosen <a href="proto_ssp.html#SPA">SPA</a> (AtarICQ) to <a href="proto_ssp.html#SSP-Server">SSP-Server</a>
</li>
<li> <a href="proto_ssp.html#SSP-Server">SSP-Server</a>, if necessary, starts AtarICQ and sends <a href="powerdos.html#Send">Send</a> File
SIR along with request for list of possible recipients
</li>
<li> AtarICQ sends list of online users to <a href="proto_ssp.html#SSP-Server">SSP-Server</a>
</li>
<li> <a href="proto_ssp.html#SSP-Server">SSP-Server</a> opens popup with possible recipients
</li>
<li> User chooses one
</li>
<li> Server sends <a href="proto_ssp.html#Service">Service</a> Use Request (SUR) for <a href="powerdos.html#Send">Send</a> File service to
<a href="proto_ssp.html#SPA">SPA</a> (aICQ)
</li>
<li> aICQ opens connection to recipient and sends image file
</li>
<li> aICQ confirms the Server with <a href="proto_ssp.html#SPA">SPA</a> <a href="proto_ssp.html#Service">Service</a> Acknowledge (SPASA)
</li>
<li> Server confirms Smurf with Server <a href="proto_ssp.html#Service">Service</a> Acknowledge (SSA)
</li>
</ul>

<p>Possible services and registered applications are held in
different configuration files on the Server side. When new
applications want to be registered, it can be done at the first
communication between the <a href="proto_ssp.html#SSP-Server">SSP-Server</a> and the application, or pre-use,
by the application installer or config program. The first possibility
is for convenience to the user, because simply copying and using a new
version of a program would not corrupt the registration with the
<a href="proto_ssp.html#SSP-Server">SSP-Server</a>, since the application would register itself with the
Server at startup. Registering with the <a href="proto_ssp.html#SSP-Server">SSP-Server</a> consists of a short
communication in which the program path and name of the <a href="proto_ssp.html#SPA">SPA</a> and the
provided services are sent to the Server. The Server could runtime
(when services are requested by the <a href="proto_ssp.html#SRA">SRA</a>) check for the existence of
registered SPAs, which will prevent errors upon service
initialization.
</p>
<a name="What_20is_20the_20SSP-Server_3F"></a>
<p>What is the SSP-Server?
</p>
<p>The <a href="proto_ssp.html#SSP-Server">SSP-Server</a> is an application running in the background that
manages all communication between SRAs and SPAs. All <a href="#Services">services</a> are
hardwired into the Server. This system has been chosen for several
reasons:
</p>
<ul>
<li><p> The Server can perform error checking, correction and
prevention, which takes workload off the developers of implementing
SPAs and SRAs
<br>&nbsp;
</p></li>
<li><p> The Server can perform user interaction (choice of service,
choice of <a href="proto_ssp.html#SPA">SPA</a>, user parameter input) without the SPAs and SRAs having
to hassle with it.
<br>&nbsp;
</p></li>
<li><p> Appearance of the user interactive parts (popups, dialogs for
parameter input, etc.) is consistent
<br>&nbsp;
</p></li>
<li><p> Hardwiring the services prevents messy implementation and
introduction of new services
<br>&nbsp;
</p></li>
<li><p> The Server can combine different services into one, for example
Compress File <a href="proto_ssp.html#Service">Service</a> and <a href="powerdos.html#Send">Send</a> File or Upload File <a href="proto_ssp.html#Service">Service</a> to Compress
and <a href="powerdos.html#Send">Send</a> or Compress and Upload, without the SRAs and the SPAs having
to know about it.
<br>&nbsp;
</p></li>
<li><p> The protocol can be extended in many cases (e.g. with global
contacts, see 5.) without interfering with any previous
implementations and specifications.
<br>&nbsp;
</p></li>
</ul>

<p>The Server may install a cookie to indicate its presence. This
might make it possible to have the Server run without <a href="menu.html#menu_register">menu_register</a>,
which would keep it more or less completely invisible to the user.
This will prevent accidental termination of the Server (by
[Control]-clicking on its desk-menu entry) and make it work more as an
integral part of the system.
</p>
<p>The SPAs have to register with the Server. Currently, the best
way to do this seems to be at 2 different points:
</p>
<p>a. At the <a href="proto_ssp.html#SPA">SPA</a>'s first time installation
<br>b. At every startup of the <a href="proto_ssp.html#SPA">SPA</a>
</p>
<p>b is for convenience and reliability reasons. Sending a small
registration information block to the Server at any <a href="proto_ssp.html#SPA">SPA</a> startup makes
it possible, for example, to simply copy a new version of an <a href="proto_ssp.html#SPA">SPA</a> over
an old one. If the new version supports new services, the Server will
find out about this on the <a href="proto_ssp.html#SPA">SPA</a>'s startup and can automatically update
its configuration files, without the user having to mess with
anything.
</p>
<p>The user will have the possibility to switch single SPAs for
certain services on and off, for example for the Status Display
<a href="proto_ssp.html#Service">Service</a> (see sspServices.txt). Registration protocol still has to be
specified.
</p>
<h3><a name="SSP_20messages">15.10.3 SSP messages</a></h3>
<p><a href="evnt.html#Messages">Messages</a> are currently undefined. <a href="c_task_royal.html#Free">Free</a> AES message numbers
have to be found and the SSP messages defined.
</p>

<ol class="UDO_env_enumerate">
<li><p> <a href="proto_ssp.html#Service">Service</a> Requesting Application <a href="proto_ssp.html#Service">Service</a> Request
<br>&nbsp;
<a name="SSP_SRASR"></a>
<pre>#define SSP_SRASR 0x126F
<a href="proto_ssp.html#SRA">SRA</a> -&gt; Server

<a href="aes_main.html">AES</a> message-buffer:

  [0]    = SSP_SRASR
  [1]    = appl_id        - Application ID of <a href="proto_ssp.html#SRA">SRA</a>
  [2][3] = (long)dataLen  - LONG that gives length of data in the
                            shm-block
  [4]    = <a href="proto_ssp.html#dataID">dataID</a>         - Data identification (SSP_TEXT,
                            SSP_FILENAME ...)
  [5]    = shmID          - ID number for shared memory file
  Filename for shm-file is u:/shm/[applid]_data[id].ssp

  For example, if Smurf has appl_id 25, is sending a file and
  chose id 0: u:/shm/25_data0.ssp
</pre>
<br>The shm-block contains data to be transferred:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="proto_ssp.html#SSP_COMPRESSFILE">SSP_COMPRESSFILE</a>:</td>
<td valign="top"> Complete Filepath, including name and extension
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a>:</td>
<td valign="top"> Complete Filepath, including name and extension
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="proto_ssp.html#SSP_UPLOADFILE">SSP_UPLOADFILE</a>:</td>
<td valign="top"> Complete Filepath, including name and extension
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">SSP_SENDMSG:</td>
<td valign="top"> Complete text message to be sent
<br>&nbsp;

</td></tr>
</table>

<br>[4] is important to the Server. Since the <a href="proto_ssp.html#SRA">SRA</a> doesn't have any
influence on the selection of services by the user, the <a href="proto_ssp.html#SRA">SRA</a> has to
tell the Server what the <a href="magic_driveu.html#Shared_20memory">shared memory</a> block contains, so that the Server can
decide which services apply to the data, how these services are to be
handled and what to send to the <a href="proto_ssp.html#SPA">SPA</a>, especially when combining
services.
<br>&nbsp;
<br>This is all the <a href="proto_ssp.html#SRA">SRA</a> has to do. The Server will open
popups/dialog windows for choosing possible services and service
providing applications - open <a href="magic_driveu.html#Shared_20memory">shared memory</a> file with <a href="gemdos_file.html#Fcreate">Fcreate</a> and <a href="gemdos_file.html#Fcntl">Fcntl</a>,
<a href="gemdos_file.html#Fclose">Fclose</a> - send SRASR message to <a href="proto_ssp.html#SSP-Server">SSP-Server</a>
<br>&nbsp;
</p></li>
<li><p> Server <a href="proto_ssp.html#Service">Service</a> <a href="linea_init.html">Initialization</a> Request
<br>&nbsp;
<a name="SSP_SSIR"></a>
<pre>#define SSP_SSIR 0x1270
Server -&gt; <a href="proto_ssp.html#SPA">SPA</a>

<a href="aes_main.html">AES</a> message-buffer:

  [0] = SSP_SSIR
  [1] = requestID - ID of Server request (SSP_RECIPIENTS,
                                          SSP_COMPRESSFORMAT...)
  [2] = sessionID - ID of SSP session
  Filename for shm-file is u:/shm/[applID]_init[sessionID].ssp
</pre>
<br>For example, if aICQ is to send a file to another user, [1] will
contain SSP_RECIPIENTS. aICQ is then to open an shm-file with the name
built by the above conventions: u:/shm/32_init0.ssp (given aICQs
<i>appl_id</i> is 32), containing a list of recipients (nicknames)
separated by CRLF terminated by NULL. <i>requestID</i> will only
contain values for possible services for the <a href="proto_ssp.html#SPA">SPA</a>, as transmitted to
the Server upon SSP initialization (e.g. aICQ will only receive
SSP_RECIPIENTS for <a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a> and SSP_SENDMSG). The <a href="proto_ssp.html#SPA">SPA</a> has to
respond with SSP_SPASI.
<br>&nbsp;
</p></li>
<li><p> <a href="proto_ssp.html#Service">Service</a> Providing Application <a href="proto_ssp.html#Service">Service</a> <a href="linea_init.html">Initialization</a>
<br>&nbsp;
<a name="SSP_SPASI"></a>
<pre>#define SSP_SPASI 0x1271
<a href="proto_ssp.html#SPA">SPA</a> -&gt; Server

<a href="aes_main.html">AES</a> message-buffer:

  [0] = SSP_SPASI
  [1] = sessionID - ID of SSP session as given in SSP_SSIR
</pre>
<br>The Server holds the status of each session and can hence
determine by the <i>sessionID</i> the name of the shm-file to open
and the type of data that it contains.
<br>&nbsp;
<br>In the <a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a> / SSP_RECIPIENTS case, the Server will
retrieve the list of recipients from the file and open a popup/dialog,
listing them. After the user picks a recipient, the <a href="proto_ssp.html#SPA">SPA</a> will receive
SSP_SSUR:
<br>&nbsp;
</p></li>
<li><p> Server <a href="proto_ssp.html#Service">Service</a> Use Request
<br>&nbsp;
<a name="SSP_SSUR"></a>
<pre>#define SSP_SSUR 0x1272
Server -&gt; <a href="proto_ssp.html#SPA">SPA</a>

<a href="aes_main.html">AES</a> message-buffer:

  [0]    = SSP_SSUR
  [1]    = serviceID    - ID of service (e.g. <a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a>)
  [2]    = sessionID    - ID of SSP session as given in SSP_SSIR
  [3][4] = (long)initID - ID of picked initialization datum
  [5]    = shmID1       - ID 1 for shm-block
  [5]    = shmID2       - ID 2 for shm-block
  [7]    = sspPar1
  [8]    = sspPar2
</pre>
<br>The <a href="proto_ssp.html#SPA">SPA</a> can then open the file u:/shm/[shmID1]_data[shmID2].ssp
(e.g. 25_data0.ssp) and retrieve the data, <i>initID</i> is the
number of the initialization datum chosen by the user, for a ICQ
sendfile it would be the number of the recipient out of the list it
transmitted in SSP_SPASI. 1 would be the first recipient, n the n-th.
<br>&nbsp;
<br>The shm file contains:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="proto_ssp.html#SSP_COMPRESSFILE">SSP_COMPRESSFILE</a>:</td>
<td valign="top"> Complete filepath, including name and extension
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a>:</td>
<td valign="top"> Complete filepath, including name and extension
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="proto_ssp.html#SSP_UPLOADFILE">SSP_UPLOADFILE</a>:</td>
<td valign="top"> Complete filepath, including name and extension
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">SSP_SENDMSG:</td>
<td valign="top"> Complete text message to be sent
<br>&nbsp;

</td></tr>
</table>

<br><i>sspPar1</i> and <i>sspPar2</i> are parameters set by the
Server that indicate what to do. For <a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a>, both are unused.
For <a href="proto_ssp.html#SSP_COMPRESSFILE">SSP_COMPRESSFILE</a> <i>sspPar1</i> would be the ID of a <a href="magic_driveu.html#Shared_20memory">shared memory</a> file
(u:/shm/cffile[ssPar1].ssp) that contains the filename to pack the
archive to.
<br>&nbsp;
<br>For <a href="proto_ssp.html#SSP_UPLOADFILE">SSP_UPLOADFILE</a> <i>sspPar1</i> would be the ID of a shared
memory file u:/shm/uplfile[sspPar1].ssp) that contains the directory
name to upload the file to on the chosen Server (<i>initID</i>).
<br>&nbsp;
<br><b>The <a href="proto_ssp.html#SPA">SPA</a> is to copy or use the data contained in the
shm-block as quickly as possible, and then send SSP_SPASA back to the
Server. After that, the service should be performed (see also
Immediate Response and Delayed Response services!)</b>
<br>&nbsp;
</p></li>
<li><p> <a href="proto_ssp.html#Service">Service</a> Providing Application <a href="proto_ssp.html#Service">Service</a> Acknowledge
<br>&nbsp;
<a name="SSP_SPASA"></a>
<pre>#define SSP_SPASA 0x1273
<a href="proto_ssp.html#SPA">SPA</a> -&gt; Server

<a href="aes_main.html">AES</a> message-buffer:

  [0] = SSP_SPASA
  [1] = sessionID - ID of SSP session as given in SSP_SSIR
</pre>
<br>This acknowledges performing the service and closes the current
session. Finally, the Server will send SSP_SSA to the <a href="proto_ssp.html#SRA">SRA</a>, after
receiving SSP_SPASA:
<br>&nbsp;
</p></li>
<li><p> Server <a href="proto_ssp.html#Service">Service</a> Acknowledge
<br>&nbsp;
<a name="SSP_SSA"></a>
<pre>#define SSP_SSA 0x1274
Server -&gt; <a href="proto_ssp.html#SRA">SRA</a>

<a href="aes_main.html">AES</a> message-buffer:

  [0] = SSP_SSA
  [1] = <a href="proto_ssp.html#dataID">dataID</a>  - ID of data shm file as given in SSP_SRASR
</pre>
<br>This indicates that the service is performing or has been
performed, and the <a href="proto_ssp.html#SRA">SRA</a> can close and delete the <a href="magic_driveu.html#Shared_20memory">shared memory</a> file
u:/shm/[appl_id]_data[<a href="proto_ssp.html#dataID">dataID</a>].ssp (e.g. 25_data0.ssp) using <a href="gemdos_file.html#Fdelete">Fdelete</a>.
<br>&nbsp;
</p></li>
</ol>

<h3><a name="Services">15.10.4 Services</a></h3>
<p>The services are not directly requested by the <a href="proto_ssp.html#SRA">SRA</a>, but
determined by the Server, from the data identification provided by the
<a href="proto_ssp.html#SRA">SRA</a> in messagebuf[4] when sending <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a>.
</p>
<ul>
<a name="SSP_SENDFILE"></a>
<li><p> SSP_SENDFILE - <a href="powerdos.html#Send">Send</a> File <a href="proto_ssp.html#Service">Service</a>
<br>&nbsp;
<br><u>Interactive <a href="proto_ssp.html#IRS">IRS</a></u>
<br>&nbsp;
<br>Used to make a networking application send a file to a
destination (user).
<br>&nbsp;
<br>Upon sending of the <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> message from the <a href="proto_ssp.html#SRA">SRA</a> to the
Server, the <a href="magic_driveu.html#Shared_20memory">shared memory</a> block will contain a NULL-terminated filename for
the file to be sent. <a href="proto_ssp.html#dataID">dataID</a> has to be SSP_FILENAME.
<br>&nbsp;
<br>The Server will request SSP_RECIPIENTS from the <a href="proto_ssp.html#SPA">SPA</a> with
<a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>. The <a href="proto_ssp.html#SPA">SPA</a> then has to provide a shared memory block that
contains a list of possible recipients separated by CRLF terminated by
NULL with the <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a> message. The Server will open a list of the
recipients for the user to choose from.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will then receive a <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> message containing the
number of the recipient from the list in <i>ssp_par1</i>
(messagebuf[6]). The shared memory block will contain the NULL-
terminated filename of the file to be sent.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> concludingly has to send <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a> to the Server, to
close the session.
<br>&nbsp;
<br>The Server will send <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> to the <a href="proto_ssp.html#SRA">SRA</a>, indicating the service
is in progress and the shared memory file can be closed and deleted by
the <a href="proto_ssp.html#SRA">SRA</a>.
<br>&nbsp;
<br><b>Notes:</b>
<br>Synchronization of the global contacts and the local contacts of
the <a href="proto_ssp.html#SPA">SPA</a> can be done at this point.
<br>Folders: if a directory name instead of a filename is passed, the
<a href="proto_ssp.html#SPA">SPA</a> should try to send the complete file folder, including all
subdirectories and all files inside.
<br>&nbsp;
<a name="SSP_STATUSDISPLAY"></a>
</p></li>
<li><p> SSP_STATUSDISPLAY - Status Display <a href="proto_ssp.html#Service">Service</a>
<br>&nbsp;
<br><u>Invisible <a href="proto_ssp.html#IRS">IRS</a></u>
<br>&nbsp;
<br>Used to make any application (preferably those with permanent
screen displays, for example TaskBar or MultiStrip or any Desktop)
display status icons of other applications. Also see the Context <a href="xcontrol.html#Popup">Popup</a>
<a href="proto_ssp.html#Service">Service</a>, which applications providing this service should implement to
be able to request a popup menu in context to the current status from
the SDS requesting app.
<br>&nbsp;
<br>Upon sending of the <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> message, the <a href="proto_ssp.html#SRA">SRA</a>'s <a href="magic_driveu.html#Shared_20memory">shared memory</a> block
will contain icon data.
<br><b>A <i>dataLen</i> (messagebuf[2]/[3]) value of 0 (zero)
removes the icon from the status display. This has to be done before
exiting the <a href="proto_ssp.html#SPA">SPA</a>!</b>
<br><a href="proto_ssp.html#dataID">dataID</a> has to be SSP_STATUSICON.
<br>&nbsp;
<br>The Server will send <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> with SSP_SDS as <i>requestID</i>,
indicating use of the Status Display <a href="proto_ssp.html#Service">Service</a> with the application id
of the <a href="proto_ssp.html#SRA">SRA</a> in msgbuf[6] for distinguishing different SRAs on the SPAs
side (e.g. to maintain consistent status icon positions in the
display).
<br><a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> will be sent to all registered SPAs providing this
service, that are switched on for SDS by the user. <b>If
<i>requestID</i> (messagebuf[1]) is SSP_ENDSDS, the <a href="proto_ssp.html#SPA">SPA</a> has to remove
the icon referring to the status of the application with the
<i>appl_id</i> sent.</b>
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will answer with <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a> without any further
parameters.
<br>&nbsp;
<br>The Server will then send <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> containing the application ID
of the <a href="proto_ssp.html#SRA">SRA</a> in msgbuf[6]. The <a href="magic_driveu.html#Shared_20memory">shared memory</a> file will contain the icon data
(16x16) to display. If <i>requestID</i> in <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> was SSP_ENDSDS,
the shm-block contains no data! The <a href="proto_ssp.html#SPA">SPA</a> has then to remove the status
icon of the <a href="proto_ssp.html#SRA">SRA</a>.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will answer with <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a>
<br>&nbsp;
<br>The Server will send <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> to the <a href="proto_ssp.html#SRA">SRA</a>, to indicate the status
display has been updated, and the shm-file can be deleted.
<br>&nbsp;
<br><b>Notes:</b>
<br>Upon registration of the SPAs with the Server, the Server will
check if any not formerly registered apps providing the Status Display
<a href="proto_ssp.html#Service">Service</a> have registered. If so, a list of these SPAs will be presented
to the user, with the possibility to turn the status display for
single applications on and off. This makes it possible for the user to
choose where the status icons are to be displayed. SPAs that are
switched off for status display will not receive <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> messages
from the Server.
<br>&nbsp;
<a name="SSP_DISPLAYMESSAGE"></a>
</p></li>
<li><p> SSP_DISPLAYMESSAGE - Display <a href="proto_ssp.html#Message">Message</a> <a href="proto_ssp.html#Service">Service</a>
<br>&nbsp;
<br><u>Invisible <a href="proto_ssp.html#IRS">IRS</a></u>
<br>&nbsp;
<br>Used to make an application display a text message from another
application in one of their own windows. For example, messages
received in iconified aICQ windows can be sent to be displayed in
visible aIRC windows and vice versa.
<br>&nbsp;
<br>Upon sending of <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> by the <a href="proto_ssp.html#SRA">SRA</a>, the <a href="magic_driveu.html#Shared_20memory">shared memory</a> block will
contain the text to display. <a href="proto_ssp.html#dataID">dataID</a> has to be SSP_TEXT.
<br>&nbsp;
<br>The Server will send <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> with the application ID of the <a href="proto_ssp.html#SRA">SRA</a>
in msgbuf[6] to the <a href="proto_ssp.html#SPA">SPA</a>
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will answer with <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a>
<br>&nbsp;
<br>The Server will send <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> containing the application ID of
the <a href="proto_ssp.html#SRA">SRA</a> in msgbuf[6]. The shared memory block will contain the text to
display.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will display the text and answer with <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a>. It is
up to the <a href="proto_ssp.html#SPA">SPA</a> to choose one or more of its windows to display the text
in.
<br>&nbsp;
<br>The Server will send <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> to the <a href="proto_ssp.html#SRA">SRA</a>.
<br>&nbsp;
<br><b>Notes:</b>
<br>Other than with the send message service, the text message is only
to be <i>displayed</i> by the <a href="proto_ssp.html#SPA">SPA</a>, not sent over network connections
to other users.
<br>&nbsp;
<a name="SSP_SENDMESSAGE"></a>
</p></li>
<li><p> SSP_SENDMESSAGE - <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a> <a href="proto_ssp.html#Service">Service</a>
<br>&nbsp;
<br><u>Interactive <a href="proto_ssp.html#IRS">IRS</a></u>
<br>&nbsp;
<br>Used to make a (network) application post a message from another
application in one of their own windows to a certain destination. For
example, a text block selected in an editor can be sent to an online
user in aICQ or to a channel or chat in aIRC, or as an email by any
email client.
<br>&nbsp;
<br>Upon sending of <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> by the <a href="proto_ssp.html#SRA">SRA</a>, the <a href="magic_driveu.html#Shared_20memory">shared memory</a> block will
contain the text to post. <a href="proto_ssp.html#dataID">dataID</a> has to be SSP_TEXT.
<br>&nbsp;
<br>The Server will send <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> requesting SSP_RECIPIENTS to the
<a href="proto_ssp.html#SPA">SPA</a>.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will answer with <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a> providing a list of possible
destinations in shared memory (e.g. online users in aICQ or open
channels/chats in aIRC) separated by CRLF terminated by NULL. The
Server will open a list with possible destinations for the user to
choose from.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will then receive a <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> message containing the
number of the recipient from the list in <i>ssp_par1</i>
(messagebuf[6]). The shared memory block will contain a NULL-
terminated string that is the message to send.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will post the text to the chosen destination and answer
with <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a>.
<br>&nbsp;
<br>The Server will send <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> to the <a href="proto_ssp.html#SRA">SRA</a>.
<br>&nbsp;
<br><b>Notes:</b>
<br>Synchronization of global and local contacts can be done at this
point. The Server might be able to determine if the recipients are
email addresses (maybe by the SPAs registration information) and
provide a possibility to type in a new recipient for the user.
<br>&nbsp;
<a name="SSP_UPLOADFILE"></a>
</p></li>
<li><p> SSP_UPLOADFILE - Upload File <a href="proto_ssp.html#Service">Service</a>
<br>&nbsp;
<br><u>Interactive <a href="proto_ssp.html#IRS">IRS</a></u>
<br>&nbsp;
<br>Used to make a networking application (ftp client or similar)
upload a file to a destination (Server/directory).
<br>&nbsp;
<br>Upon sending of the <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> message from the <a href="proto_ssp.html#SRA">SRA</a> to the
Server, the <a href="magic_driveu.html#Shared_20memory">shared memory</a> block will contain a NULL-terminated filename for
the file to be uploaded. <a href="proto_ssp.html#dataID">dataID</a> has to be SSP_FILENAME.
<br>&nbsp;
<br>The Server will request SSP_RECIPIENTS from the <a href="proto_ssp.html#SPA">SPA</a> with
<a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>. The <a href="proto_ssp.html#SPA">SPA</a> then has to provide a shared memory block that
contains a list of possible destination Servers (from the favorites)
and a list of directories (from the favorites) with the <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a>
message:
<br>server|user|pass|directory|directory[CRLF]
<br>server|user|pass|directory|directory|directory[CRLF]
<br>server|user|pass|directory[NULL]
<br>&nbsp;
<br>The Server will open a list of the destination Servers and
directories for the user to choose from, and/or provide a text edit
field for typing in Server, directory and login/password.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will then receive a <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> message, the shared memory
block will contain the NULL-terminated filename of the file to be sent
followed by the NULL-terminated Server name, NULL- terminated
directory.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> concludingly has to send <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a> to the Server, to
close the session. The Server will send <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> to the <a href="proto_ssp.html#SRA">SRA</a>, indicating
the service is in progress and the shared memory file can be closed
and deleted by the <a href="proto_ssp.html#SRA">SRA</a>.
<br>&nbsp;
<br><b>Notes:</b>
<br>The ftp servers, directories and user/pass combinations will be
held in global contacts as well, at some point. The <a href="proto_ssp.html#SPA">SPA</a> will still
send the local favorites, and the global contacts can be synchronized
with the local contacts by the Server at this point. Newly entered
contacts can be integrated into the global contacts.
<br>&nbsp;
<br>Folders: if a directory name instead of a filename is passed,
the <a href="proto_ssp.html#SPA">SPA</a> should try to upload the complete file folder, including all
subdirectories and all files inside.
<br>&nbsp;
<a name="SSP_COMPRESSFILE"></a>
</p></li>
<li><p> SSP_COMPRESSFILE - Compress File <a href="proto_ssp.html#Service">Service</a> <u>Interactive
<a href="proto_ssp.html#DRS">DRS</a></u>
<br>&nbsp;
<br>Used to make an archiver application compress a file
<br>&nbsp;
<br>Upon sending of the <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> message from the <a href="proto_ssp.html#SRA">SRA</a> to the
Server, the <a href="magic_driveu.html#Shared_20memory">shared memory</a> block will contain a NULL-terminated filename for
the file to be compressed. <a href="proto_ssp.html#dataID">dataID</a> has to be SSP_FILENAME.
<br>&nbsp;
<br>The Server will request SSP_FORMATS from the <a href="proto_ssp.html#SPA">SPA</a> with <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>.
The <a href="proto_ssp.html#SPA">SPA</a> then has to provide a shared memory block that contains a list
of possible compression formats (for TwoInOne e.g. LZH and ZIP, GuiTar
TAR, GZ, TGZ) with a <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a> message. The Server will open a list of
the formats for the user to choose from. The <a href="proto_ssp.html#SPA">SPA</a> can also provide one
format in different versions, e.g. for compression levels ZIP low,
medium and high compression.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will then receive a <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> message containing the
number of the format from the list in <i>ssp_par1</i>
(messagebuf[6]). The shared memory block [shmID]_data.ssp will contain
the NULL- terminated filename of the file to be sent. Additionally,
the destination directory and filename for the archive will be
provided in a shm-block with the name [archiver-
appl_id]cmpname[sessionID].ssp, for example 25cmpname0.ssp, if the
archiver has <i>appl_id</i> 25.
<br>&nbsp;
<br>After finishing (!!) compression of the file, the <a href="proto_ssp.html#SPA">SPA</a> will send
<a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a>.
<br>&nbsp;
<br>The Server will send <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> to the <a href="proto_ssp.html#SRA">SRA</a>, indicating the finished
compression of the file.
<br>&nbsp;
<br><b>Notes:</b>
<br>This service is a <a href="proto_ssp.html#DRS">DRS</a>, the acknowledge message is sent by the <a href="proto_ssp.html#SPA">SPA</a>
after finished compression of the file. This is because this service
can be combined with others (<a href="powerdos.html#Send">Send</a> file or Upload file), so the archive
file might have to be used for the second service.
<br>&nbsp;
<br>Folders: if a directory name instead of a filename is passed,
the <a href="proto_ssp.html#SPA">SPA</a> should try to compress the complete file folder, including all
subdirectories and all files inside, incorpoating the directory
structure of the compression source into the compressed archive.
<br>&nbsp;
<a name="SSP_CONTEXT"></a>
</p></li>
<li><p> SSP_CONTEXT - Context <a href="xcontrol.html#Popup">Popup</a> <a href="proto_ssp.html#Service">Service</a> <u>Interactive <a href="proto_ssp.html#IRS">IRS</a></u>
<br>&nbsp;
<br>Used to make an app display a context menu in context of the
current status displayed with the Status Display <a href="proto_ssp.html#Service">Service</a> at a certain
position on screen, and react on the user's choice from the popup.
<br>&nbsp;
<br><b>This service will be requested by the application that
provides the Status Display <a href="proto_ssp.html#Service">Service</a> <a href="proto_ssp.html#SPA">SPA</a> will in this case also be <a href="proto_ssp.html#SRA">SRA</a>
and <a href="proto_ssp.html#SRA">SRA</a> also <a href="proto_ssp.html#SPA">SPA</a>.</b>
<br>&nbsp;
<br>Upon sending of the <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> message from the <a href="proto_ssp.html#SRA">SRA</a> (the SDS
providing application) to the Server, there will be no shared memory
block. <a href="proto_ssp.html#dataID">dataID</a> has to be SSP_CONTEXT. messagebuf[6] and [7] have to
contain the X- and Y-position of the mouse click, messagebuf[8] the
mouse button vector as returned from <a href="evnt.html#evnt_button">evnt_button</a> or <a href="evnt.html#evnt_multi">evnt_multi</a>.
messagebuf[9] has to contain the application ID of the application
that the status icon refers to. The <i>appl_id</i> for every icon is
sent with the Status Display <a href="proto_ssp.html#Service">Service</a>. <a href="proto_ssp.html#dataID">dataID</a> has to be
SSP_CONTEXTREQUEST.
<br>&nbsp;
<br>The Server will request SSP_POPUP from the <a href="proto_ssp.html#SPA">SPA</a> with <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> has to answer with an <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a> message. No parameters
(except <i>requestID</i> and <i>sessionID</i>) will be of any
meaning in either of the messages.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will then receive a <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> message containing the X-
position of the mouse click in messagebuf[6] and the Y-position in
messagebuf[7]. Both coordinates are screen coordinates with 0/0 in the
upper left corner. messagebuf[8] will contain the mouse button vector,
stating which button(s) have been pressed, as usually returned by the
AES evnt_xx functions. The <a href="proto_ssp.html#SPA">SPA</a> will then display its context popup,
preferably in context to the current status displayed with the Status
Display <a href="proto_ssp.html#Service">Service</a>.
<br>&nbsp;
<br>After the user has chosen a popup entry, the <a href="proto_ssp.html#SPA">SPA</a> will send
<a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a>.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SRA">SRA</a> (the Status Display <a href="proto_ssp.html#Service">Service</a> providing application) will
receive <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a>.
<br>&nbsp;
<br><b>Notes:</b>
<br>When receiving the <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> message, the application providing the
CPS (and hence requesting SDS) service, should open the context popup
as quickly as possible, to provide responsivity and reasonable user
feedback.
<br>&nbsp;
<br>The context popup should be in context to the current status
display, for example if aICQs context popup is opened, one menu entry
for connecting or disconnecting to an ICQ Server should be used,
saying 'Connect' if aICQ is disconnected, and 'Disconnect' if it is
already connected. Other possibilities would be to provide the other
user status modes (Online, Invisible, Do not disturb, etc.) in the
context popup for quick access, or an entry 'bring to top', that tops
all aICQ windows. Since the context popup is actually displayed and
handled by the application that uses the SDS, submenus and
hierarchical popups are possible and encouraged. Try to keep it
functional and easy to use, without overloading the context menus with
options. The application does not need to be fully operateable only by
the context menu, it's rather a way to make options that are
status-dependent or are frequently used accessible quickly and easily.
<br>&nbsp;
<a name="SSP_DISPLAYINFO"></a>
</p></li>
<li><p> SSP_DISPLAYINFO - Display Information <a href="proto_ssp.html#Service">Service</a> <u>Interactive
<a href="proto_ssp.html#IRS">IRS</a></u>
<br>&nbsp;
<br>Used to make an app send information (will mostly be used in
context of the current status displayed with the Status Display
<a href="proto_ssp.html#Service">Service</a>) in the form of ASCII text. Can be used, for example, if a
<a href="proto_bubblegem.html">BubbleGEM</a> event on a Status Icon occurs in TaskBar, to make the
application requesting the status display send extended information
about the current status for TaskBar to display.
<br>&nbsp;
<br>This service will probably most commonly be requested by the
application that provides the Status Display <a href="proto_ssp.html#Service">Service</a> <a href="proto_ssp.html#SPA">SPA</a> will in this
case also be <a href="proto_ssp.html#SRA">SRA</a> and <a href="proto_ssp.html#SRA">SRA</a> also <a href="proto_ssp.html#SPA">SPA</a>.
<br>&nbsp;
<br>Another possibility would be PS-Control-like applications, that
show system information about running processes (CPU and memory usage,
etc.). These could then also display information about the
application's current status. <a href="n_aes.html">N.AES</a> could use this service to display
the current status of the applications when switching apps with
[Alternate]+[<a href="VT_52_terminal.html#Tab">Tab</a>].
<br>&nbsp;
<br>Upon sending of the <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> message from the <a href="proto_ssp.html#SRA">SRA</a> (the SDS
providing application) to the Server, the <a href="magic_driveu.html#Shared_20memory">shared memory</a> block has to be a
buffer with space for the maximum size of displayable information and
read and write access rights.
<br><a href="proto_ssp.html#dataID">dataID</a> has to be SSP_INFOBUF.
<br>&nbsp;
<br>The Server will request SSP_<a href="wind.html#INFO">INFO</a> from the <a href="proto_ssp.html#SPA">SPA</a> with <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>.
<br>The <a href="proto_ssp.html#SPA">SPA</a> is to prepare the information to display (consider current
status).
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> has to answer with an <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a> message. No params
(except <i>requestID, sessionID</i>) have any meaning.
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will then receive a <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> message.
<br><b>messagebuf[7] will contain the maximum length of
information.</b> The <a href="proto_ssp.html#SPA">SPA</a> is then to copy the information to display
into the existing shared memory block provided with <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>. <b>The
<a href="proto_ssp.html#SPA">SPA</a> doesn't need to create its own shm-block.</b>
<br>&nbsp;
<br>The <a href="proto_ssp.html#SPA">SPA</a> will send <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a> <b>after copying the string to shm
and freeing temporary memory.</b>
<br>&nbsp;
<br>The <a href="proto_ssp.html#SRA">SRA</a> (e.g. the Status Display <a href="proto_ssp.html#Service">Service</a> providing application)
will receive <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a>. This indicates that the information is now in
the shared memory file provided at <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> and can be displayed, and
the shm-file deleted.
<br>&nbsp;
<br><b>Notes:</b>
<br><b>Careful with the shared memory on this one!</b> The <a href="proto_ssp.html#SRA">SRA</a> has to
create the shared memory file as <b>read/write</b>! Otherwise the <a href="proto_ssp.html#SPA">SPA</a>
might not be able to copy the information text to it, if the operating
system supports access rights for shared memory!
<br>&nbsp;
<br>Delays for the information display (e.g. showing the display
after the mouse has been over the status icon for more than 2 seconds
or so) will be handled by the <a href="proto_ssp.html#SRA">SRA</a>.
<br>&nbsp;
<br>The information display should be in context to the current
status display, for example displaying the current user status mode
(Online, Invisible, Do not disturb, etc.)
<br>&nbsp;
<br>Only display vital information, try not to overload the bubble.
Use the information to display more details about what the current
status icon means, things like that.
<br>&nbsp;
</p></li>
</ul>

<h3><a name="SSP_20Server_20registration">15.10.5 SSP Server registration</a></h3>
<p><a href="evnt.html#Messages">Messages</a> are currently undefined. <a href="c_task_royal.html#Free">Free</a> AES message numbers
have to be found and the <a href="#SSP_20messages">SSP messages</a> defined.
</p>
<p>All SPAs have to register with the Server at installation and at
every startup of the application. Here's how it works:
</p>

<ol class="UDO_env_enumerate">
<li><p> <a href="proto_ssp.html#Service">Service</a> Providing Application <a href="proto_ssp.html#Server_20registration">Server registration</a>
<br>&nbsp;
<br>#define SSP_SPASREG
<br>&nbsp;
<br>First initial message from the <a href="proto_ssp.html#SPA">SPA</a> to the Server.
<br>&nbsp;
<br>AES message-buffer:
<br>&nbsp;
<pre>  [0] = SSP_SPASREG
  [1] = appl_id           - Application ID of <a href="proto_ssp.html#SPA">SPA</a>
  [2][3] = (long)services - Long bit vector for supported services
                            (see below)
</pre>
<br>Put your application ID into messagebuf[1]. messagebuf[2]/[3] is
a 32bit LONG value that describes the services provided by the
application, composed as follows:
<br>&nbsp;
<pre>#define SSP_PSENDFILE        0x01
#define SSP_PSTATUSDISPLAY   0x02
#define SSP_PDISPLAYMESSAGE  0x04
#define SSP_PSENDMESSAGE     0x08
#define SSP_PUPLOADFILE      0x10
#define SSP_PCOMPRESSFILE    0x20
#define SSP_PCONTEXTPOPUP    0x40
#define SSP_PDISPLAYINFO     0x80
</pre>
<br>Bringing the values together composes a bit-vector that tells
the Server which services are provided. Response to this message is
SSP_SREG.
<br>&nbsp;
</p></li>
<li><p> SSP Server Registration
<br>&nbsp;
<br>#define SSP_SREG
<br>&nbsp;
<br>AES message-buffer:
<br>&nbsp;
<ul>
[0] = SSP_SREG [1] = shmID - ID of shared memory block
<br>&nbsp;
</p></li>
</ul>

<br><i>shmID</i> is identification for a shared memory block
provided by the Server with this message.
<br>&nbsp;
<br>For example, if Smurf has <i>appl_id 25</i>, the registration
shared memory block is: u:/shm/25_reg.ssp
<br>&nbsp;
<br>This shm-block provides 4096 bytes of space and is read/write.
Copy the full path and name of your application into this memory
block, terminate with CRLF and append the long application name of
your app (like used in <a href="menu.html#menu_register">menu_register</a>) and terminate with NULL again.
<b>Example:</b> d:\apps\misc\my_application.app[CRLF]My
Application[NULL]
<br>&nbsp;
<br>For the special case that your application has changed the long
app name in a new version, terminate the application name with CRLF
instead of NULL and append other possible old application names, then
terminate with NULL:
<br>&nbsp;
<br>d:\apps\misc\my_application.app[CRLF]My old application[CRLF]My
newer Application [CRLF]My current Application[NULL]
<br>&nbsp;
<br>Respond to the Server with SSP_SPARF.
<br>&nbsp;
</p></li>
<li><p> SSP <a href="proto_ssp.html#Service">Service</a> Providing Application Registration Finish
<br>&nbsp;
<br>#define SSP_SPARF
<br>&nbsp;
<br>AES message-buffer:
<br>&nbsp;
<pre>  [0] = SSP_SPARF
  [1] = appl_id           - Application ID of <a href="proto_ssp.html#SPA">SPA</a>
  [2] = version as BCD    - Version ID of <a href="proto_ssp.html#SPA">SPA</a>
</pre>
<br>Upon sending this message, the shm-block provided with SSP_SREG
must contain the full path and name of your application.
<br>&nbsp;
<br>The version ID is a binary coded decimal. For example, for
Version 1.0 of your program pass 0x0100. Version 1.01 would be 0x0101,
12.10 would be 0x1210. The version number in combination with the long
application name will provide pretty safe identifications of
applications for the Server, which will make automatic registration
and configuration update possible.
<br>&nbsp;
<br>This message closes the registration session. The Server will
take the sent data into its configuration and update existing
configurations for this application with the new one.
<br>&nbsp;
</p></li>
</ol>

<h3><a name="General_20Rules">15.10.6 General Rules</a></h3>
<ul>
<li><p> All fixed message parameters are sent in the AES
message-buffer, data and extended parameters are sent in a <a href="magic_driveu.html#Shared_20memory">shared memory</a>
block.
<br>&nbsp;
</p></li>
<li><p> There is no direct communication between <a href="proto_ssp.html#SRA">SRA</a> and <a href="proto_ssp.html#SPA">SPA</a>, the
Server handles all messages for purposes of error checking and
extending messages and parameters with Server-handled components (e.g.
providing GEM object structures for popups and similar)
<br>&nbsp;
</p></li>
<li><p> SPAs should provide services with as litle output as possible.
For example when aICQ is started by the <a href="proto_ssp.html#SSP-Server">SSP-Server</a> with a <a href="powerdos.html#Send">Send</a> File
SIR, the contact list window should stay closed and only a file
transfer window be opened (maybe configurable)
<br>&nbsp;
</p></li>
<li><p> Error-messages concerning protocol issues should be posted by
the <a href="proto_ssp.html#SRA">SRA</a>, so that the service use can be provided as completely as
possible on the <a href="proto_ssp.html#SRA">SRA</a> side without having to handle dialogs and messages
from the <a href="proto_ssp.html#SPA">SPA</a>. Timeouts on the SRAs side should depend on the service.
We will provide suggestions for error handling, timeouts and other
special cases in the final documentation. Error-messages concerning
performing the service should be posted by the <a href="proto_ssp.html#SPA">SPA</a> (e.g. file transfer
errors in aICQ).
<br>&nbsp;
</p></li>
<li><p> <b>The <a href="proto_ssp.html#SPA">SPA</a> is <i>never</i> to change data in the <a href="magic_driveu.html#Shared_20memory">shared memory</a>
blocks unless this is explicitly specified for the particular
service!</b> Keep in mind it's shared, so every change the <a href="proto_ssp.html#SPA">SPA</a> does
might apply to the <a href="proto_ssp.html#SRA">SRA</a> as well. For the current services it is
absolutely necessary that the <a href="proto_ssp.html#SPA">SPA</a> does not write to the shared memory
blocks. Exceptions from this rule so far: Display Information <a href="proto_ssp.html#Service">Service</a>.
<br>&nbsp;
</p></li>
</ul>

<p><u>Why <a href="magic_driveu.html#Shared_20memory">shared memory</a>?</u>
</p>
<p>Using shared memory for the data and parameter transfer between
<a href="proto_ssp.html#SPA">SPA</a>, Server and <a href="proto_ssp.html#SRA">SRA</a> has several reasons. There is an ongoing fight
about whether to use globally allocated memory blocks (<a href="gemdos_memory.html#Mxalloc">Mxalloc</a>) or
shared memory for data transfer. Reasons that speak for shared memory
are the following:
</p>
<ul>
<li><p> <a href="magic_driveu.html#Shared_20memory">Shared memory</a> is generally considered 'cleaner' than global
memory blocks, and it's more or less the standard way to transfer data
in memory between applications in Un*x operating systems.
<br>&nbsp;
</p></li>
<li><p> Using global memory blocks would mean that the <a href="proto_ssp.html#SRA">SRA</a> would have
to either hold all possibly transferrable data in global blocks (not
really an option), or, upon requesting a service, would have to
allocate a new global block of the size of the data, copy the data to
transfer there and free the memory block again after the service was
performed. Handling shared memory is easier, since it only consists of
an <a href="gemdos_file.html#Fcreate">Fcreate</a> and an <a href="gemdos_file.html#Fcntl">Fcntl</a> call.
<br>&nbsp;
</p></li>
<li><p> <a href="magic_driveu.html#Shared_20memory">Shared memory</a> can be declared as read-only. I'm not sure if
this is currently implemented in MiNT, but the word goes that it will
be. That means, that there will be a general protection by the
operating system on the <a href="proto_ssp.html#SRA">SRA</a>'s side against SPAs accidentally writing
into their memory blocks.
<br>&nbsp;
</p></li>
<li><p> If we have an elegant mechanism like that which also works with
MiNT and <a href="magic.html">MagiC</a>, why not use it?
<br>&nbsp;
</p></li>
</ul>

<h3><a name="Timeouts_20and_20error_20handling">15.10.7 Timeouts and error handling</a></h3>
<p>There will be no <a href="proto_ssp.html#SRA">SRA</a>-side timeouts. Timing out will be handled
completely on the Server side, because a) the <a href="proto_ssp.html#SRA">SRA</a> doesn't know about
Immediate or Delayed Response <a href="#Services">Services</a>, and b) depending on the <a href="proto_ssp.html#SPA">SPA</a>
that might have to be started first, startup time may screw up <a href="proto_ssp.html#SRA">SRA</a>-
side timeouts. Besides that, it takes even more work off the <a href="proto_ssp.html#SRA">SRA</a>'s
back ;)
</p>
<p>Timing out between <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> and <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> will be done by the
SSP- Server, with consideration of startup times and <a href="proto_ssp.html#IRS">IRS</a>/<a href="proto_ssp.html#DRS">DRS</a> cases.
The amount of time before a service times out will have to be
determined once the first Server implementations and protocol
implementations on application side are done. Approximately 3 to 5
seconds after possible startup of the <a href="proto_ssp.html#SPA">SPA</a> should be sufficient for
<a href="proto_ssp.html#IRS">IRS</a>.
</p>
<p>The Server will check all errors it can (nonexisting or empty
shm- files, etc.). If an error during a session occurs, the Server
will send <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> to the <a href="proto_ssp.html#SRA">SRA</a> to make sure the shm-file gets closed,
and then report the error in an alert box. Timeout for delayed
response services will depend on the type of service and on
Server-side determinations. For example, If the <a href="proto_ssp.html#SPA">SPA</a> knows an error
occured, it can send an error-message instead of <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a>. Still, in
case of a crash of the <a href="proto_ssp.html#SPA">SPA</a>, a timeout has to be implemented.
</p>
<p>Compress File <a href="proto_ssp.html#Service">Service</a> timeouts can be done with consideration of
the time between size changes of the archive file, opened and closed
files or memory usage of the <a href="proto_ssp.html#SPA">SPA</a>. If none of the above changes, at
some point it's safe to say that some error occured during performing
the service (probably a crash of the <a href="proto_ssp.html#SPA">SPA</a>). In this case the Server
could try to terminate what's left of the <a href="proto_ssp.html#SPA">SPA</a>, close <a href="magic_driveu.html#Shared_20memory">shared memory</a> files,
clean up and close the communication session and start the whole thing
over (Server-side retry). If that doesn't work, the Server will send
<a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> to the <a href="proto_ssp.html#SRA">SRA</a> to acknowledge and make sure the <a href="proto_ssp.html#SRA">SRA</a> frees
temporary memory and closes shared memory files, and then display an
error-message.
</p>
<h3><a name="SSP_20message_20pipeline">15.10.8 SSP message pipeline</a></h3>
<p><img src="bilder/gif/pipeline.gif" alt="" title="" border="0" width="579" height="335"></p>
<p>Every arrow is one AES message. This makes clear that there
are only 2 messages (send one, receive one) to handle for the <a href="proto_ssp.html#SRA">SRA</a>, and
only 4 (send 2, receive 2) for the <a href="proto_ssp.html#SPA">SPA</a>. The majority of the work is
done by the <a href="proto_ssp.html#SSP-Server">SSP-Server</a>. The communication is a request-response
scheme, where every message has a response from the messages'
recipient.
</p>
<h3><a name="Defines_20_28SSP_29">15.10.9 Defines (SSP)</a></h3>
<p>Provided <a href="#Services">Services</a> for <a href="proto_ssp.html#Server_20registration">Server registration</a>
</p>
<pre>#define SSP_PSENDFILE        0x01
#define SSP_PSTATUSDISPLAY   0x02
#define SSP_PDISPLAYMESSAGE  0x04
#define SSP_PSENDMESSAGE     0x08
#define SSP_PUPLOADFILE      0x10
#define SSP_PCOMPRESSFILE    0x20
#define SSP_PCONTEXTPOPUP    0x40
#define SSP_PDISPLAYINFO     0x80
</pre>
<p><a href="#Services">Services</a> for <a href="proto_ssp.html#Service">Service</a> Requesting Application <a href="proto_ssp.html#Service">Service</a> Request
</p>
<p>Same as when registering to the Server.
</p>
<pre>#define <a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a>        0x01
#define <a href="proto_ssp.html#SSP_STATUSDISPLAY">SSP_STATUSDISPLAY</a>   0x02
#define <a href="proto_ssp.html#SSP_DISPLAYMESSAGE">SSP_DISPLAYMESSAGE</a>  0x04
#define <a href="proto_ssp.html#SSP_SENDMESSAGE">SSP_SENDMESSAGE</a>     0x08
#define <a href="proto_ssp.html#SSP_UPLOADFILE">SSP_UPLOADFILE</a>      0x10
#define <a href="proto_ssp.html#SSP_COMPRESSFILE">SSP_COMPRESSFILE</a>    0x20
#define SSP_CONTEXTPOPUP    0x40
#define <a href="proto_ssp.html#SSP_DISPLAYINFO">SSP_DISPLAYINFO</a>     0x80
</pre>
<a name="dataID"></a>
<p><u>Data identification for <a href="proto_ssp.html#Service">Service</a> Requesting Application
<a href="proto_ssp.html#Service">Service</a> Request</u>
</p>
<p>messagebuf[4], identifies the type of data for the Server to
determine possible services.
</p>
<p>#define SSP_TEXT 0x01
<br>The <a href="magic_driveu.html#Shared_20memory">shared memory</a> block contains NULL-terminated ASCII text. Possible
services will be: <a href="proto_ssp.html#SSP_DISPLAYMESSAGE">SSP_DISPLAYMESSAGE</a>, <a href="proto_ssp.html#SSP_SENDMESSAGE">SSP_SENDMESSAGE</a> (sends or
displays the text directly)
<br><a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a>, <a href="proto_ssp.html#SSP_UPLOADFILE">SSP_UPLOADFILE</a>, <a href="proto_ssp.html#SSP_COMPRESSFILE">SSP_COMPRESSFILE</a> and combinations
(sends, uploads or compresses Text as file)
</p>
<p>#define SSP_FILENAME 0x02
<br>The shared memory block contains Null-terminated file path and
-name. Possible services will be: <a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a>, <a href="proto_ssp.html#SSP_UPLOADFILE">SSP_UPLOADFILE</a>,
<a href="proto_ssp.html#SSP_COMPRESSFILE">SSP_COMPRESSFILE</a> and combinations (sends, uploads or compresses file)
</p>
<p>#define SSP_STATUSICON 0x04
<br>The shared memory block contains Icon data. Possible <a href="proto_ssp.html#Service">Service</a>:
<a href="proto_ssp.html#SSP_STATUSDISPLAY">SSP_STATUSDISPLAY</a>
<br>This service will be started and performed without user
interaction. The server will, when receiving <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> with
SSP_STATUSICON as dataID, send a request for <a href="proto_ssp.html#SSP_STATUSDISPLAY">SSP_STATUSDISPLAY</a> to the
<a href="proto_ssp.html#SPA">SPA</a>.
</p>
<p>#define SSP_INFOBUF 0x08
<br>The shared memory block contains nothing but has to be a buffer
with space for the maximum length of displayable information
(determined by the <a href="proto_ssp.html#SRA">SRA</a>) and have read and write access rights..
Possible <a href="proto_ssp.html#Service">Service</a>:
<br><a href="proto_ssp.html#SSP_DISPLAYINFO">SSP_DISPLAYINFO</a>
</p>
<p>#define SSP_CONTEXTREQUEST 0x10
<br>No shared memory block has to be created. This dataID indicates
use of the Context <a href="xcontrol.html#Popup">Popup</a> <a href="proto_ssp.html#Service">Service</a>. Possible <a href="proto_ssp.html#Service">Service</a>:
<br><a href="proto_ssp.html#SSP_CONTEXT">SSP_CONTEXT</a>
</p>
<p>This makes clear that <b>the <a href="proto_ssp.html#SRA">SRA</a> usually does not request a
specific service</b>. It provides a certain type of data to the Server
(and thus to the <a href="proto_ssp.html#SPA">SPA</a>), and the Server determines which services can be
used with this type of data. In case of <a href="proto_ssp.html#SSP_CONTEXT">SSP_CONTEXT</a>, SSP_INFOBUF and
SSP_STATUSICON there is only one possible service. The Status Display,
Display Information and Context <a href="xcontrol.html#Popup">Popup</a> <a href="#Services">Services</a> are usually used in
conjunction.
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>-side definition of a data-type has the advantage that new
services can be introduced and immediately used with a new Server
release, without changes in the <a href="proto_ssp.html#SRA">SRA</a>. Also, the Server will provide the
popup menus for choosing <a href="proto_ssp.html#SPA">SPA</a> and service in context to the data
identification. For SSP_FILENAME for example, the popups could look
like this:
</p>
<div align="left"><table border="1" frame="box" class="UDO_env_table">
<tr>
  <td align="left" valign="top">System <a href="#Services">Services</a> -&gt;</td>
  <td align="left" valign="top"><a href="powerdos.html#Send">Send</a> File</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">Upload File</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">Compress File</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">Compress &amp; <a href="powerdos.html#Send">Send</a></td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">Compress &amp; Upload</td>
</tr>
</table>
</div>

<p>While for SSP_TEXT it could be like this:
</p>
<div align="left"><table border="1" frame="box" class="UDO_env_table">
<tr>
  <td align="left" valign="top">System <a href="#Services">Services</a> -&gt;</td>
  <td align="left" valign="top"><a href="powerdos.html#Send">Send</a> as message</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top"><a href="powerdos.html#Send">Send</a> as File</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">Upload as File</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">Compress as File</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">Compress &amp; <a href="powerdos.html#Send">Send</a> as File</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">Compress &amp; Upload as File</td>
</tr>
</table>
</div>

<p><u>AES message definitions</u>
</p>
<p>We reserve the messages 4719 (0x126F) to 4739 (0x128D), messages
after 0x1274 for future use.
</p>
<pre>#define <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a>  0x126F
#define <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>   0x1270
#define <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a>  0x1271
#define <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a>   0x1272
#define <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a>  0x1273
#define <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a>    0x1274
</pre>
<h3><a name="How_20to_20implement_20an_20SRA">15.10.10 How to implement an SRA</a></h3>
<p>Here's a step-by-step instruction on how to implement SSP as a
<a href="proto_ssp.html#Service">Service</a> Requesting application. All code provided here is also
available as sample code in the archive in the file SRAtools.c
(SRAtools.gfa for GFABasic, SRAtools.s for assembler). Use and modify
as necessary :)
</p>
<p><u>The data identification</u>
</p>
<p>An important thing is that the <a href="proto_ssp.html#SRA">SRA</a> does not really request or
distinguish between specific services. The <a href="proto_ssp.html#SRA">SRA</a> rather determines a
<a href="proto_ssp.html#dataID">dataID</a> depending on the user action, and the type of object the user
action leading to the use of system services was performed on, and
sends this <a href="proto_ssp.html#dataID">dataID</a> to the Server. The Server will then figure out which
services can be used with the provided data. This makes it possible to
implement new services into the <a href="proto_ssp.html#SSP-Server">SSP-Server</a> using the same data-types
without changing the SRAs.
</p>
<p><u>Communication Session</u>
</p>
<p>A second concept that should be understood is the use of
sessions. A session between an <a href="proto_ssp.html#SRA">SRA</a> and the Server is started with the
<a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> message, and ended when the <a href="proto_ssp.html#SRA">SRA</a> receives <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a>. The Server
can handle multiple sessions for one <a href="proto_ssp.html#SRA">SRA</a> and multiple SRAs at a time
(up to 32 sessions per <a href="proto_ssp.html#SRA">SRA</a> at a time, and 32 different SRAs at a time,
that's 1024 parallel <a href="proto_ssp.html#SRA">SRA</a> sessions, meaning the use of 1024 service
requests at a time, max).
</p>
<p>Every session is usually bound to a certain <a href="magic_driveu.html#Shared_20memory">shared memory</a> block that
contains the data necessary for the session. One <a href="proto_ssp.html#SRA">SRA</a> session always
refers to one service request. For this, it is necessary also that the
<a href="proto_ssp.html#SRA">SRA</a> can distinguish between different sessions. Every session has an
ID number, which also makes up the last characters of the shared
memory filename (<i>shmID</i> passed in <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a>).
</p>
<p>Multiple sessions from your application at a time can occur for
example like this:
</p>
<ul>
<li><p> AtarIRC as <a href="proto_ssp.html#SRA">SRA</a> of Status Display <a href="proto_ssp.html#Service">Service</a> sends <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> with
<a href="proto_ssp.html#dataID">dataID</a> SSP_STATUSICON to change the status display, due to starting a
dcc download from a user
<br>&nbsp;
</p></li>
<li><p> Before the Server acknowledges with <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a>, the user starts a
dcc send to another user; a second <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> message is sent, opening
a second session and hence providing a second shared memory block and
the corresponding file in u:/shm/
<br>&nbsp;
</p></li>
</ul>

<p>To implement this, a simple 32-bit bit-vector can be used to
determine if a session is active or not. Each bit represents a
possible session. Before starting a session (before sending
<a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a>), check the bits from 0 to 31. If a bit is not set, another
session can be opened. Set the bit and use the index of the bit as the
session ID (<i>shmID</i>). This code uses the global 32-bit integer
sessionVector as the indicator for active sessions, and returns the
next inactive session number, or -1, if all possible 32 sessions are
active:
</p>
<pre>long sessionVector;

int determineSessionID(void){

  int idCounter, noMoreSessions=1;

  for(idCounter=0; idCounter
    if( (sessionVector&amp;(1&lt;&amp;ltidCounter)==0 ){

      sessionVector |= (1&lt;&lt;idCounter);
      noMoreSessions = 0;
      break;
    }
  }
  if(noMoreSessions) return(-1);
  else return (idCounter);

}
</pre>
<p><u>1. Finding the Server</u>
</p>
<p>The <a href="proto_ssp.html#SRA">SRA</a> has to find the Server's <i>appl_id</i> in order to
send messages. Do this at program startup and store the application id
of the Server for later use. This is done basically the same way it is
in OLGA:
</p>
<ul>
<li><p> Read environment variable SSP_SERVERNAME to retrieve the Server
application name
<br>&nbsp;
</p></li>
<li><p> Use <a href="appl.html#appl_find">appl_find</a> to determine the Server's <i>appl_id</i>
<br>&nbsp;
</p></li>
<li><p> If the Server can't be found:
<br>&nbsp;
<ul>
<li><p> Read environment variable SSP_SERVERPATH to retrieve the Server
application's path and filename
<br>&nbsp;
</p></li>
<li><p> Start Server with <a href="shel.html#shel_write">shel_write</a>
<br>&nbsp;
</p></li>
<li><p> Read environment variable SSP_SERVERNAME to retrieve the Server
application name
<br>&nbsp;
</p></li>
<li><p> Use <a href="appl.html#appl_find">appl_find</a> to determine the Server's <i>appl_id</i>
<br>&nbsp;
</p></li>
<li><p> If the Server application is not in the specified path or if
starting fails:
<br>&nbsp;
<ul>
<li><p> output an understandable error message to the user, possibly
referring to a chapter in your application's documentation
<br>&nbsp;
</p></li>
<li><p> continue starting your application, not using SSP SSP is an
addition to the system, unavailability should not interfer with your
application's usual behaviour, except your application explicitly
requires SSP to work (complete applications of different kinds that
basically consist of an SSP <a href="proto_ssp.html#SRA">SRA</a> client are possible).
<br>&nbsp;
</p></li>
</ul>

</p></li>
</ul>

</p></li>
</ul>

<p><u>2. Using a service</u>
</p>
<p><u>2.1 Determining the data-type</u>
</p>
<p>To use a service, the <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> AES message has to be sent to
the Server. Before sending the message, determine the data-type used.
For example, if a block has been selected in an editor and the user
wants to use SSP by right clicking and choosing System <a href="#Services">Services</a> from
the context menu, or from the editor's menu bar, the data-type
(referred to as <a href="proto_ssp.html#dataID">dataID</a>) is SSP_TEXT. If for example an image file or
MP3 is to be handled via SSP, the data-type should be SSP_FILENAME.
</p>
<p>For the Status Display <a href="proto_ssp.html#Service">Service</a>, the data-type has to be
SSP_STATUSICON. This service should be initialized automatically,
without user interaction, after the Server has been started, at
program startup. See also 'Data identification' for <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> for
short explanations of the data-types and the corresponding data in the
<a href="magic_driveu.html#Shared_20memory">shared memory</a> block.
</p>
<p><u>2.2 Requesting a service</u>
</p>
<p><u>2.2.1 Creating shared memory file</u>
</p>
<p>Data is sent in a shared memory file. Whether one has to be
created or not depends on the <a href="proto_ssp.html#dataID">dataID</a> (thus on the service type). There
is a unique ID for every shm-file used for each service request, and
the name of the file is built by the following conventions:
u:/shm/[appl_id]_data[shmID].ssp For example if Smurf with
<i>appl_id</i> 25 is sending a file and chose ID 0:
u:/shm/25_data0.ssp
</p>
<p>The shared memory ID is vital to the Server, because it is used
to distinguish between different service requests and <a href="proto_ssp.html#SRA">SRA</a>
communication sessions that are 'alive' at the same time. A session is
'alive' between the sending of <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> and receiving <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a>. For
example, the user could make your application request <a href="powerdos.html#Send">Send</a> File
<a href="proto_ssp.html#Service">Service</a>, while you haven't gotten the <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> response for the
SSP_STATUSICON request. This would make you open a second session, and
a second shared memory file, while the session for the status display
is still alive.
</p>
<p>There are two different ways to handle this: 1. <a href="powerdos.html#Wait">Wait</a> until the
<a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> response for one request has come in before sending the second
request
</p>
<p>2. Keep track of sent requests and received responses. Make an
array, the index being the number of the request sent (which can be
the <i>shmID</i> as well), and set the array value to 1 if a request
has been sent. If <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> comes in, set the referring array value to
0. Use only indices (<i>shmID</i>s) if the array value is 0.
</p>
<p>The second way is recommended.
</p>
<p>After you have built the name for the shared memory file, use
<a href="gemdos_file.html#Fcreate">Fcreate</a> to create the file. Read/Write access rights have to be set
correctly, depending on the request type!
</p>
<p>Then, bind the memory block that contains the data (text,
filename, icon data, etc., depending on <a href="proto_ssp.html#dataID">dataID</a>) to the file using
<a href="gemdos_file.html#Fcntl">Fcntl</a>. Close the file with <a href="gemdos_file.html#Fclose">Fclose</a>. The following code calls the above
routine detemineSessionID, uses the returned ID to build the filename
and creates the file. The function openSession takes two
<b>parameters:</b> <i>access</i> describes the access rights to the
memory block, and <i>*memPtr</i> is a pointer to the memory block to
share. buildFilename takes a determined session ID as parameter,
builds a filename from it and returns a pointer to the static string
containing the filename. buildFileName assumes <i>appl_id</i> being
the <a href="proto_ssp.html#SRA">SRA</a>'s (your) application ID available as a global variable!
</p>
<pre>int openSession(int access, void *memPtr)
{
  int fHandle;
  int sessionID = determineSessionID();
  char *filename = buildFileName(sessionID);

  fHandle = <a href="gemdos_file.html#Fcreate">Fcreate</a>(filename, access);
  <a href="gemdos_file.html#Fcntl">Fcntl</a>(fHandle, memPtr, <a href="gemdos_file.html#SHMSETBLK">SHMSETBLK</a>);

  return(sessionID);
}

char *buildFilename(int sessionID)
{
  static char filename[256] = &quot;u:/shm/&quot;;
  char tmpstring[4];

  strcat(&amp;filename, itoa(appl_id, tmpstring, 10));
  strcat(&amp;filename, &quot;_data&quot;);
  strcat(&amp;filename, itoa(sessionID, tmpstring, 10));
  strcat(&amp;filename, &quot;.ssp&quot;);

  return(&amp;filename);
}
</pre>
<p>The return value of openSession is the new <i>sessionID</i>
which can be used to pass to the Server in the service request. The
filename could also be stored, but that's not really necessary because
the Server passes the <i>shmID</i> that it received from the <a href="proto_ssp.html#SRA">SRA</a> back
to it, in the <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a> acknowledge message, so the filename can be
built again to delete the file.
</p>
<p><u>2.2.2 Sending a <a href="proto_ssp.html#Service">Service</a> Request</u>
</p>
<p><a href="powerdos.html#Send">Send</a> an <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> message to the Server, filling the AES
message- buffer with the following values:
</p>
<pre>    [0] = <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a>
    [1] = appl_id
    [2][3] = (long)dataLen
    [4] = <a href="proto_ssp.html#dataID">dataID</a>
    [5] = shmID
</pre>
<p><i>appl_id</i> (messagebuf[1])
<br>This is your <i>appl_id.</i> Make sure to fill this correctly,
because the Server will distinguish different <a href="proto_ssp.html#SRA">SRA</a>-communication
sessions by the application IDs of the SRAs.
</p>
<p><i>dataLen</i> (messagebuf[2]/[3])
<br>The length of the data to transfer (32 bit!). For example the
length of the string to send if <a href="proto_ssp.html#dataID">dataID</a> is SSP_TEXT or SSP_FILENAME, or
the length of the icon data in the SSP_STATUSICON case.
<br>messagebuf[2] holds the upper 16 bits, [3] the lower 16 bits:
<br>messagebuf[2] = (int)(dataLen&gt;&gt;16);
<br>messagebuf[3] = (int)(dataLen&amp;0xFFFF);
</p>
<p><i><a href="proto_ssp.html#dataID">dataID</a></i> (messagebuf[3])
<br>The identification value of the data you determined, for the
Server to find out which services can be possibly used.
</p>
<p><i>shmID</i> (messagebuf[4])
<br>The identification number for the <a href="magic_driveu.html#Shared_20memory">shared memory</a> block (your session ID).
This is absolutely necessary for the Server to distinguish different
sessions with one <a href="proto_ssp.html#SRA">SRA</a>.
</p>
<p>If the Server is in debug mode (environment variable
SSP_SERVERDEBUG is defined), it will print out all information
received from the <a href="proto_ssp.html#SRA">SRA</a> in an understandable form into a window, and
write it to a logfile sspdebug.log in the same directory the Server
application is in. It will post error-messages and possible
suggestions on how to fix the error in both the window and the log
file.
</p>
<p><u>3. Closing a session on <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a></u>
</p>
<p>When your application receives <a href="proto_ssp.html#SSP_SSA">SSP_SSA</a>, this means that a
service has been performed (<a href="proto_ssp.html#DRS">DRS</a>), or has been started to be performed
(<a href="proto_ssp.html#IRS">IRS</a>).
</p>
<p>messagebuf[1] will contain the <i>shmID</i> you passed to the
Server in <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a>. This makes it possible for you to find out which
session the response is for. Build a filename like in 2.2.1 (or store
the filename when sending <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a>) and delete the <a href="magic_driveu.html#Shared_20memory">shared memory</a> file, free
all temporary memory you have possibly allocated for the service
request, and you're done. The following code uses the above function
buildFilename and the <i>sessionID</i> from messagebuf[1] as a
parameter to build a filename, delete the shm-file, and clear the bit
of the session in the global sessionVector variable:
</p>
<pre>int closeSession(int sessionID){

  char *fileName = buildFilename(sessionID);
  return <a href="gemdos_file.html#Fdelete">Fdelete</a>(fileName);
  sessionVector &amp;= ~(1-sessionID);

}
</pre>
<p>Don't forget to free temporary memory that you might have
allocated to compose the data. You could also store the memory pointer
for each session in an array of pointers and implement the <a href="gemdos_memory.html#Mfree">Mfree</a>/free
into the closeSession function. NULL pointers in the array could
indicate that no temporary buffer was allocated (e.g. when you share
your internal buffers for filenames, text or other data, directly).
This could be done by adding a parameter <i>tmpFlag</i> to the
openSession function that indicates if <i>memPtr</i> is a temporary
buffer. openSession could then automatically insert <i>memPtr</i> or
NULL at the appropriate position in a global array, one entry for
every session, with sessionID as the index. closeSession could then
get the pointer from the array at the index of its parameter
<i>sessionID</i> and perform <a href="gemdos_memory.html#Mfree">Mfree</a> on the pointer, if it's not NULL.
This would automate and connect the processes of opening and closing
sessions internally, creating and deleting <a href="magic_driveu.html#Shared_20memory">shared memory</a> files, and freeing
possible temporary buffers.
</p>
<p><u>4. The different dataIDs and their impact on sessions</u>
</p>
<p><u>4.1 SSP_STATUSICON request and the Status Display
<a href="proto_ssp.html#Service">Service</a></u>
</p>
<p>The dataIDs have an influence on how a session and service is
handled internally. For SSP_TEXT and SSP_FILENAME, you don't have to
worry about it, just go by the above scheme. For SSP_STATUSICON
however, there is a twist. The status icon will be displayed by all
applications that are switched on for Status Display <a href="proto_ssp.html#Service">Service</a>. The
service is invisible, meaning it won't be triggered by a user action
rather than automatically, on program startup and anytime the status
of your program changes. When that happens, and you want to display a
different status icon, you have to send another request with
SSP_STATUSICON as <a href="proto_ssp.html#dataID">dataID</a>. All 'on' applications for Status Display
<a href="proto_ssp.html#Service">Service</a> will then update the icon they display for your application's
status.
</p>
<p>When you exit your application and have sent a service request
with SSP_STATUSICON, you have to inform the Server that your status
icon is to be removed from all displaying applications! Implement a
service request with the <a href="proto_ssp.html#dataID">dataID</a> SSP_ENDSDS into the exit code of your
application. The Server will then inform all applications that display
your status icon that the icon has to be removed.
</p>
<p>A nice idea would be to display the download status of internet
applications in the status icon, by making the icon a 16 pixel high or
wide progress bar. Update the status icon every time enough data has
been downloaded to fill another pixel line of the progress bar, and
there you go. Memory could be saved, if necessary, by updating the
icon data dynamically instead of including a separate icon for every
progress bar phase.
</p>
<p><u>4.2 Requesting SSP_STATUSICON will make your <a href="proto_ssp.html#SRA">SRA</a> an <a href="proto_ssp.html#SPA">SPA</a></u>
</p>
<p>Applications that provide Status Display <a href="proto_ssp.html#Service">Service</a> will usually be
able to request the <a href="proto_ssp.html#SSP_DISPLAYINFO">SSP_DISPLAYINFO</a> and SSP_CONTEXTPOPUP services.
This means that if you request service with SSP_STATUSICON as <a href="proto_ssp.html#dataID">dataID</a>,
you will probably receive a request for <a href="proto_ssp.html#SSP_DISPLAYINFO">SSP_DISPLAYINFO</a> or
SSP_CONTEXTPOPUP at some point! Look at <a href="#How_20to_20implement_20an_20SPA">How to implement an SPA</a> on how
to provide the Display Information and Context <a href="xcontrol.html#Popup">Popup</a> services.
</p>
<p><u>4.3 The icon data</u>
</p>
<p>The icon data has to be put into the shm-block as follows:
</p>
<pre>  mono_icon1 monomask1
  [16col_icon1 16colmask1]
  [256col_icon1 256colmask1]
  [CRLF]
  [mono_icon2 monomask2]
  [16col_icon2 16colmask2]
  [256col_icon2 256colmask2]
  NULL
</pre>
<p>Entries in [] are optional. That means the <a href="proto_ssp.html#SRA">SRA</a> has to send at
least one monochrome status icon and its mask. The application
providing the status display will pick the icon best for the current
screen colour depth. The mask data directly follows the icon data
without any separation! The spaces above are just for readability. All
mask data is 1 bit, as provided by the GEM ICNBLK and CICNBLK
structures. The <i>xx_icon2</i> data blocks are optional second icons
for animation. The <a href="proto_ssp.html#SPA">SPA</a> will read, if provided, both icon data blocks
for the current screen mode and switch in 1 second intervals between
the 2 icon blocks. This is useful to make status changes noticeable.
To make the 'blinking' animation stop, send another service request
with SSP_STATUSICON and only the <i>xx_icon1</i> icon data. Blinking
should be done for no longer than 8 seconds, after that the second
status display request should be performed by your application to
switch to a static icon. The data should be in the regular screen
format, meaning you should incorporate possible status icons in your
application's resource file, and copy the raw graphics data from the
icon objects into the memory block that will be shared, one after
another, and terminate with a NULL byte. The icons must have 16x16
pixel dimensions. A good approach would be to have the status icons in
every available colour depth in the above format ready in each a
memory block, to be able to request the service without having to copy
around icon data. That makes the interactions between <a href="proto_ssp.html#SRA">SRA</a> and <a href="proto_ssp.html#SPA">SPA</a>
quicker and saves the hassle of building memory blocks before every
request. Memory saving is not really an issue here, as one icon in all
3 colour depths uses just 512 bytes, so even keeping 20 different
icons in all 3 colour depths, and their 2-phase animated pendants, in
memory, would only cost 30 kBytes. This can be reduced to 20 kBytes by
just keeping the 2-phase versions in memory and inserting NULL or CRLF
at the middle position to switch between animated and static versions.
Usually it will be less, because 256-colour icons will rarely be
needed at 16x16 pixels size. And, which application really has 20
different statii?
</p>
<p><u>5. Guidelines for implementing SPAs</u>
</p>
<ul>
<li><p> Make your icons for the Status Display <a href="proto_ssp.html#Service">Service</a> distinguishable
(so people can see it is this specific application's status icon) and
recognizeable (so the user doesn't have to wonder 'what the heck is
that supposed to be?').
<br>&nbsp;
</p></li>
<li><p> Use status icons intelligent and carefully. There is no point
in displaying a different status for an operation that only takes 1/10
second.
<br>&nbsp;
</p></li>
<li><p> The SSP protocol is rather easy to implement on <a href="proto_ssp.html#SRA">SRA</a> side. Try
to make the implementation as transparent to the user as possible,
without the user noticing much of the different applications and
processes involved.
<br>&nbsp;
</p></li>
<li><p> Request invisible services like Status Display really
invisible, without any direct output to or input from the user.
<br>&nbsp;
</p></li>
<li><p> After implementing SSP, switch the server into debug mode and
try requesting different services with different data types. If
everything works and the server outputs no error or warning messages,
your implementation is OK.
<br>&nbsp;
</p></li>
<li><p> Remember, the user doesn't care much about how it works, only
<i>that</i> it works.
<br>&nbsp;
</p></li>
</ul>

<h3><a name="How_20to_20implement_20an_20SPA">15.10.11 How to implement an SPA</a></h3>
<p>Here's a step-by-step instruction on how to implement SSP as a
<a href="proto_ssp.html#Service">Service</a> providing application. All code provided here is also
available as sample code in the archive in the file SPAtools.c
(SPAtools.gfa for GFABasic, SPAtools.s for assembler). Use and modify
as necessary :)
</p>
<p><u>Communication Session</u>
</p>
<p>Make sure you understand the concept of SSP <a href="proto_ssp.html#SPA">SPA</a>-sessions. A
session between an <a href="proto_ssp.html#SPA">SPA</a> and the Server is started with the <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>
message, and ended when the <a href="proto_ssp.html#SPA">SPA</a> sends <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a>. For every <a href="proto_ssp.html#SPA">SPA</a> there
will only be one session at a time. Multiple service requests by SRAs
will be queued, and sent one after another. This might be changed in
future implementations because of not being able to perform another
service while a session is active, which is a drawback in case of
Delayed Response services.
</p>
<p><b>1. Receiving <a href="proto_ssp.html#Service">Service</a> <a href="linea_init.html">Initialization</a> Request and determining
the information type</b>
</p>
<p>The <a href="proto_ssp.html#SPA">SPA</a> (your application) will receive the <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> message to
indicate use of a service your application provides. The Server knows
the services provided by your application from the Server
registration, so you will only receive requests for services you
actually provide. The message-buffer with <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>:
</p>
<pre>  [0] = <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>
  [1] = serviceID
  [1] = requestID
  [2] = sessionID
</pre>
<p><i>serviceID</i> (messagebuf[1]) is the requested service. This
in conjunction with <i>requestID</i> will give your application an
idea as of which information to provide.
</p>
<p><i>requestID</i> (messagebuf[2]) is an identification that
tells you which information to provide to the Server. For example, if
<a href="powerdos.html#Send">Send</a> File <a href="proto_ssp.html#Service">Service</a> has been requested by the user, you will receive
SSP_RECIPIENTS as <i>requestID.</i> Build a list of possible
recipients (depending on the type of your application) separated by
CRLF, terminated by NULL. If your application is an IRC Client for
example, provide a list of online users that can currently be seen in
open channels. For an email Client, provide a list of email addresses
from your favorites. Provide only users that can be actually reached
at the time; in IRC or ICQ, for example, provide only online users.
For a <a href="proto_ssp.html#SSP_DISPLAYMESSAGE">SSP_DISPLAYMESSAGE</a> service as <i>serviceID</i>, if your
application is an IRC Client, say, provide a list of open channels and
open chats.
</p>
<p><i>sessionID</i> is used to distinguish between multiple
sessions. For now, this will always be 0.
</p>
<p><b>2. Initializing the service and providing information</b>
</p>
<p><u>2.1 Creating a shared memory file</u>
</p>
<p>The information the Server has requested is sent by your
application in a <a href="magic_driveu.html#Shared_20memory">shared memory</a> file. Whether one has to be created or not
depends on the <i>serviceID.</i> There is a unique name for every
shm-file used for each service request, the name of the file is built
by the following conventions:
<br>u:/shm/[applID]_init[sessionID].ssp
<br>For example, if your application has <i>appl_id</i> 25 and
<i>sessionID</i> is 0:
<br>u:/shm/25_init0.ssp
</p>
<p>After you have built the name for the shared memory file, use
<a href="gemdos_file.html#Fcreate">Fcreate</a> to create the file. Read/Write access rights have to be set
correctly, depending on the request type!
<br>Then, bind the memory block that contains the requested
information (list of recipients, etc., depending on <i>requestID</i>
and <i>serviceID</i>) to the file using <a href="gemdos_file.html#Fcntl">Fcntl</a>. The following code
will build the filename and open an initialization data shared memory
file when calling createShmFile:
</p>
<pre>    int createShmFile(int access, void *memPtr, int sessionID){

      int fHandle;
      char *filename = buildInitFilename(sessionID);

      fHandle = <a href="gemdos_file.html#Fcreate">Fcreate</a>(filename, access);
      <a href="gemdos_file.html#Fcntl">Fcntl</a>(fHandle, memPtr, <a href="gemdos_file.html#SHMSETBLK">SHMSETBLK</a>);

      return(fHandle);

    }

    char *buildInitFilename(int sessionID){

      static char filename[256] = &quot;u:/shm/&quot;;
      char tmpstring[4];

      strcat(&amp;filename, itoa(appl_id, tmpstring, 10));
      strcat(&amp;filename, &quot;_init&quot;);
      strcat(&amp;filename, itoa(sessionID, tmpstring, 10));
      strcat(&amp;filename, &quot;.ssp&quot;);

      return(&amp;filename);

    }
</pre>
<p><u>2.2.2 Sending <a href="proto_ssp.html#Service">Service</a> <a href="linea_init.html">Initialization</a> </u>
</p>
<p><a href="powerdos.html#Send">Send</a> an <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a> message to the Server, filling the AES
message- buffer with the following values:
</p>
<pre>    [0] = <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a>
    [1] = sessionID
</pre>
<p><i>sessionID</i>(messagebuf[1])
<br>The session ID sent to you with <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>.
</p>
<p><b>3. Receiving <a href="proto_ssp.html#Service">Service</a> Use Request</b>
</p>
<p>When your application receives <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a>, this means that a
service should be performed now.
</p>
<p>messagebuf[1] will contain the <i>serviceID</i> also received
in <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>. This makes it possible for you to keep initializing and
performing services separate from one another. The <i>serviceID</i>
will be the same throughout one session.
</p>
<p>messagebuf[2] will contain the same <i>sessionID</i> as in
<a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a>.
</p>
<p>messagebuf[3]/[4] will build a LONG that is the number of the
information part of all the parts you provided in <a href="proto_ssp.html#SSP_SPASI">SSP_SPASI</a>. For
example, if you have sent 10 recipients for a <a href="powerdos.html#Send">Send</a> File <a href="proto_ssp.html#Service">Service</a>
request, and this LONG is 0, the first recipient in the list is to
receive the file.
</p>
<p>messagebuf[5] and messagebuf[6] contain 2 different ID numbers
for a <a href="magic_driveu.html#Shared_20memory">shared memory</a> file, <i>shmID1</i> and <i>shmID2.</i> Build a filename
like this:
<br>u:/shm/[shmID1]_data[shmID2].ssp For example, if <i>shmID1</i> is
25 and <i>shmID2</i> is 0: u:/shm/25_data0.ssp
<br>This is the file that contains the data necessary to perform the
service. The contents of the shared memory block depend on
<i>serviceID</i>:
</p>
<p><a href="proto_ssp.html#SSP_SENDFILE">SSP_SENDFILE</a>, <a href="proto_ssp.html#SSP_UPLOADFILE">SSP_UPLOADFILE</a>, <a href="proto_ssp.html#SSP_COMPRESSFILE">SSP_COMPRESSFILE</a>: the shm-block
will contain a NULL-terminated file path and name.
</p>
<p>SSP_SENDMSG, SSP_DISPLAYMSG: the shm-block will contain a NULL-
terminated string to display or send.
</p>
<p><a href="proto_ssp.html#SSP_DISPLAYINFO">SSP_DISPLAYINFO</a>: the shm-block will be an empty buffer with
space for information about your current status with read/write access
rights. Copy NULL-terminated text information into the shm-block. The
maximum length will be in <i>shmPar1</i> (messagebuf[7])!
</p>
<p><a href="proto_ssp.html#SSP_CONTEXT">SSP_CONTEXT</a>: no shared memory file will exist. Don't try to open
it ;)
</p>
<p><a href="proto_ssp.html#SSP_STATUSDISPLAY">SSP_STATUSDISPLAY</a>: the shm-block will contain icon data.
</p>
<p>The following code will build the filename, open the data shared
memory file and return a pointer to the shm-block when calling
openDataShm. The parameter access should be either FO_READ or
FO_WRITE, depending on what the <i>serviceID</i> is:
</p>
<pre>    void *openDataShm(int shmId1, int shmId2, int access){

      int fHandle;
      char *filename = buildDataFilename(shmId1, shmId2);

      fHandle = <a href="gemdos_file.html#Fopen">Fopen</a>(filename, access);
      <a href="gemdos_file.html#Fcntl">Fcntl</a>(fHandle, memPtr, <a href="gemdos_file.html#SHMGETBLK">SHMGETBLK</a>);

      return(fHandle);

    }

    char *buildDataFilename(int shmId1, int shmId2){

      static char filename[256] = &quot;u:/shm/&quot;;
      char tmpstring[4];

      strcat(&amp;filename, itoa(shmId1, tmpstring, 10));
      strcat(&amp;filename, &quot;_init&quot;);
      strcat(&amp;filename, itoa(shmId2, tmpstring, 10));
      strcat(&amp;filename, &quot;.ssp&quot;);

      return(&amp;filename);

    }
</pre>
<p>Remember to close the <a href="magic_driveu.html#Shared_20memory">shared memory</a> file as soon as you don't need to
read from or write to it any more (before acknowledging the Server)
with <a href="gemdos_file.html#Fclose">Fclose</a>! Delete the initialization shm-file when receiving
<a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> and free temporary memory, if any!
</p>
<p><b>4. Performing the <a href="proto_ssp.html#Service">Service</a> and acknowledging</b>
</p>
<p><u>4.1 Performing the <a href="proto_ssp.html#Service">Service</a></u>
</p>
<p>Depending on the parameters sent in <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> you can determine
what to do. Ultimately the way your application performs certain
services is up to you, and also depends on the type of your
application. See 'Guidelines for performing services' for a general
direction to go to.
</p>
<p><u>4.2 Acknowledging</u>
</p>
<p>Acknowledging a service is done by sending <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a> to the
Server. When you do this depends on your application and on the type
of service (<a href="proto_ssp.html#IRS">IRS</a> or <a href="proto_ssp.html#DRS">DRS</a>). With Immediate Response <a href="#Services">Services</a>, you should
start performing the service (e.g. open a connection to a user and
start sending a file) and acknowledge before the service is actually
finished.
</p>
<p>With Delayed Response <a href="#Services">Services</a> (e.g. the Compress File <a href="proto_ssp.html#Service">Service</a>)
acknowledging should not be done before the service is completely
performed (e.g. the files are compressed).
</p>
<p><b>5. Guidelines for performing services</b>
</p>
<p><u>5.1 <a href="powerdos.html#Send">Send</a> File <a href="proto_ssp.html#Service">Service</a></u>
</p>
<p><b>For online Clients like IRC and ICQ:</b>
<br>When receiving <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> with SSP_RECIPIENTS, only provide online
users that a file can actually be sent to in the recipients list.
After opening a connection and starting to send the file, acknowledge
immediately.
</p>
<p><b>For email and news Clients:</b>
<br>In the recipient information, provide recipients from your
favorites. Encode the file into an attachment, and open an email
editor window for typing in text. Make sure the received attachment
and the typed email go out together.
</p>
<p><u>5.2 <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a> <a href="proto_ssp.html#Service">Service</a></u>
</p>
<p><b>For online Clients like IRC and ICQ:</b>
<br>For SSP_RECIPIENTS, provide a list only of open chats or chat
channels. Receive the message and post it to the user. Acknowledge
immediately.
</p>
<p><b>For email and news Clients:</b>
<br>Receive the message and put it into an email as text.
Configurably, post an alert box to provide the possibility to edit the
message and add attachments for the user. Only open the email editor
window if the user answers this question with 'Yes'. Acknowledge as
soon as the user has answered the question. If this security request
is turned off, send immediately.
</p>
<p><u>5.2 Display <a href="proto_ssp.html#Message">Message</a> <a href="proto_ssp.html#Service">Service</a></u>
</p>
<p><b>For online Clients like IRC and ICQ:</b>
<br>You will not receive SSP_RECIPIENTS. This service can be triggered
with user interaction as well as automatically. Decide in which window
of your application to display the message. Prefer topped,
uniconified, unshaded, visible windows. Do not send the text message
over network connections.
</p>
<p><b>For email and news Clients, text editors and similar:</b>
<br>You will not receive SSP_RECIPIENTS. Insert the text message into
the currently top open email editor window. If none is open, open one
with no recipient and insert the message there.
</p>
<p><u>5.3 Upload File <a href="proto_ssp.html#Service">Service</a></u>
</p>
<p><b>For FTP Clients:</b>
<br>Provide a list of recipients in shm as described here. Retrieve
the Server and directory name from the shm-block provided with
<a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a>, and upload the file. Acknowledge after opening the
connection and starting to upload.
</p>
<p><u>5.4 Status Display <a href="proto_ssp.html#Service">Service</a></u>
</p>
<p>Retrieve the icon data, copy it into your own buffers. Display
new icon. Acknowledge.
</p>
<p><u>5.5 Display Information <a href="proto_ssp.html#Service">Service</a></u>
</p>
<p>Copy information text, NULL terminated, to the shm-block
provided. Acknowledge.
</p>
<p>5.6 Context <a href="xcontrol.html#Popup">Popup</a> <a href="proto_ssp.html#Service">Service</a>
</p>
<p>Retrieve coordinates for the context popup from the
message-buffer. Open context popup in context to the current status
icon from the Status Display <a href="proto_ssp.html#Service">Service</a>. Make frequently used and status
dependend options available in the context popup. Make all information
available in the context popup also available directly by your
application! The context popup is never to supersede generally
available options!
</p>
<p><u>5.7 Compress File <a href="proto_ssp.html#Service">Service</a></u>
</p>
<p>Provide different archive types and compression levels after
receiving SSP_FORMATS. Use the format number contained in
<i>sspPar1</i> at <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a>. If <i>sspPar1</i> is -1, use default
format and compression level. Retrieve file or folder names to
compress. Archive files to provided archive name and -path.
Acknowledge after compression and archiving is finished.
</p>
<p><u>5.8 General</u>
</p>
<ul>
<li><p> Try to make performing services transparent to the user. When
started from the Server (your commandline will be 'SSP_START'), don't
open any unnecessary windows, try to restrict the screen output to
what is necessary for performing the service. If you're started with
'SSP_START' in your commandline, wait 3 seconds after performing your
service, and then exit. Chances are that queued requests will come
through in this time, and if not, chances are the user doesn't need
your application anymore for now ;)
<br>Exit without any screen output and user input, unless it's
absolutely inevitable!
<br>&nbsp;
</p></li>
<li><p> After implementing SSP, switch the Server into debug mode and
try requesting your provided services with different applications. If
everything works and the Server outputs no error or warning messages,
your implementation is OK.
<br>&nbsp;
</p></li>
<li><p> Remember, the user doesn't care much about how it works, only
<i>that</i> it works.
<br>&nbsp;
</p></li>
</ul>

<h3><a name="List_20of_20prospective_20SSP-implementing_20software_20to_20date">15.10.12 List of prospective SSP-implementing software to date</a></h3>
<p><b>AtarICQ </b>
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>: Status Display, Display <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a>
<br><a href="proto_ssp.html#SPA">SPA</a>: Context <a href="xcontrol.html#Popup">Popup</a>, Display Information, <a href="powerdos.html#Send">Send</a> File, Display
<a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a>
</p>
<p><b>AtarIRC </b>
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>: Status Display, Display <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a>
<br><a href="proto_ssp.html#SPA">SPA</a>: Context <a href="xcontrol.html#Popup">Popup</a>, Display Information, <a href="powerdos.html#Send">Send</a> File, Display
<a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a>
</p>
<p><b>EditorLib </b>
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>: Display <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> (text as) File, Upload
(text as) File, Compress File
<br><a href="proto_ssp.html#SPA">SPA</a>: Display <a href="proto_ssp.html#Message">Message</a>
</p>
<p><b>GuiTar </b>
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>: <a href="powerdos.html#Send">Send</a> File, Upload File
<br><a href="proto_ssp.html#SPA">SPA</a>: Compress File
</p>
<p><b>Smurf </b>
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>: <a href="powerdos.html#Send">Send</a> File, Upload File, Compress File
</p>
<p><b>TaskBar </b>
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>: Context <a href="xcontrol.html#Popup">Popup</a>, Display Information
<br><a href="proto_ssp.html#SPA">SPA</a>: Status Display
</p>
<p><b>TextView </b>
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>: Display <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> (text as) File, Upload
(text as) File, Compress File, <a href="powerdos.html#Send">Send</a> File
<br><a href="proto_ssp.html#SPA">SPA</a>: Display <a href="proto_ssp.html#Message">Message</a>
</p>
<p><b>ACSPro </b>
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>: Display <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> (text as) File, Upload
(text as) File,
<br><a href="proto_ssp.html#SPA">SPA</a>: Display <a href="proto_ssp.html#Message">Message</a>
<br>All applications built with ACSPro could provide SSP support
generated by ACSPro.
</p>
<p><b>FalcAmp </b>
</p>
<p><a href="proto_ssp.html#SRA">SRA</a>: Display <a href="proto_ssp.html#Message">Message</a>, <a href="powerdos.html#Send">Send</a> File, Upload File, Compress File
</p>
<h3><a name="Glossary">15.10.13 Glossary</a></h3>
<table class="UDO_env_blist">
<a name="SRA"></a>
<tr><td nowrap="nowrap" valign="top"><b>SRA</b></td>
<td valign="top"> Service Requesting Application. This means the application that
sends <a href="proto_ssp.html#SSP_SRASR">SSP_SRASR</a> to the Server to request use of a service.
<br>&nbsp;
<a name="SPA"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>SPA</b></td>
<td valign="top"> Service Providing Application. This means the application that
receives <a href="proto_ssp.html#SSP_SSIR">SSP_SSIR</a> from the Server to indicate that an SRA has
requested a service. All SPAs have to register with the SSP-Server.
<br>&nbsp;
<a name="Service"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>Service</b></td>
<td valign="top"> is a certain part of an applications functionality or
capability that can be provided to, and used by, other applications
using SSP. Generalized types of services are hardwired into the
SSP-Server. See <a href="#Services">SSP services</a>.
<br>&nbsp;
<a name="IRS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>IRS</b></td>
<td valign="top"> Immediate Response Service. This means a service that requires
virtually immediate response to <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> from the Server, with
<a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a>.
<br>&nbsp;
<a name="DRS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>DRS</b></td>
<td valign="top"> Delayed Response Service. This means a service that requires
response to <a href="proto_ssp.html#SSP_SSUR">SSP_SSUR</a> from the Server with <a href="proto_ssp.html#SSP_SPASA">SSP_SPASA</a> not after
performing the service has started, but after performing the service
has been completed (e.g. compressing files).
<br>&nbsp;
<a name="Invisible_20Service"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>Invisible Service</b></td>
<td valign="top"> This means a service that is usually triggered automatically by
the SRA without requiring user interaction. See <a href="proto_ssp.html#SSP_STATUSDISPLAY">Status Display Service</a>.
<br>&nbsp;
<a name="Interactive_20Service"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>Interactive Service</b></td>
<td valign="top"> This means a service that is usually triggered by the SRA from
a user action. See <a href="proto_ssp.html#SSP_SENDFILE">Send File Service</a>.
<br>&nbsp;
<a name="Server_20registration"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>Server Registration</b></td>
<td valign="top"> All SPAs have to register with the SSP-Server before they can
provide and perform any services. Registration should be done once on
program installation and every time the SPA starts up. See <a href="#SSP_20Server_20registration">SSP Server registration</a>.
<br>&nbsp;
<a name="SSP-Server"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>Server</b></td>
<td valign="top"> or <b>SSP-Server</b> Application running in the background
that receives and sends messages from and to SPAs and SRAs. All
communication between SPAs and SRAs has the SSP-Server as mediator.
<br>See <a href="proto_ssp.html#What_20is_20the_20SSP-Server_3F">What is the SSP-Server?</a>
<br>&nbsp;
<a name="Message"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>Message</b></td>
<td valign="top"> in these documents refers to an AES message received by
<a href="evnt.html#evnt_mesag">evnt_mesag</a> (or <a href="evnt.html#evnt_multi">evnt_multi</a>, respectively). The communication in SSP is
based on AES messages.
<br>See <a href="#SSP_20messages">SSP messages</a>.
<br>&nbsp;
<a name="Server_20debug_20mode"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><b>Server debug mode</b></td>
<td valign="top"> If the environment variable SSP_SERVERDEBUG is defined (!) the
Server will log all activity (service requests, message-buffers,
<a href="magic_driveu.html#Shared_20memory">shared memory</a> addresses and -files, etc.) to sspdebug.log in the Server
application directory, and output the same information in a window,
including suggestions on how to fix possible bugs.
<br>&nbsp;

</td></tr>
</table>

<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="protocols.html"><img src="udo_up.gif" alt="Protocols" title="Protocols" border="0" width="24" height="24">Protocols</a>
<a name="UDO_nav_lf_FOOT" href="proto_seproto.html"><img src="udo_lf.gif" alt="SE protocol" title="SE protocol" border="0" width="24" height="24">SE protocol</a>
<a name="UDO_nav_rg_FOOT" href="proto_view.html"><img src="udo_rg.gif" alt="View protocol" title="View protocol" border="0" width="24" height="24">View protocol</a>
</body>
</html>
