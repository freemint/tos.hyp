<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 2025/12/20 -->
<html lang="en">
<head>
<title>
The documentation for TOS: Shell library
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="aes_main.html"><img src="udo_up.gif" alt="AES" title="AES" border="0" width="24" height="24">AES</a>
<a name="UDO_nav_lf_HEAD" href="rsrc.html"><img src="udo_lf.gif" alt="Resource library" title="Resource library" border="0" width="24" height="24">Resource library</a>
<a name="UDO_nav_rg_HEAD" href="xgrf.html"><img src="udo_rg.gif" alt="Extended graphics library" title="Extended graphics library" border="0" width="24" height="24">Extended graphics library</a>

<hr>

<h1><a name="Shell_20library">8.22 Shell library</a></h1>
<p>This library contains functions to read information from the
program environment (such as the GEM desktop and similar
applications), or to write them; in addition they can take on the
launch of other GEM programs. The following routines are available
for this:
</p>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#shel_envrn">shel_envrn</a></td>
<td valign="top"> Obtains value of environment variable
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#shel_find">shel_find</a></td>
<td valign="top"> Searches for a file
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#shel_get">shel_get</a></td>
<td valign="top"> Reads from the environment buffer
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#shel_help">shel_help</a></td>
<td valign="top"> Outputs Help-texts
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#shel_put">shel_put</a></td>
<td valign="top"> Writes to the environment buffer
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#shel_rdef">shel_rdef</a></td>
<td valign="top"> Inquires the default program
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#shel_read">shel_read</a></td>
<td valign="top"> Reads command line parameters
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#shel_wdef">shel_wdef</a></td>
<td valign="top"> Sets the default program
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#shel_write">shel_write</a></td>
<td valign="top"> Launches application
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#x_shel_get">x_shel_get</a></td>
<td valign="top"> Read information from GENEVA.CNF
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#x_shel_put">x_shel_put</a></td>
<td valign="top"> Write information to GENEVA.CNF

</td></tr>
</table>

<p><b>Note:</b> Here special merit has been earned by <a href="#shel_write">shel_write</a>,
which as of AES Version 4.0 (or <a href="magic.html">MagiC</a> 3) has made many other useful
things available, such as <a href="gemdos_system.html#Shutdown">Shutdown</a> of the system, resolution changes,
AES broadcasting etc.
</p>
<p>See also: <a href="aes_about.html">About the AES</a> &nbsp; <a href="guidelines_styles.html">Style guidelines</a>
</p>
<h3><a name="shel_envrn">8.22.1 shel_envrn</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell environment« - Obtains value of environmental
variables.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 125
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t shel_envrn ( int8_t **sh_epvalue, int8_t *sh_eparm );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The call shel_envrn searches the current environment string to
find the value of a specific environmental variable of the AES. The
following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_epvalue</td>
<td valign="top"> After the call contains the value of the corresponding variable
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_eparm</td>
<td valign="top"> Name of the environmental variable

</td></tr>
</table>

<br><b>Example:</b> If the current environment is, say:
'PATH=C:\;D:\;E:\' then calling shel_envrn with <i>sh_eparm</i>
pointing to the string 'PATH=' would set the pointer pointed to by
<i>sh_epvalue</i> to the start of the string 'C:\;D:\;E:\'. Note that
the character string pointed to by <i>sh_eparm</i> should include the
name of the variable <u>and</u> the 'equals' sign.
<br>&nbsp;
<br><b>Note:</b> To change the AES environment, one should hook
into the <a href="bios_sysvars.html#exec_os">exec_os</a> vector, which is also used to launch GEM. In the
called routine, the basepage pointer lies on the stack (as in a
program). In this basepage one can then simply enter a pointer to the
new environment.
<br>&nbsp;
<br>But a word of warning: In AES versions lower than 1.4, only
the first 50 bytes will be adopted; also these only accept semicolons
as separators between multiple 'PATH=' arguments, while later versions
accept commas as well.
<br>&nbsp;
<br><b>Another tip:</b> If the pointer returned for 'PATH=' points
to a NULLbyte, one should increase it by the value 1 to get the
correct result.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function always returns a value of 1.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All AES versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20shel_envrn">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20shel_envrn">8.22.1.1 Bindings for shel_envrn</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#shel_envrn">shel_envrn</a> ( int8_t **sh_epvalue, int8_t *sh_eparm );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#shel_envrn">shel_envrn</a> (int8_t **sh_epvalue, int8_t *sh_eparm)
{
   addr_in[0] = sh_epvalue;
   addr_in[1] = sh_eparm;

   return ( <a href="aes_fundamentals.html#crys_if">crys_if</a>(125) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">125   # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">0     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">2     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">sh_epvalue</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[1]</td>
  <td align="left" valign="top">sh_eparm</td>
</tr>
<tr>
  <td align="left" valign="top">int_out</td>
  <td align="left" valign="top">int_out[0]</td>
  <td align="left" valign="top">Return value</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="shel_find">8.22.2 shel_find</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell find« - Find a file.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 124
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t shel_find ( int8_t *sh_fpbuff );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The call shel_find searches for a file in certain directories.
The parameter <i>sh_fpbuff</i> contains the name of the file searched
for. On returning from the call, the full access path to the file will
be stored in this buffer, which should be at least 128 characters
long.
<br>&nbsp;
<br><b>Note:</b> The file will be searched for in the following
directories:
<br>&nbsp;
<ul>
<li> In the current directory
</li>
<li> In the root directory
</li>
<li> In all directories specified in the environmental variable
'PATH' of the AES
</li>
<li> In the path of the calling application (as of TOS version
1.04)
</li>
</ul>

<br>The function is also used by <a href="rsrc.html#rsrc_load">rsrc_load</a> to localize the resource
file.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> A value of 0 signals that the specified file was not found.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All AES versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20shel_find">Binding</a> &nbsp; <a href="#shel_envrn">shel_envrn</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20shel_find">8.22.2.1 Bindings for shel_find</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#shel_find">shel_find</a> ( int8_t *sh_fpbuff );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#shel_find">shel_find</a> (int8_t *sh_fpbuff)
{
   addr_in[0] = sh_fpbuff;
   return ( <a href="aes_fundamentals.html#crys_if">crys_if</a>(124) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">124   # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">0     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">1     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">sh_fpbuff</td>
</tr>
<tr>
  <td align="left" valign="top">int_out</td>
  <td align="left" valign="top">int_out[0]</td>
  <td align="left" valign="top">Return value</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="shel_get">8.22.3 shel_get</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell get« - Read from the GEM environment buffer.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 122
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t shel_get ( int8_t *sh_gaddr, uint16_t sh_glen );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The call shel_get serves for reading characters from the
internal environment storage buffer of the AES. The following
apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_gaddr</td>
<td valign="top"> Address of the destination memory store
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_glen</td>
<td valign="top"> Number of bytes to be read, or the value -1 to obtain the
length of the memory store

</td></tr>
</table>

<br><b>Note:</b> The desktop uses this buffer to store the
DESKTOP.INF or NEWDESK.INF file. Although the format of these files is
<i>not</i> officially documented, a current description can be found
in newdesk.hyp.
<br>&nbsp;
<br>Under <a href="magic.html">MagiC</a>, at the start of the AES all data are copied into
the buffer that lies after the line '<a href="magic_magxinf.html#UDO__23_CTR">#_CTR</a>' in MAGX.INF. Since MagiC
3, the permissible length of the buffer lies between 4192 and 65534
bytes. The presence of the additional features can be ascertained with
a call of <a href="appl.html#UDO__25apgi_6">appl_getinfo</a> (opcode 6).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> An error has arisen only if the value 0 is returned.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All AES versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20shel_get">Binding</a> &nbsp; <a href="#shel_put">shel_put</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20shel_get">8.22.3.1 Bindings for shel_get</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#shel_get">shel_get</a> ( int8_t *sh_gaddr, uint16_t sh_glen );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#shel_get">shel_get</a> (int8_t *sh_gaddr, uint16_t sh_glen)
{
   int_in[0]  = sh_glen;
   addr_in[0] = sh_gaddr;

   return ( <a href="aes_fundamentals.html#crys_if">crys_if</a>(122) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">122   # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">1     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">1     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">int_in</td>
  <td align="left" valign="top">int_in[0]</td>
  <td align="left" valign="top">sh_glen</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">sh_gaddr</td>
</tr>
<tr>
  <td align="left" valign="top">int_out</td>
  <td align="left" valign="top">int_out[0]</td>
  <td align="left" valign="top">Return value</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="shel_help">8.22.4 shel_help</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell help« - Output of Help-texts.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 128
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t shel_help ( int16_t sh_hmode, int8_t *sh_hfile, int8_t
*sh_hkey);
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The call shel_help serves for outputting Help-texts (online
help) via a help server.
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
<br>&nbsp;
<a name="SHP_HELP"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_hmode</td>
<td valign="top"> At present always pass SHP_HELP(=0)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_hfile</td>
<td valign="top"> Name of the help file
<br>&nbsp;
<br>If this is passed including an extension, the corresponding
server according to the extension will be searched for in the list of
help servers
<br>&nbsp;
<br>If the passed file has no extension, then that of the first help
server defined in the CNF file will be appended automatically
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_hkey</td>
<td valign="top"> Key-word for which a Help-text is to be output, or NULL
<br>&nbsp;

</td></tr>
</table>

<br>At a call of shel_help with a file having an extension, N.AES
checks whether a help server for this extension has been defined (with
'helpserver'). If a suitable server is found, a check is made whether
this is active already (as a desk accessory or application launched in
parallel). If that is the case, then the server is sent the message
<a href="proto_av.html#VA_START">VA_START</a> with the arguments specified in <i>sh_hfile</i> and
<i>sh_hkey</i> as a command line.
<br>&nbsp;
<br>If the server is not active, then it will be launched
automatically if a path was specified for it in its definition with
'helpserver'. As a command line the arguments specified in
<i>sh_hfile</i> and <i>sh_hkey</i> will be passed.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> An error has arisen only if the value 0 is returned.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> The presence of this function can be ascertained with a call of
<a href="appl.html#UDO__25apgi_65">appl_getinfo</a> (opcode 65).
<br>&nbsp;
<br>Besides N.AES, there is a TSR which makes this function
available on other systems as well.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20shel_help">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20shel_help">8.22.4.1 Bindings for shel_help</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#shel_help">shel_help</a> ( int16_t sh_hmode, int8_t *sh_hfile, int8_t
*sh_hkey);
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#shel_help">shel_help</a> ( int16_t sh_hmode, int8_t *sh_hfile,
                    int8_t *sh_hkey)
{
   int_in[0] = sh_hmode;
   addr_in[0] = sh_hfile;
   addr_in[1] = sh_hkey;

   <a href="aes_fundamentals.html#crys_if">crys_if</a>(128);

   return = int_out[0];
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">128   # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">1     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">2     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">int_in</td>
  <td align="left" valign="top">int_in[0]</td>
  <td align="left" valign="top">sh_hmode</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">sh_hfile</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in+4</td>
  <td align="left" valign="top">addr_in[1]</td>
  <td align="left" valign="top">sh_hkey</td>
</tr>
<tr>
  <td align="left" valign="top">int_out</td>
  <td align="left" valign="top">int_out[0]</td>
  <td align="left" valign="top">Return value</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="shel_put">8.22.5 shel_put</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell put« - Writes to the GEM environment buffer.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 123
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t shel_put ( int8_t *sh_paddr, uint16_t sh_plen );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The call shel_put copies information to the environment shell
buffer of the AES. The following apply:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Parameter</td>
  <td align="left" valign="top">Meaning</td>
</tr>
<tr>
  <td align="left" valign="top"><i>sh_paddr</i></td>
  <td align="left" valign="top">Address of source buffer (in user memory)</td>
</tr>
<tr>
  <td align="left" valign="top"><i>sh_plen</i></td>
  <td align="left" valign="top">Number of characters to be written</td>
</tr>
</table>
</div>

<br><b>Note:</b> The desktop uses this buffer to store the
DESKTOP.INF or NEWDESK.INF file. Although the format of these files is
<i>not</i> officially documented, a current description can be found
in newdesk.hyp.
<br>&nbsp;
<br>The permissible length of the buffer lies since <a href="magic.html">MagiC</a> 3 between
4192 and 65534 bytes, while in very old TOS versions it was
restricted to 1024 bytes.
<br>&nbsp;
<br>Prior to AES version 4.0 this function would only copy as
many bytes as would fit into the current buffer. As of version 4.0,
the AES will dynamically allocate more memory as needed (up to
32767 bytes) for the shell buffer.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> An error has arisen only if the value 0 is returned.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All AES versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20shel_put">Binding</a> &nbsp; <a href="#shel_get">shel_get</a> &nbsp; <a href="#shel_envrn">shel_envrn</a> &nbsp; <a href="#shel_find">shel_find</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20shel_put">8.22.5.1 Bindings for shel_put</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#shel_put">shel_put</a> ( int8_t *sh_paddr, uint16_t sh_plen );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#shel_put">shel_put</a> (int8_t *sh_paddr, uint16_t sh_plen)
{
   int_in[0]  = sh_plen;
   addr_in[0] = sh_paddr;

   return ( <a href="aes_fundamentals.html#crys_if">crys_if</a>(123) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">123   # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">1     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">1     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">int_in</td>
  <td align="left" valign="top">int_in[0]</td>
  <td align="left" valign="top">sh_plen</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">sh_paddr</td>
</tr>
<tr>
  <td align="left" valign="top">int_out</td>
  <td align="left" valign="top">int_out[0]</td>
  <td align="left" valign="top">Return value</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="shel_rdef">8.22.6 shel_rdef</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell read default« - Inquire the default program.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 126
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void shel_rdef ( int8_t *lpcmd, int8_t *lpdir );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The call shel_rdef permits inquiring the program to be launched
at the termination of the current one (the desktop, as a rule). The
following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">lpcmd</td>
<td valign="top"> Pointer to a string of sufficient size to hold the name of the
application
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">lpdir</td>
<td valign="top"> Pointer to a string of sufficient size to hold the path of the
application
<br>&nbsp;

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function does not return a result.
<br>&nbsp;
<br>The binding form <a href="n_aes.html">N.AES</a> have a return value. If successful it
return 1, otherwise 0.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Under PC-GEM, the function is available as of version 2.0;
otherwise in KAOS 1.4.2, <a href="magic.html">MagiC</a> and <a href="n_aes.html">N.AES</a>. The presence of this
function can be ascertained with <a href="appl.html#UDO__25apgi_5">appl_getinfo</a> (opcode 5).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20shel_rdef">Binding</a> &nbsp; <a href="#shel_wdef">shel_wdef</a> &nbsp; <a href="magic.html">MagiC</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20shel_rdef">8.22.6.1 Bindings for shel_rdef</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void <a href="#shel_rdef">shel_rdef</a> ( int8_t *lpcmd, int8_t *lpdir );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#shel_rdef">shel_rdef</a> (int8_t *lpcmd, int8_t *lpdir)
{
   addr_in[0] = lpcmd;
   addr_in[1] = lpdir;

   <a href="aes_fundamentals.html#crys_if">crys_if</a>(126);
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">126   # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">0     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">2     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">lpcmd</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in+4</td>
  <td align="left" valign="top">addr_in[1]</td>
  <td align="left" valign="top">lpdir</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="shel_read">8.22.7 shel_read</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell read« - Read command line parameters of the
application.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 120
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t shel_read ( int8_t *sh_rpcmd, int8_t *sh_rptail );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The call shel_read obtains the name and the command line tail
with which an application was launched. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_rpcmd</td>
<td valign="top"> Complete pathname with program name
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_rptail</td>
<td valign="top"> Command line (according to <a href="gemdos_process.html#Pexec">Pexec</a>, so NULL-terminated and with
length specified in first byte)

</td></tr>
</table>

<br><b>Note:</b> The function only works correctly if the
application was launched with <a href="#shel_write">shel_write</a>. In case of doubt, therefore,
one should fall back to the values from the basepage.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> An error has arisen only if the value 0 is returned.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All AES versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20shel_read">Binding</a> &nbsp; <a href="#shel_write">shel_write</a> &nbsp; <a href="gemdos_process.html#Pexec">Pexec</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20shel_read">8.22.7.1 Bindings for shel_read</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#shel_read">shel_read</a> ( int8_t *sh_rpcmd, int8_t *sh_rptail );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#shel_read">shel_read</a> (int8_t *sh_rpcmd, int8_t *sh_rptail)
{
   addr_in[0] = sh_rpcmd;
   addr_in[1] = sh_rptail;

   return ( <a href="aes_fundamentals.html#crys_if">crys_if</a>(120) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">120   # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">0     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">2     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">sh_rpcmd</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in+4</td>
  <td align="left" valign="top">addr_in[1]</td>
  <td align="left" valign="top">sh_rptail</td>
</tr>
<tr>
  <td align="left" valign="top">int_out</td>
  <td align="left" valign="top">int_out[0]</td>
  <td align="left" valign="top">Return value</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="shel_wdef">8.22.8 shel_wdef</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell write default« - Set the default program.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 127
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void shel_wdef( int8_t *lpcmd, int8_t *lpdir );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The call shel_wdef allows setting the application that is to be
regarded as the default program (normally the desktop).
<br>&nbsp;
<br><b>Note for MagiC:</b> If the parameters <i>lpcmd</i> and
<i>lpdir</i> are empty strings, then MAGXDESK will be reinstalled. An
alternative desktop simply makes a <a href="#shel_write">shel_write</a> call at launch, and then
terminates itself with <a href="gemdos_process.html#Pterm0">Pterm0</a>; it receives from <a href="magic.html">MagiC</a> a command line
(<a href="aes_structures.html#SHELTAIL">SHELTAIL</a>), which can be obtained with <a href="#shel_read">shel_read</a>. If the shell returns
a negative error-code, then MAGXDESK will be activated.
<br>&nbsp;
<br><b>Note for N.AES:</b> If the parameters <i>lpcmd</i> and/or
<i>lpdir</i> are empty strings or NULL, then the 'shell' application
specified in <a href="naes_cnf.html#N_AES.CNF">N_AES.CNF</a> will be launched.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function does not return a result.
<br>&nbsp;
<br>The binding form <a href="n_aes.html">N.AES</a> have a return value, which is always 1.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Under PC-GEM, the function is available as of version 2.0;
otherwise in KAOS 1.4.2, <a href="magic.html">MagiC</a> and <a href="n_aes.html">N.AES</a>. The presence of this
function can be ascertained with <a href="appl.html#UDO__25apgi_5">appl_getinfo</a> (opcode 5).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20shel_wdef">Binding</a> &nbsp; <a href="#shel_rdef">shel_rdef</a> &nbsp; <a href="magic.html">MagiC</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20shel_wdef">8.22.8.1 Bindings for shel_wdef</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void <a href="#shel_wdef">shel_wdef</a>( int8_t *lpcmd, int8_t *lpdir );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>void <a href="#shel_wdef">shel_wdef</a>(int8_t *lpcmd, int8_t *lpdir)
{
   addr_in[0] = lpcmd;
   addr_in[1] = lpdir;

   <a href="aes_fundamentals.html#crys_if">crys_if</a>(127);
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">127   # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">0     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">2     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">lpcmd</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in+4</td>
  <td align="left" valign="top">addr_in[1]</td>
  <td align="left" valign="top">lpdir</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="shel_write">8.22.9 shel_write</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell write« - Launch another application.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 121
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t shel_write ( int16_t sh_wdoex, int16_t sh_wisgr,
int16_t sh_wiscr, int8_t *sh_wpcmd, int8_t *sh_wptail );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The call shel_write permits launching another program. As of
AES version 4.0 this function was expanded greatly, so now one can
also perform tasks such as the <a href="gemdos_system.html#Shutdown">Shutdown</a> of the system, changing screen
resolution, AES broadcasting and a number of other functions.
<br>&nbsp;
<br>The parameter <i>sh_wdoex</i> determines the action to be
performed, the remaining parameters depend in essence on
<i>sh_wdoex.</i> The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><i>sh_wdoex</i></td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"> <b>Launch application</b>
<br>The value of the parameter <i>sh_wisgr</i> (launch in graphic
mode, yes/no) is set automatically by the AES, by comparing the
file extension with the contents of AES environmental variables
GEMEXT, TOSEXT and ACCEXT
</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> <b>Launch application im GEM/TOS mode</b>
<br>The parameter <i>sh_wisgr</i> sets the mode in which the program
is to be launched; the following apply:
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">sh_wisgr = 0:</td>
<td valign="top"> Launch as TOS program
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wisgr = 1:</td>
<td valign="top"> Launch as GEM program

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"> <b>Reserved</b>
</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top"> <b>Start accessory</b>
<br>A program is to be launched as a desk accessory

</td></tr>
</table>

<br>In the parameters <i>sh_wpcmd</i> and <i>sh_wptail</i> one
should pass the filename of the program to be launched and a pointer
to the command line tail respectively. The default directory will be
chosen as the directory that contains the program to be launched
(Exception: extended mode with bit 10 set - see below).
<br>&nbsp;
<br>The function returns the AES ID of the launched process. A
value of 0 in this connection denotes that an error has occurred. With
the parameter <i>sh_wiscr</i> one can specify whether <b>parameters
via ARGV</b> should be passed to the launched program. The following
apply:
<br>&nbsp;
<br>sh_wiscr = 0: Do not use <a href="gemdos_argv.html">ARGV procedure</a>
<br>sh_wiscr = 1: Use ARGV procedure
<br>&nbsp;
<a name="Parallel_20launching_20of_20programs"></a>
<br>Under <a href="magic.html">MagiC</a>, on the other hand, one can specify whether a
program is to be started in <b><a href="shel.html#Single-mode">single-mode</a></b> (or in parallel). The
following apply:
<br>&nbsp;
<br>sh_wiscr = 100: <b>Execute program in parallel</b>
<br>The new application inherits all standard paths and files from the
current application. An error-code is returned only in case of memory
shortage during the installation; a notification at the termination of
the new application (death-of-child) does not exist (*).
<br>&nbsp;
<a name="Single-mode"></a>
<br>sh_wiscr = 101: <b>Execute program in single-mode</b>
<br>This mode corresponds to <i>sh_wiscr</i> with the value 1, except
that before the program is called all applications apart from those
with ID 0 and ID 1 (SCRENMGR) are frozen. Those applications will be
thawed out again at the termination of the program, as long as that
does not make a new shel_write call of a single-mode character.
<b>The exact recipe for the single-mode is:</b>
<br>&nbsp;
<ul>
<li> Ensure that I am application #0 (i.e. ap_id == 0)
</li>
<li> Set paths and drive for the new program
</li>
<li> shel_write (TRUE, sh_wisgr, 101, sh_wpcmd, sh_wptail)
</li>
<li> All important settings to temporary file or shell-buffer
</li>
<li> <a href="appl.html#appl_exit">appl_exit</a>, <a href="vdi_control.html#v_clsvwk">v_clsvwk</a>, <a href="gemdos_process.html#Pterm0">Pterm0</a> execute
</li>
</ul>

<br>One should also note that as of MagiC 2, in single-mode the
current paths of the caller are passed to the parent and with that to
the new program. The caller's paths are destroyed subsequently, though
this is not critical as the program will normally follow shel_write
with a <a href="gemdos_process.html#Pterm">Pterm</a> call (*).
<br>&nbsp;
<br>In <b>extended mode</b> one can further specify the launching
of programs via the special bits of the parameter <i>sh_wdoex.</i>
The low byte stays untouched here, and for the high byte the following
apply:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="center" valign="top"><i>sh_wdoex</i> bit</td>
  <td align="left" valign="top">Meaning</td>
</tr>
<tr>
  <td align="center" valign="top">8</td>
  <td align="left" valign="top">Value of <a href="gemdos_process.html#Psetlimit">Psetlimit</a> is valid</td>
</tr>
<tr>
  <td align="center" valign="top">9</td>
  <td align="left" valign="top">Value of <a href="gemdos_process.html#Prenice">Prenice</a> is valid</td>
</tr>
<tr>
  <td align="center" valign="top">10</td>
  <td align="left" valign="top">Default directory is valid</td>
</tr>
<tr>
  <td align="center" valign="top">11</td>
  <td align="left" valign="top">Environment string is valid</td>
</tr>
<tr>
  <td align="center" valign="top">12</td>
  <td align="left" valign="top">User id is valid</td>
</tr>
<tr>
  <td align="center" valign="top">13</td>
  <td align="left" valign="top">Group id is valid</td>
</tr>
<tr>
  <td align="center" valign="top">14</td>
  <td align="left" valign="top">Reserved</td>
</tr>
<tr>
  <td align="center" valign="top">15</td>
  <td align="left" valign="top">Reserved (but see XSHD_FLAGS below)</td>
</tr>
</table>
</div>

<br>In this extended mode, the parameter <i>sh_wpcmd</i> is taken
as a pointer to a <a href="aes_structures.html#SHELW">SHELW</a> structure. Each of the above-named bits is
assigned a member of that structure which is valid when the
corresponding bit is set. The set of values is allocated as follows:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Element</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">[0]</td>
<td valign="top"> Pointer to the name of the program. This must always be set.
</td></tr>

<tr><td nowrap="nowrap" valign="top">[1]</td>
<td valign="top"> Value of <a href="gemdos_process.html#Psetlimit">Psetlimit</a> (bit 8)
</td></tr>

<tr><td nowrap="nowrap" valign="top">[2]</td>
<td valign="top"> Value of <a href="gemdos_process.html#Prenice">Prenice</a> (bit 9)
</td></tr>

<tr><td nowrap="nowrap" valign="top">[3]</td>
<td valign="top"> Pointer to the default directory; a NULL-pointer in this
connection means that the directory in which the program to be
launched lies is selected as the default directory (bit 10)
</td></tr>

<tr><td nowrap="nowrap" valign="top">[4]</td>
<td valign="top"> Pointer to the environment of the application (bit 11)
</td></tr>

<tr><td nowrap="nowrap" valign="top">[5]</td>
<td valign="top"> New user id of the application (bit 12)
</td></tr>

<tr><td nowrap="nowrap" valign="top">[6]</td>
<td valign="top"> New group id of the application (bit 13)

</td></tr>
</table>

<br><b>Note:</b> The elements [1], [2] and [3] are ignored up to
MagiC 3; element [1] however is supported from <a href="magic.html">MagiC</a>&nbsp;4 onwards. The
default directory is set much simpler under MagiC, as the new program
inherits all paths on all drives from the calling program. Geneva can
only set bit 8.
<br>&nbsp;
<br><b>Note:</b> In <a href="magic.html">MagiC</a>&nbsp;6, the user id and group id fields have a
different meaning.
<br>&nbsp;
<br><b>In newer AES versions the following additional modes are
available:</b>
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">sh_wdoex</td>
<td valign="top"> Meaning
<br>&nbsp;
<a name="Shutdown_20mode"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">4</td>
<td valign="top"> <b>Set Shutdown mode</b>
<br>This command puts the system into the normal or Shutdown mode,
depending on the parameter <i>sh_wiscr.</i> The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">sh_wiscr</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">-1</td>
<td valign="top"> <a href="aes_main.html">AES</a> call a small program to select shutdown options.
<br>Since MyAES 0.96
<a name="Shutdown_2C_20Terminate"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0</td>
<td valign="top"> <b>Terminate <a href="gemdos_system.html#Shutdown">Shutdown</a> sequence</b>
<br>A started <a href="gemdos_system.html#Shutdown">Shutdown</a> can only be terminated by that process that
also started this sequence
<a name="Shutdown_2C_20Partial"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;1</td>
<td valign="top"> <b>Partial <a href="gemdos_system.html#Shutdown">Shutdown</a></b>
<br>With the exception of the caller, all applications are checked by
the AES on whether they understand the message <a href="evnt.html#AP_TERM">AP_TERM</a>; if this is
the case, then the AES sends the messages AP_TERM or <a href="evnt.html#AC_CLOSE">AC_CLOSE</a> to the
programs or accessories. The caller receives none of these messages.
<a name="Shutdown_2C_20Complete"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;2</td>
<td valign="top"> <b>Complete <a href="gemdos_system.html#Shutdown">Shutdown</a></b>
<br>With the exception of the caller, all applications and accessories
are checked by the AES on whether they understand the message
<a href="evnt.html#AP_TERM">AP_TERM</a>; if this is the case, then the AES sends the messages
AP_TERM or AC_CLOSE to the programs or accessories. <a href="aes_fundamentals.html#Accessories">Accessories</a> receive
the AP_TERM message also after the receipt of the AC_CLOSE message. The
caller receives none of these messages.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;3</td>
<td valign="top"> Cold reboot
<br>Since MyAES 0.96.

</td></tr>
</table>

<br>In N.AES there is an extended call:
<br>shel_write(4, shutart, 0, &amp;ignorant, NULL);
<br>&nbsp;
<br><i>ignorant</i> is here an integer whose address is passed as
the fourth parameter of the shel_write call. In case of error the
return value of the function shel_write is 0 as before, but in
addition, <i>ignorant</i> will hold the apid (application ID) of the
application that has not understood AP_TERM, or -1 if a <a href="gemdos_system.html#Shutdown">Shutdown</a> is
already running, or -2 if invalid parameters were passed.
<br>&nbsp;
<a name="Resolution_20change"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">5</td>
<td valign="top"> <b>Resolution change</b>
<br>The application invites the AES to change the resolution. If
the AES agrees to the change, it attempts to close down the system
(<a href="gemdos_system.html#Shutdown">Shutdown</a>). Any active applications can now either terminate
themselves, or tell the AES with an <a href="evnt.html#AP_TFAIL">AP_TFAIL</a> message that they are
not in a position to do so. The parameters <i>sh_wisgr</i> and
<i>sh_wiscr</i> are dependent on one another. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">sh_wiscr</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"> The parameter <i>sh_wisgr</i> is the ID of the physical device
on which the 'Open workstation' call of the VDI is executed. The
current physical device number can be obtained with <a href="Screen_functions.html#Getrez">Getrez</a> + 2 as
usual; the following values are available:
<br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">2</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">ST-Low</td>
  <td align="left" valign="top">(320*200)</td>
</tr>
<tr>
  <td align="left" valign="top">3</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">ST-Medium</td>
  <td align="left" valign="top">(640*200)</td>
</tr>
<tr>
  <td align="left" valign="top">4</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">ST-High</td>
  <td align="left" valign="top">(640*400)</td>
</tr>
<tr>
  <td align="left" valign="top">6</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">TT-Medium</td>
  <td align="left" valign="top">(640*480)</td>
</tr>
<tr>
  <td align="left" valign="top">8</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">TT-High</td>
  <td align="left" valign="top">(1280*960)</td>
</tr>
<tr>
  <td align="left" valign="top">9</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">TT-Low</td>
  <td align="left" valign="top">(320*480)</td>
</tr>
</table>
</div>

</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> The parameter <i>sh_wisgr</i> is the int16_t for the video
mode of the Falcon030
</td></tr>

<tr><td nowrap="nowrap" valign="top">&gt;2</td>
<td valign="top"> Reserved for future purposes

</td></tr>
</table>

<br>In N.AES there is an extended call:
<br>shel_write(5, vmode, falconflag, &amp;ignorant, NULL);
<br>As a resolution change always first starts a complete <a href="gemdos_system.html#Shutdown">Shutdown</a>
internally, it could be that here too not all applications understand
<a href="evnt.html#AP_TERM">AP_TERM</a> and so the resolution change fails prematurely. Similar to the
Mode 4 extension mentioned above, here too the application ID of a
non-understander will be held in <i>ignorant</i>, or a -1 if a Shutdown
is running already, or -2 if a faulty parameter (e.g. an invalid
resolution) was passed.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">6</td>
<td valign="top"> <b>unknown</b>
<br>&nbsp;
<a name="Broadcasting_20of_20the_20AES"></a>
<a name="AES_20Broadcasting"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">7</td>
<td valign="top"> <b><a href="aes_main.html">AES</a> broadcasting</b>
<br>The application would like to send a message to all other
applications present in the system. Excepted from receipt are only the
AES, the <a href="aes_fundamentals.html#The_20screen-manager">screen-manager</a>, as well as the sender of the message itself.
<br>&nbsp;
<br>The parameter <i>sh_wpcmd</i> is a pointer to a 16-byte sized
message buffer that contains the data to be sent.
<br>&nbsp;
<a name="Manipulate_20AES_20environment"></a>
<a name="Manipulate_20environment_20of_20the_20AES"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">8</td>
<td valign="top"> <b>Manipulation of the AES environment</b>
<br>This command permits the modification of the AES environment.
The parameter <i>sh_wisgr</i> describes the desired action. The
following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">sh_wisgr</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"> <b>Get size of environment buffer</b> This is returned as the
function result
</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> <b>Insertion/Removal of strings</b> The parameter
<i>sh_wpcmd</i> is a pointer to the environment string. The syntax
for insertion or removal runs: 'NEW=STRING\0' or NEW=\0'.
</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"> <b>Copy contents of the environment buffer</b>
<br>The parameter <i>sh_wpcmd</i> is a pointer to the receiving
buffer, which has a size of <i>sh_wiscr</i> bytes. The function
returns the number of bytes that could not be copied.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">9</td>
<td valign="top"> <b>Show supported messages</b>
<br>The application tells the AES, which (new) messages are
understood. This happens via the set bits of the parameter
<i>sh_wisgr.</i>
<br>&nbsp;
<a name="NM_INHIBIT_HIDE"></a>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Bit 0:</td>
<td valign="top"> <a href="evnt.html#AP_TERM">AP_TERM</a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 1:</td>
<td valign="top"> NM_INHIBIT_HIDE (as of XaAES 2005-01-16)
<br>Prevents the application from being hidden. Useful for some
'desktop' utilities like Taskbar.

</td></tr>
</table>

<br>All other bits (2-15) are not defined at present.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">10</td>
<td valign="top"> <b><a href="powerdos.html#Send">Send</a> message to the AES</b>
<br>The application wants to send a message to the AES. The
parameter <i>sh_wpcmd</i> is a pointer to a 16-byte sized message
buffer.
<br>&nbsp;
<dl class="UDO_env_description">
<dt><b>Geneva</b></dt>
<dd>
<p> A program can cause a windowed dialog to scroll by sending a
<a href="evnt.html#WM_ARROWED">WM_ARROWED</a> message to Geneva. Example:
<br>&nbsp;
<pre>int16_t msg[8];

msg[0] = <a href="evnt.html#WM_ARROWED">WM_ARROWED</a>;
msg[3] = window_handle;
msg[4] = <a href="evnt.html#WA_UPPAGE">WA_UPPAGE</a>;
shel_write( SWM_AESMSG, 0, 0,
            (int8_t *)msg, 0L );
</pre>
</p>

</dd>
<dt><b><a href="n_aes.html">N.AES</a></b></dt>
<dd>
<p> <a href="n_aes.html">N.AES</a> can be terminated and return to a text shell.
<br>&nbsp;
<pre>/*
 * Trigger a system shutdown, after
 * a successfully &quot;normal&quot; shutdown:
 */

#define AP_AESTERM    52

void TerminateNAES(void)
{
    int     msg[8];
    msg[0] = AP_AESTERM;
    shel_write(SWM_AESMSG, 0, 0, (char *)msg, NULL);
}
</pre>
</p>

</dd>
</dl>
<a name="Threads_2C_20Creation_20of"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">20</td>
<td valign="top"> <b>Create new thread</b>
<br>With this opcode the application can create a new thread. The
following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wisgr</td>
<td valign="top">
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top"> Launch program in VT52 window of the application, if one is
open
</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top"> Don't open a new window
</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top"> Open a new VT52 window

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wiscr</td>
<td valign="top"> 0
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wpcmd</td>
<td valign="top"> Pointer to <a href="THREADINFO.html">THREADINFO</a> structure
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wptail</td>
<td valign="top"> Parameter of type (void *) for the Thread function

</td></tr>
</table>

<br>With a successful call the application ID of the new thread will
be returned (*).
<br>&nbsp;
<a name="Threads_2C_20Ending_20of"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">21</td>
<td valign="top"> <b>End thread</b>
<br>With this opcode a thread can end itself. For this one sets the
parameters of <i>sh_wisgr</i>, <i>sh_wiscr</i> and <i>sh_wptail</i>
to the values 0 or NULL; with <i>sh_wpcmd</i> one can specify an
error-code to be returned.
<br>&nbsp;
<br>Normally an execution of this function is not necessary, since
the thread ends itself automatically at the end of its procedure (i.e.
with the CPU command RTS). <b>Important:</b> If the thread has made a
<a href="gemdos_process.html#Pexec">Pexec</a> call, then the running process must first be terminated with
<a href="gemdos_process.html#Pterm">Pterm</a>, before the thread can end itself (*).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">22</td>
<td valign="top"> <b>Terminate thread</b>
<br>With this opcode a thread can also be ended by the main program.
For this one passes in the parameter <i>sh_wiscr</i> the
application's ID of the thread, and sets the remaining parameters to
the value 0 or NULL.
<br>&nbsp;
<br>Normally this function is not necessary, as with the termination
of the main program all associated threads are ended as well. The
function was executed successfully when the value 1 is returned as a
result. One should note, however, that if in the meantime the thread
has performed a <a href="gemdos_process.html#Pexec">Pexec</a>, only that program will be terminated with <a href="gemdos_process.html#Pterm">Pterm</a>
(<a href="gemdos_errors.html#EBREAK">EBREAK</a>); the thread itself is only ended when the caller has received
a <a href="evnt.html#THR_EXIT">THR_EXIT</a> (*).
<br>&nbsp;
<a name="XSHW_RUNANY"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">224</td>
<td valign="top"> <b>Run an application</b> (Geneva as of Release 004)
<br>Run an application, letting Geneva determine the type; this is
identical to mode 0, except that the XSHD_FLAGS bit of <i>sw_doex</i>
can also be set (see below)
<br>&nbsp;
<a name="XSHW_RUNAPP"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">225</td>
<td valign="top"> <b>Run an application</b> (Geneva as of Release 004)
<br>This is identical to mode 1, except that the XSHD_FLAGS bit of
<i>sw_doex</i> can also be set.
<br>&nbsp;
<a name="XSHW_RUNACC"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">227</td>
<td valign="top"> <b>Run a desk accessory.</b> (Geneva as of Release 004)
<br>This is identical to mode 3, except that the XSHD_FLAGS bit of
<i>sw_doex</i> can also be set.
<br>&nbsp;
<br>When XSHD_FLAGS (1&lt;&lt;15) is added to <i>sw_doex</i>, this
means that the last LONGword of the SHWRCMD passed in the
<i>sh_wpcmd</i> parameter contains the Geneva program flags to use
when executing the application. It is strongly recommended that a
program using XSHD_FLAGS inquire the current flags for the application
and only change the ones it needs to change, rather than making most
of the flags zero or some other random value. See the <a href="appl.html#x_appl_flags">x_appl_flags</a>
section for an example.
<br>&nbsp;

</td></tr>
</table>

<br><b>Note:</b> As of <a href="magic.html">MagiC</a>&nbsp;3, the following specialities are
available:
<br>&nbsp;
<ul>
<li><p> If a character string is passed in <i>sh_wptail</i> that
starts with the value 255 and is terminated with '\0', the actual
length of the command line is determined by the AES and passed at
full length to the DOS. DOS constructs from this an ARGV parameter in
the environment. If the command line is shorter than 127 bytes, it is
passed via the basepage and with <a href="#shel_read">shel_read</a>, else it consists only of
the byte with the value 127.
<br>&nbsp;
</p></li>
<li><p> If a character string is passed in <i>sh_wptail</i> that
starts with the value 254, then the AES expects after this a
character string 'ARGV=something' and a '\0'-separated and with
'\0\0'-terminated list of parameters. This is passed completely to the
DOS, which constructs an ARGV parameter from this. If the command line
is shorter than 127 bytes, it is passed via the basepage and with
shel_read, where the NULLbytes are replaced with spaces, else it consists
only of the byte with the value 127.
<br>&nbsp;
</p></li>
</ul>

<br>The presence of the additional features can be inquired with
<a href="appl.html#UDO__25apgi_10">appl_getinfo</a> (opcode 10).
<br>&nbsp;
<br>The shel_write opcodes marked with (*) are at present available
only in MagiC.
<br>&nbsp;
<a name="shel_write_20and_20Single-TOS"></a>
<br><b>Warning:</b> If one launches a new AES process under
Single- TOS with shel_write, then this will be launched only after the
termination of the running process.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> An error has arisen only if the value 0 is returned.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All AES versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20shel_write">Binding</a> &nbsp; <a href="magic_shutdown.html">Shutdown mechanism</a> &nbsp; <a href="magic_threads.html">Threads in MagiC</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20shel_write">8.22.9.1 Bindings for shel_write</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#shel_write">shel_write</a> ( int16_t sh_wdoex, int16_t sh_wisgr,
int16_t sh_wiscr, int8_t *sh_wpcmd, int8_t *sh_wptail );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#shel_write">shel_write</a> (int16_t sh_wdoex, int16_t sh_wisgr,
                    int16_t sh_wiscr, int8_t *sh_wpcmd,
                    int8_t *sh_wptail)
{
   int_in[0]  = sh_wdoex;
   int_in[1]  = sh_wisgr;
   int_in[2]  = sh_wiscr;
   addr_in[0] = sh_wpcmd;
   addr_in[1] = sh_wptail;

   return ( <a href="aes_fundamentals.html#crys_if">crys_if</a>(121) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">121   # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">3     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">2     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">int_in</td>
  <td align="left" valign="top">int_in[0]</td>
  <td align="left" valign="top">sh_wdoex</td>
</tr>
<tr>
  <td align="left" valign="top">int_in+2</td>
  <td align="left" valign="top">int_in[1]</td>
  <td align="left" valign="top">sh_wisgr</td>
</tr>
<tr>
  <td align="left" valign="top">int_in+4</td>
  <td align="left" valign="top">int_in[2]</td>
  <td align="left" valign="top">sh_wiscr</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">sh_wpcmd</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in+4</td>
  <td align="left" valign="top">addr_in[1]</td>
  <td align="left" valign="top">sh_wptail</td>
</tr>
<tr>
  <td align="left" valign="top">int_out</td>
  <td align="left" valign="top">int_out[0]</td>
  <td align="left" valign="top">Return value</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="x_shel_get">8.22.10 x_shel_get</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell get« - Read information from GENEVA.CNF.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 29057
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t x_shel_get ( int16_t mode, int16_t length, int8_t *buf
);
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top">
<a name="X_SHLOADSAVE"></a>
<a name="X_SHOPEN"></a>
<a name="X_SHACCESS"></a>
<a name="X_SHCLOSE"></a>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">-1</td>
<td valign="top"> Re-read Geneva's settings
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0</td>
<td valign="top"> Open GENEVA.CNF
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;1</td>
<td valign="top"> Read a line
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;2</td>
<td valign="top"> Close GENEVA.CNF

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">length</td>
<td valign="top"> Number of bytes to read into <i>buf</i>.
</td></tr>

<tr><td nowrap="nowrap" valign="top">buf</td>
<td valign="top"> Product string (mode 0) or buffer to read <i>length</i> bytes
of data into (mode 1).

</td></tr>
</table>

<br>This function will cause Geneva to either re-read all of its own
internal settings, or read the settings from an outside program's
portion of GENEVA.CNF.
<br>&nbsp;
<br>When mode is X_SHLOADSAVE (-1), Geneva will re-read all of its
internal settings. The length and buf parameters are not used in this
mode. The Task Manager's &quot;Load Settings&quot; option uses this.
<br>&nbsp;
<br>In order to read its own settings, a program must begin by using
mode X_SHOPEN (0) to open GENEVA.CNF. The name passed in buf can
contain any character (including uppercase and punctuation) except the
[ or ] characters. The length parameter is not used in this mode.
<br>&nbsp;
<br>If the X_SHOPEN was successful, the program can then make
repeated calls using the X_SHACCESS (1) mode. Here, length specifies
the maximum number of bytes to read into the string buffer buf. The
<a href="geneva_function.html#x_sscanf">x_sscanf</a> function is very helpful for retreiving formatted data that
has been read with x_shel_get.
<br>&nbsp;
<br>If an error occurs at any time during the open or read phases
(or if the program's section of GENEVA.CNF ends), the file is
automatically closed. If a program wants to end the reading sooner, it
must use mode X_SHCLOSE (2) to close the file. Otherwise, any future
attempts to read from the file will fail.
<br>&nbsp;
<br>Example:
<br>&nbsp;
<pre>int sh_error( int err )
{
  switch(err) {
     case -2:
       <a href="gemdos_chrinout.html#Cconws">Cconws</a>( &quot;Disk error&quot; );
     return 1;
     case -1:
       <a href="gemdos_chrinout.html#Cconws">Cconws</a>( &quot;GENEVA.CNF is already in use by another program&quot; );
     return 1;
     case 0:
       <a href="gemdos_chrinout.html#Cconws">Cconws</a>( &quot;Read failed unexpectedly&quot; );
     return 1;
     default:
     return 0;
  }
}

main() {
  char buffer[100];
  int version, number1, number2;

  if( !sh_error( x_shel_get(X_SHOPEN,0,&quot;My Program&quot;) ) )
     if( !sh_error( x_shel_get(X_SHACCESS,sizeof(buffer),buffer) ) )
     {
       <a href="geneva_function.html#x_sscanf">x_sscanf</a>( buffer, &quot;%v&quot;, &amp;version );
       if( version != 0x200 ) {
          <a href="gemdos_chrinout.html#Cconws">Cconws</a>( &quot;Not compatible with version 2.0!&quot; );
          x_shel_get( X_SHCLOSE, 0, 0L );
          return;
       }
       if( !sh_error( x_shel_get(X_SHACCESS,sizeof(buffer),
          buffer) ) )
       <a href="geneva_function.html#x_sscanf">x_sscanf</a>( buffer, &quot;%x %d&quot;, number1, number2 );
       x_shel_get( X_SHCLOSE, 0, 0L );
     }
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top">
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">-3</td>
<td valign="top"> Incorrect GENEVA.CNF version (mode -1)
</td></tr>

<tr><td nowrap="nowrap" valign="top">-2</td>
<td valign="top"> Disk error
</td></tr>

<tr><td nowrap="nowrap" valign="top">-1</td>
<td valign="top"> Already in use (mode 0)
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0</td>
<td valign="top"> End of data or string not found
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;1</td>
<td valign="top"> No error

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> The function is only available under Geneva.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20x_shel_get">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20x_shel_get">8.22.10.1 Bindings for x_shel_get</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#x_shel_get">x_shel_get</a> ( int16_t mode, int16_t length, int8_t *buf
);
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#x_shel_get">x_shel_get</a> ( int16_t mode, int16_t length, int8_t *buf
)
{
   int_in[0] = mode;
   int_in[1] = length;
   addr_in[0] = buf;

   <a href="aes_fundamentals.html#crys_if">crys_if</a>(29057);

   return ( int_out[0] );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">29057 # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">2     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">1     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">int_in</td>
  <td align="left" valign="top">int_in[0]</td>
  <td align="left" valign="top">mode</td>
</tr>
<tr>
  <td align="left" valign="top">int_in+2</td>
  <td align="left" valign="top">int_in[1]</td>
  <td align="left" valign="top">length</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">buf</td>
</tr>
<tr>
  <td align="left" valign="top">int_out</td>
  <td align="left" valign="top">int_out[0]</td>
  <td align="left" valign="top">Return value</td>
</tr>
</table>
</div>


</td></tr>
</table>

<h3><a name="x_shel_put">8.22.11 x_shel_put</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Shell put« - Save a program's own settings, or Geneva's
settings, to GENEVA.CNF.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 29058
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t x_shel_put ( int16_t mode, int8_t *buf );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top">
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">-1</td>
<td valign="top"> Save Geneva's settings
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0</td>
<td valign="top"> Write a line
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;1</td>
<td valign="top"> Read a line
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;2</td>
<td valign="top"> Close GENEVA.CNF

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">buf</td>
<td valign="top"> Null-terminated string to write

</td></tr>
</table>

<br>When mode is <a href="shel.html#X_SHLOADSAVE">X_SHLOADSAVE</a> (-1), Geneva will save all of its
internal settings. The length and buf parameters are not used in this
mode.
<br>&nbsp;
<br>The Task Manager's Save Settings option uses this.
<br>&nbsp;
<br>In order to save its own settings, a program must begin by using
mode <a href="shel.html#X_SHOPEN">X_SHOPEN</a> (0) to open GENEVA.CNF. The name passed in buf can
contain any character (including uppercase and punctuation) except the
[ or ] characterli The length parameter is not used in this mode.
<br>&nbsp;
<br>If the <a href="shel.html#X_SHOPEN">X_SHOPEN</a> was successful, the program can then make
repeated calls using the <a href="shel.html#X_SHACCESS">X_SHACCESS</a> (1) mode. Here, buf points to a
null-terminated string to write. The string should be no more than 80
characters of readable text, and must not include the [ or ]
characters. If the firss character of the string is a semi-colon
&quot;;&quot;, it will be treated as a comment when read by
<a href="#x_shel_get">x_shel_get</a>. The <a href="geneva_function.html#x_sprintf">x_sprintf</a> function is very helpful for formatting data
for x_shel_put;
<br>&nbsp;
<br>If an error occurs at any time during the open or write phases
the file is automatically closed. If no errors occur, the program must
use mode <a href="shel.html#X_SHCLOSE">X_SHCLOSE</a> (2) to close the file. Otherwise, any future
attempts to write to the file will fail.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top">
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">-2</td>
<td valign="top"> Disk error
</td></tr>

<tr><td nowrap="nowrap" valign="top">-1</td>
<td valign="top"> Already in use (mode 0)
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0</td>
<td valign="top"> File not open or incorrect mode
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;1</td>
<td valign="top"> No error

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> The function is only available under Geneva.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Shell_20library">Shell library</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20x_shel_put">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20x_shel_put">8.22.11.1 Bindings for x_shel_put</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#x_shel_put">x_shel_put</a> ( int16_t mode, int8_t *buf );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Binding:</td>
<td valign="top">
<br>&nbsp;
<pre>int16_t <a href="#x_shel_put">x_shel_put</a> ( int16_t mode, int8_t *buf )
{
   int_in[0] = mode;
   addr_in[0] = buf;

   <a href="aes_fundamentals.html#crys_if">crys_if</a>(29058);

   return ( int_out[0] );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gem_about.html">GEM</a>-Arrays:</td>
<td valign="top">
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Address</td>
  <td align="left" valign="top">Element</td>
  <td align="left" valign="top">Contents</td>
</tr>
<tr>
  <td align="left" valign="top">control</td>
  <td align="left" valign="top">control[0]</td>
  <td align="left" valign="top">29058 # Function opcode</td>
</tr>
<tr>
  <td align="left" valign="top">control+2</td>
  <td align="left" valign="top">control[1]</td>
  <td align="left" valign="top">1     # Entry in int_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+4</td>
  <td align="left" valign="top">control[2]</td>
  <td align="left" valign="top">1     # Entry in int_out</td>
</tr>
<tr>
  <td align="left" valign="top">control+6</td>
  <td align="left" valign="top">control[3]</td>
  <td align="left" valign="top">1     # Entry in addr_in</td>
</tr>
<tr>
  <td align="left" valign="top">control+8</td>
  <td align="left" valign="top">control[4]</td>
  <td align="left" valign="top">0     # Entry in addr_out</td>
</tr>
<tr>
  <td align="left" valign="top">int_in</td>
  <td align="left" valign="top">int_in[0]</td>
  <td align="left" valign="top">mode</td>
</tr>
<tr>
  <td align="left" valign="top">addr_in</td>
  <td align="left" valign="top">addr_in[0]</td>
  <td align="left" valign="top">buf</td>
</tr>
<tr>
  <td align="left" valign="top">int_out</td>
  <td align="left" valign="top">int_out[0]</td>
  <td align="left" valign="top">Return value</td>
</tr>
</table>
</div>


</td></tr>
</table>

<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="aes_main.html"><img src="udo_up.gif" alt="AES" title="AES" border="0" width="24" height="24">AES</a>
<a name="UDO_nav_lf_FOOT" href="rsrc.html"><img src="udo_lf.gif" alt="Resource library" title="Resource library" border="0" width="24" height="24">Resource library</a>
<a name="UDO_nav_rg_FOOT" href="xgrf.html"><img src="udo_rg.gif" alt="Extended graphics library" title="Extended graphics library" border="0" width="24" height="24">Extended graphics library</a>
</body>
</html>
