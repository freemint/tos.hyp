<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 2025/08/02 -->
<html lang="en">
<head>
<title>
The documentation for TOS: XBRA procedure
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="bios_main.html"><img src="udo_up.gif" alt="BIOS" title="BIOS" border="0" width="24" height="24">BIOS</a>
<a name="UDO_nav_lf_HEAD" href="VT_52_terminal.html"><img src="udo_lf.gif" alt="VT-52 terminal" title="VT-52 terminal" border="0" width="24" height="24">VT-52 terminal</a>
<a name="UDO_nav_rg_HEAD" href="BSIM-BIOS-Extension.html"><img src="udo_rg.gif" alt="BSIM-BIOS-Extension" title="BSIM-BIOS-Extension" border="0" width="24" height="24">BSIM-BIOS-Extension</a>

<hr>

<h1><a name="XBRA_20procedure">3.9 XBRA procedure</a></h1>
<a name="Diverting_20vectors"></a>
<p>The XBRA procedure (&quot;eXtended BRAner&quot;) is based on an
idea by <i>Moshe Braner</i>, and should be used by all programs that
redirect vectors.
</p>
<p>The principle is that each vector-redirecting program places the
following structure directly before its own entry address (i.e. just
before the address to which the vector was set):
</p>
<a name="XBRA_20structure"></a>
<pre>typedef struct
{
    int8_t  xb_magic[4];   /* &quot;XBRA&quot; = 0x58425241         */
    int8_t  xb_id[4];      /* ID of four ASCII characters */
    int32_t xb_oldvec;     /* Old value of the vectors    */
} XBRA;
</pre>
<p>The element <i>xb_magic</i> permits a positive identification
of the XBRA structure; <i>xb_id</i> is the ID of the particular
program that has redirected the vector.
</p>
<p>With the aid of this procedure it is easy for a program to
ascertain whether it is already installed (though this can be done also
via the cookie jar), and to remove itself again from the vector chain.
It is important, however, that <b>all(!)</b> programs adhere to this
procedure, as otherwise the vector chain will be interrupted.
</p>
<p><b>Note about MagiC:</b> Programs that hook into any of the
system vectors should also link themselves into the <a href="bios_sysvars.html#etv_term">etv_term</a> vector.
If the program terminates abnormally, the operating system will jump
first via the etv_term vector. In such a case one can then calmly draw
back from all changed vectors; as <a href="magic.html">MagiC</a> uses its own etv_term vector for
each application, this cannot lead to any collisions.
</p>
<p>The XBRA procedure has won recognition over time, so that it's
now considered bad programming style if one does <i>not</i> use it.
</p>
<p>See also: <a href="bios_cookiejar.html">Cookie jar</a> &nbsp; <a href="bios_cookiejar.html#Cookie_20and_20XBRA_20list">Cookie and XBRA list</a> &nbsp; <a href="bios_resvector.html">Reset vector</a>
</p>
<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="bios_main.html"><img src="udo_up.gif" alt="BIOS" title="BIOS" border="0" width="24" height="24">BIOS</a>
<a name="UDO_nav_lf_FOOT" href="VT_52_terminal.html"><img src="udo_lf.gif" alt="VT-52 terminal" title="VT-52 terminal" border="0" width="24" height="24">VT-52 terminal</a>
<a name="UDO_nav_rg_FOOT" href="BSIM-BIOS-Extension.html"><img src="udo_rg.gif" alt="BSIM-BIOS-Extension" title="BSIM-BIOS-Extension" border="0" width="24" height="24">BSIM-BIOS-Extension</a>
</body>
</html>
