<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 2025/08/02 -->
<html lang="en">
<head>
<title>
The documentation for TOS: Memory management
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="gemdos_main.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24">GEMDOS</a>
<a name="UDO_nav_lf_HEAD" href="gemdos_process.html"><img src="udo_lf.gif" alt="Process functions" title="Process functions" border="0" width="24" height="24">Process functions</a>
<a name="UDO_nav_rg_HEAD" href="gemdos_network.html"><img src="udo_rg.gif" alt="Network functions" title="Network functions" border="0" width="24" height="24">Network functions</a>

<hr>

<h1><a name="Memory_20management">5.12 Memory management</a></h1>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Maccess">Maccess</a>&nbsp;&nbsp;</td>
<td valign="top"> Verify accessibility of a region of memory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Maddalt">Maddalt</a>&nbsp;&nbsp;</td>
<td valign="top"> <a href="xbios_dhs.html#Registers">Registers</a> 'Alternative' memory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Malloc">Malloc</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Reserves memory or inquires free memory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Mfree">Mfree</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Releases a block of memory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Mshrink">Mshrink</a>&nbsp;&nbsp;</td>
<td valign="top"> Reduces/increases size of a memory block.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Mvalidate">Mvalidate</a></td>
<td valign="top"> Verify accessibility of a process region of memory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Mxalloc">Mxalloc</a>&nbsp;&nbsp;</td>
<td valign="top"> Reserves a block of memory.

</td></tr>
</table>

<p><b>Warning:</b> Here one should emphasise that in view of
future operating system versions, memory blocks used for communication
between different programs, or blocks allocated via pointers, have to
be <i>global</i> (<a href="#Mxalloc">Mxalloc</a> functions with a global flag). Otherwise,
when using computers with PMMU (e.g. Atari-TT030 or Falcon030), memory
protection violations may arise.
</p>
<p>See also:
<br><a href="gemdos_tpa.html">Program launch and TPA</a> &nbsp; <a href="gemdos_process.html">Process functions</a> &nbsp; Memory management in
<a href="tos_main.html">TOS</a> &nbsp; <a href="magic_MCB.html#Memory_20management_20in_20MagiC">Memory management in MagiC</a>
</p>
<h3><a name="Maccess">5.12.1 Maccess</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> Maccess - verify accessibility of a region of memory
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 381 (0x17d)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Maccess ( void *start, int32_t size, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Maccess verifies accessibility for the calling process's memory
page(s) containing any part of the address range in the interval
[addr, addr+len-1].
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">start</td>
<td valign="top"> Start address of the memory block to be verified list
</td></tr>

<tr><td nowrap="nowrap" valign="top">size</td>
<td valign="top"> Length of the memory block
</td></tr>

<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top"> mode is either 1 to check for read access, or 0 to check for
read/write access.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the value 0 on success, else a negative
error code.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> This function is available as of FreeMiNT 1.15.12.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Memory_20management">Memory management</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Maccess">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Mvalidate">Mvalidate</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Maccess">5.12.1.1 Bindings for Maccess</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Maccess">Maccess</a> ( void *start, int32_t size, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    mode,-(sp)   ; Offset 10
move.l    size,-(sp)   ; Offset 6
pea       start        ; Offset 2
move.w    #381,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $C(sp),sp    ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Maddalt">5.12.2 Maddalt</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Inform GEMDOS of alternative memory« - Register
'Alternative' RAM with GEMDOS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 20
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Maddalt ( void *start, int32_t size );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Maddalt permits the inclusion of a block of
additional alternate-RAM in the GEMDOS memory list that would not
normally have been identified by the system. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">start</td>
<td valign="top"> Start address of the memory block to be added to the GEMDOS
free list
</td></tr>

<tr><td nowrap="nowrap" valign="top">size</td>
<td valign="top"> Length of the memory block

</td></tr>
</table>

<br><b>Note:</b> The block remains the property of DOS and may not
be reclaimed. If the added blocks are not consecutive, the number of
blocks that can be added is restricted to around 12.
<br>&nbsp;
<br>This function could be useful perhaps when using VME-bus cards
in an Atari-TT030, or similar hardware modifications, if their memory
is to be made accessible to GEMDOS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the value 0 on success, else a negative
error code.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> The function is only available from GEMDOS 0.19 on.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Memory_20management">Memory management</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Maddalt">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Maddalt">5.12.2.1 Bindings for Maddalt</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Maddalt">Maddalt</a> ( void *start, int32_t size );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    size,-(sp)   ; Offset 6
pea       start        ; Offset 2
move.w    #20,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $A(sp),sp    ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Malloc">5.12.3 Malloc</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »memory allocation« - Reserve a block of memory or inquire
free memory.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 72
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void *Malloc ( int32_t number );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Malloc reserves a block of memory for an
application, or calculates the size of the largest free block of
memory. The following applies for the parameter <i>number</i>:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Value</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">-1</td>
<td valign="top"> Get size of the largest available memory block
</td></tr>

<tr><td nowrap="nowrap" valign="top">Other</td>
<td valign="top"> Number of bytes to be reserved

</td></tr>
</table>

<br><b>Note:</b> One should never rely on the number of bytes
actually allocated corresponding to the number requested. Constructs
of the type Malloc(Malloc(-1L)) are simply out of the question in
multitasking systems (catchword: Task-switching).
<br>&nbsp;
<br>Under <a href="tos_main.html">TOS</a> the <a href="gemdos_main.html">GEMDOS</a> supported only a limited number of memory
blocks. For that reason, a programm should not often use the function,
instead it reserve larger blocks (at least 16KBytes) and manage
themselves.
<br>&nbsp;
<br><b>Furthermore one should note the following poins:</b>
<br>&nbsp;
<ul>
<li><p> The memory block need not be empty.
<br>&nbsp;
</p></li>
<li><p> Memory blocks allocated consecutively need not necessarily be
contiguous.
<br>&nbsp;
</p></li>
<li><p> Never access memory blocks that do not belong to one's own
process. In systems with memory protection this would lead to an
exception.
<br>&nbsp;
</p></li>
</ul>

<br>In <a href="magic.html">MagiC</a> this call is implemented as <a href="#Mxalloc">Mxalloc</a> with mode 0 or 3
(depending on the configuration bits in the program file header). The
configuration bits are stored in the basepage at present.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the start address of the reserved memory
block. A NULL-pointer means that there is not enough memory available
to fulfill the request. In the case of <i>number</i> = -1, the length
of the largest available memory block will be returned.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions. However, prior to GEMDOS Version 0.15,
Malloc( 0L ) will return a pointer to invalid memory instead of
failing as it should.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Memory_20management">Memory management</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Malloc">Bindings for Malloc</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Maddalt">Maddalt</a> &nbsp; <a href="gemdos_programs.html#The_20program_20flags">Program flags</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Malloc">5.12.3.1 Bindings for Malloc</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void *<a href="#Malloc">Malloc</a> ( int32_t number );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    number,-(sp) ; Offset 2
move.w    #72,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Mfree">5.12.4 Mfree</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »memory free« - Release a block of memory.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 73
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Mfree ( void *block );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Mfree releases a block of memory previously
reserved with <a href="#Malloc">Malloc</a>.
<br>&nbsp;
<br>The parameter <i>block</i> contains the start address of the
memory block to be released.
<br>&nbsp;
<br><b>Note:</b> In almost all GEMDOS versions no check is made
whether the block to be released really belongs to the relevant
process. Hence particular care is needed, specially in multitasking
systems.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a></td>
<td valign="top"> No error has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EIMBA">EIMBA</a></td>
<td valign="top"> Invalid memory block address

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Memory_20management">Memory management</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Mfree">Binding</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Maddalt">Maddalt</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Mfree">5.12.4.1 Bindings for Mfree</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Mfree">Mfree</a> ( void *block );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       block        ; Offset 2
move.w    #73,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Mshrink">5.12.5 Mshrink</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Memory shrink« - Reduce or enlarge a memory block.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 74
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Mshrink ( void *block, int32_t newsiz );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Mshrink reduces or enlarges an already
reserved memory block in the GEMDOS free list. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">block</td>
<td valign="top"> Start address of the memory block
</td></tr>

<tr><td nowrap="nowrap" valign="top">newsiz</td>
<td valign="top"> New (changed) length of the block; <b>in MagiC
additionally:</b>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">-1 =</td>
<td valign="top"> Obtain the largest possible size of the memory block
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0 =</td>
<td valign="top"> Release block

</td></tr>
</table>


</td></tr>
</table>

<br><b>Note:</b> As a rule no check is made whether the memory
block really belongs to the caller. The option to <i>enlarge</i> a
memory block is only available in <a href="magic.html">MagiC</a> at present. However this only
works if a large enough free block is present above the block in
question, and the TOS-compatibility has been deactivated.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a> :</td>
<td valign="top"> No error has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EIMBA">EIMBA</a> :</td>
<td valign="top"> Invalid memory block address
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EGSBF">EGSBF</a> :</td>
<td valign="top"> Block was enlarged

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Memory_20management">Memory management</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Mshrink">Binding</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mfree">Mfree</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Mshrink">5.12.5.1 Bindings for Mshrink</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Mshrink">Mshrink</a> ( void *block, int32_t newsiz );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    newsiz,-(sp)  ; Offset 8
pea       block         ; Offset 4
move.w    #0,-(sp)      ; Offset 2
move.w    #74,-(sp)     ; Offset 0
trap      #1            ; <a href="gemdos_main.html">GEMDOS</a>
lea       $C(sp),sp     ; Correct stack
</pre>
<br><b>Note:</b> The NULL-parameter is normally added automatically
in a C binding.
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Mvalidate">5.12.6 Mvalidate</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> Mvalidate - verify access to a process memory region
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 321 (0x141)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Mvalidate ( int16_t pid, void *start, int32_t size,
int32_t *flags );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Mvalidate verifies accessibility for the specified process's
memory page(s) containing any part of the address range in the
interval [addr, addr+len-1].
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">pid</td>
<td valign="top"> Process id of the process to check. May be 0 for the current
process.
</td></tr>

<tr><td nowrap="nowrap" valign="top">start</td>
<td valign="top"> Start address of the memory block to be verified.
</td></tr>

<tr><td nowrap="nowrap" valign="top">size</td>
<td valign="top"> Length of the memory block.
</td></tr>

<tr><td nowrap="nowrap" valign="top">flags</td>
<td valign="top"> Upon a successfull call, will contain the protection flags of
the specified memory region.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the value 0 on success, else a negative
error code.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> This function is available as of FreeMiNT 1.15.12.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Memory_20management">Memory management</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Mvalidate">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Maccess">Maccess</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Mvalidate">5.12.6.1 Bindings for Mvalidate</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Mvalidate">Mvalidate</a> ( int16_t pid, void *start, int32_t size,
int32_t *flags );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       flags        ; Offset 12
move.l    size,-(sp)   ; Offset 8
pea       start        ; Offset 4
move.w    pid,-(sp)    ; Offset 2
move.w    #321,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $10(sp),sp   ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Mxalloc">5.12.7 Mxalloc</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Allocate memory (with preference)« - Reserve memory
according to specified preferences.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 68
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void *Mxalloc ( int32_t amount, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Mxalloc reserves a block of memory of the
size <i>amount</i>. One can use the bits of the WORD parameter
<i>mode</i> to specify the desired type of memory. The following
apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Bits</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0-2</td>
<td valign="top"> <b>Treatment of the TT-RAM</b>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top"> Allocate ST-RAM only
</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top"> Allocate Alternative-RAM only
</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top"> Allocate either, ST-RAM preferred
</td></tr>

<tr><td nowrap="nowrap" valign="top">3 =</td>
<td valign="top"> Allocate either, Alternative-RAM preferred

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top"> Reserved
</td></tr>

<tr><td nowrap="nowrap" valign="top">4-7</td>
<td valign="top"> <b>Protection mode</b>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top"> Default (from your PRGFLAGS)
</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top"> Private
</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top"> Global
</td></tr>

<tr><td nowrap="nowrap" valign="top">3 =</td>
<td valign="top"> Supervisor-mode-only access
</td></tr>

<tr><td nowrap="nowrap" valign="top">4 =</td>
<td valign="top"> World-readable access

</td></tr>
</table>

<br>Other values are undefined and reserved.
</td></tr>

<tr><td nowrap="nowrap" valign="top">14</td>
<td valign="top"> <b>No-<a href="c_task_royal.html#Free">Free</a> modus</b>
<br>When set, this bit means &quot;if the owner of this block
terminates, don't free this block. Instead, let MiNT inherit it, so
it'll never be freed.&quot; This is a special mode meant for the OS
only, and may not remain available to user processes.

</td></tr>
</table>

<br>All further bits are reserved for future purposes. With the
value -1L for <i>amount</i> one can inquire the size of the largest
contiguous block of memory (dependent on <i>mode</i>).
<br>&nbsp;
<br>Under <a href="magic.html">MagiC</a> all memory allocations are logged. If the
restriction set with LIMITMEM is exceeded, A NULL-pointer will be
returned. In the case <i>amount</i> = -1, the minimum of free memory
and not yet exhausted LIMITMEM restriction will be returned.
Exceptions are calls of the screen manager (SCRENMGR) which controls
the menus. This ensures that even LIMITMEM-restricted programs do not
have problems with menu redraws.
<br>&nbsp;
<br><b>Note:</b> A problem exists in ascertaining when the extended
modes (bits 3 and following) may be used. This is because some older
versions of GEMDOS do not get along with these modes and are partly
responsible for crashing the application or the whole system. For this
reason many programmers test explicitly for the presence of
MiNT/MultiTOS or versions of MagiC &gt;= 2.0. Alternatively one can
also use the function <a href="#Mxmask">Mxmask</a>.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the start address of the reserved block as
an untyped pointer. Mxalloc returns a 0 when insufficient memory is
available.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> This function exists only from GEMDOS Version 0.19 on.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Memory_20management">Memory management</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Mxalloc">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Maddalt">Maddalt</a> &nbsp; <a href="gemdos_programs.html#The_20program_20flags">Program flags</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Mxalloc">5.12.7.1 Bindings for Mxalloc</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void *<a href="#Mxalloc">Mxalloc</a> ( int32_t amount, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    mode,-(sp)    ; Offset 6
move.l    amount,-(sp)  ; Offset 2
move.w    #68,-(sp)     ; Offset 0
trap      #1            ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #8,sp         ; Correct stack
</pre>

</td></tr>
</table>

<h4><a name="Mxmask">5.12.7.2 Mxmask</a></h4>
<pre>/*
   Mxmask returns a bit-mask with which one should mask the mode
   WORD of a <a href="#Mxalloc">Mxalloc</a> call if one wants to use protection bits.
   This is necessary as <a href="#Mxalloc">Mxalloc</a> unfortunately returns erroneous
   results in some <a href="gemdos_main.html">GEMDOS</a> implementations when protection bits are
   specified, which can result in a system crash.
   (© 1994 Martin Osieka)

   Application example:
   mxMask = Mxmask();
   p = mxMask ? <a href="#Mxalloc">Mxalloc</a>( size, 0x43 &amp; mxMask) : <a href="#Malloc">Malloc</a>( size); */

SHORT Mxmask (void)
{
    void *svStack;         /* Supervisor-Stack */
    int32_t sRAM, sRAMg;   /* ST-RAM           */
    int32_t aRAM, aRAMg;   /* Alternate RAM    */

    /*
    // Sample table of possible values:
    //           | newfashion  | oldfashion
    // sRAM aRAM | sRAMg aRAMg | sRAMg aRAMg
    //   1    0  |   1     0   |   1     1
    //   0    2  |   0     2   |   2     2
    //   1    2  |   1     2   |   3     3
    */

    svStack = (void *) <a href="gemdos_system.html#Super">Super</a>( 0);  /* Disallow task-switching */

    sRAM  = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 0);
    /* In error case <a href="#Mxalloc">Mxalloc</a>( -1, 3) */
    sRAMg = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 0x40);
    aRAM  = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 1);
    /* In error case <a href="#Mxalloc">Mxalloc</a>( -1, 3) */
    aRAMg = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 0x41);

    <a href="gemdos_system.html#Super">Super</a>( svStack);  /* Permit task-switching */

    if (sRAM == -32)
        return 0x0000;  /* <a href="#Mxalloc">Mxalloc</a> is not implemented */

    else if ( ((sRAM + aRAM) == sRAMg) &amp;&amp; ((sRAM + aRAM) == aRAMg) )
        return 0x0003;  /* oldfashion <a href="#Mxalloc">Mxalloc</a>() */

    else
        return 0xFFFF;

} /* Mxmask */
</pre>
<p>See also: <a href="gemdos_main.html">GEMDOS</a> &nbsp; <a href="#Memory_20management">Memory management</a>
</p>
<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="gemdos_main.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24">GEMDOS</a>
<a name="UDO_nav_lf_FOOT" href="gemdos_process.html"><img src="udo_lf.gif" alt="Process functions" title="Process functions" border="0" width="24" height="24">Process functions</a>
<a name="UDO_nav_rg_FOOT" href="gemdos_network.html"><img src="udo_rg.gif" alt="Network functions" title="Network functions" border="0" width="24" height="24">Network functions</a>
</body>
</html>
