<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 2025/08/02 -->
<html lang="en">
<head>
<title>
The documentation for TOS: Directory functions
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="gemdos_main.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24">GEMDOS</a>
<a name="UDO_nav_lf_HEAD" href="gemdos_system.html"><img src="udo_lf.gif" alt="System functions" title="System functions" border="0" width="24" height="24">System functions</a>
<a name="UDO_nav_rg_HEAD" href="gemdos_chrinout.html"><img src="udo_rg.gif" alt="Character input/output" title="Character input/output" border="0" width="24" height="24">Character input/output</a>

<hr>

<h1><a name="Directory_20functions">5.15 Directory functions</a></h1>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dchroot">Dchroot</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Changes the root directory for the calling process.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dclosedir">Dclosedir</a>&nbsp;&nbsp;</td>
<td valign="top"> Closes a directory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dcntl">Dcntl</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> File-system-specific operation on file/directory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dcreate">Dcreate</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Creates a directory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Ddelete">Ddelete</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Deletes a directory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dfree">Dfree</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Obtains free and total capacity of a drive.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dgetcwd">Dgetcwd</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Obtains directory of a process.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dgetdrv">Dgetdrv</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Obtains current drive.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dgetpath">Dgetpath</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Obtains current directory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dlock">Dlock</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Locks or releases again a BIOS device.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dopendir">Dopendir</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Opens a directory for reading.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dpathconf">Dpathconf</a>&nbsp;&nbsp;</td>
<td valign="top"> Obtains information about a file-system.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dreaddir">Dreaddir</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Reads directory information.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dreadlabel">Dreadlabel</a>&nbsp;</td>
<td valign="top"> Reads file-system label.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Drewinddir">Drewinddir</a>&nbsp;</td>
<td valign="top"> Rewinds opened directory pointer.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dsetdrv">Dsetdrv</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Sets current drive.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dsetkey">Dsetkey</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Sets key/passphrase for a drive.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dsetpath">Dsetpath</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Sets current directory.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dwritelabel">Dwritelabel</a></td>
<td valign="top"> Sets file-system label.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dxopendir">Dxopendir</a>&nbsp;&nbsp;</td>
<td valign="top"> Opens directory for reading.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dxreaddir">Dxreaddir</a>&nbsp;&nbsp;</td>
<td valign="top"> Reads directory information, obtains attributes.

</td></tr>
</table>

<p>See also: <a href="gemdos_file.html">File functions</a> &nbsp; <a href="xbios_drive.html">XBIOS drive functions</a>
</p>
<h3><a name="Dchroot">5.15.1 Dchroot</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dchroot« - Change the root directory for the calling
process.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 330 (0x014a)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dchroot( int8_t *path );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The path <i>parameter</i> is a pathname of the folder that
will be the new root directory for the calling process. Directories
and files which are outside of the specified tree will no longer be
accessible.
<br>&nbsp;
<br>Dchroot does not automatically change the current directory to
the newly specified root. Also, the call needs root privileges to
operate properly. This function is used by e.g. ftpd to limit the user
privileges in accessing file-systems.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> Returns the <a href="gemdos_errors.html#E_OK">E_OK</a> on success, or a negative GEMDOS error-code
otherwise.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability</td>
<td valign="top"> As of FreeMiNT version 1.15.4
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> Directories functions
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dchroot">Binding</a> &nbsp; <a href="#Dopendir">Dopendir</a> &nbsp; <a href="#Dreaddir">Dreaddir</a> &nbsp; <a href="magic.html">MagiC</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dchroot">5.15.1.1 Bindings for Dchroot</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dchroot">Dchroot</a>( int8_t *path );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       path             ; Offset 2
move.w    #330,-(sp)       ; Offset 0
trap      #1               ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #6,sp            ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dclosedir">5.15.2 Dclosedir</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dclosedir« - Close a specified directory.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 299
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dclosedir ( int32_t dirhandle );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Dclosedir closes the directory with the handle
<i>dirhandle</i>.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the value 0 if the directory could be
closed correctly. If <i>dirhandle</i> is invalid, then the value
<a href="gemdos_errors.html#EBADF">EBADF</a> will be returned.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Available when a 'MiNT' cookie with a version of at least 0.90
exists, and <a href="magic.html">MagiC</a> as of Version 3.0.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dclosedir">Binding</a> &nbsp; <a href="#Dopendir">Dopendir</a> &nbsp; <a href="#Dreaddir">Dreaddir</a> &nbsp; <a href="magic.html">MagiC</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dclosedir">5.15.2.1 Bindings for Dclosedir</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dclosedir">Dclosedir</a> ( int32_t dirhandle );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    dirhandle,-(sp)  ; Offset 2
move.w    #299,-(sp)       ; Offset 0
trap      #1               ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #6,sp            ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dcntl">5.15.3 Dcntl</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dcntl« - Execute a file-system-specific operation on a file
or a directory.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 304
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dcntl ( int16_t cmd, int8_t *name, int32_t arg );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Dcntl executes the command <i>cmd</i> on the file
or the directory <i>name</i>. Details depend on the file-system to
which <i>name</i> refers. The meaning of the parameter <i>arg</i> is
in turn dependent on <i>cmd</i>.
<br>&nbsp;
<br>Normally the Dcntl call is supported by the file-systems U:\\
and U:\DEV.
<br>&nbsp;
<br><b>The unified file-system U:\ knows the following
commands:</b>
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Command</td>
<td valign="top"> Description
<br>&nbsp;
<a name="FS_INSTALL"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">FS_INSTALL (0xf001)</td>
<td valign="top"> Installs a new file-system
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Must be U:\
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Pointer to <a href="magic_xfs.html#fs_descr">fs_descr</a> structure

</td></tr>
</table>

<a name="FS_MOUNT"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">FS_MOUNT (0xf002)</td>
<td valign="top"> Mounts an already existing file-system in the unified system
U:\
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Name under which one can access the file-system
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Pointer to fs_descr structure

</td></tr>
</table>

<a name="FS_UNMOUNT"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">FS_UNMOUNT (0xf003)</td>
<td valign="top"> Unmounts a file-system installed by FS_MOUNT
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Name under which the file-system was mounted
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Pointer to fs_descr structure

</td></tr>
</table>

<a name="FS_UNINSTALL"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">FS_UNINSTALL (0xf004)</td>
<td valign="top"> Removes a file-system completely from the kernel. This command
is only allowed if no further references to the file-system exist, so
that any mounts have been revoked, for instance.
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> U:\\
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Pointer to fs_descr structure

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_file.html#FUTIME">FUTIME</a> (0x4603)</td>
<td valign="top"> Is the complement to the <a href="gemdos_file.html#Fcntl">Fcntl</a> function of the same name. It is
supported by MiNT as well as DOS-XFS in <a href="magic.html">MagiC</a>. A pointer to a <a href="gemdos_structures.html#mutimbuf">mutimbuf</a>
structure is passed as a parameter.
<br>&nbsp;
<a name="KER_GETINFO"></a>
<a name="MX_KER_GETINFO"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">KER_GETINFO (0x0100)</td>
<td valign="top"> Obtains a pointer to the kernel functions of MagiC. The
parameters <i>name</i> and <i>arg</i> must have NULL-values. The
return is a pointer to a <a href="magic_xfs.html#MX_KERNEL">MX_KERNEL</a> structure. (*)
<br>&nbsp;
<br>As of MagiC 6: MX_KER_GETINFO (0x6d00) (1)
<br>&nbsp;
<a name="KER_DOSLIMITS"></a>
<a name="MX_KER_DOSLIMITS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">KER_DOSLIMITS (0x0101)</td>
<td valign="top"> Invites the kernel of MagiC to obtain the limits for FAT
file-systems. The parameter <i>name</i> and <i>arg</i> must be set
to NULL. The return is a pointer to a pointer to a <a href="magic_xfs.html#MX_DOSLIMITS">MX_DOSLIMITS</a>
structure; this can therefore be diverted to one's own structure if a
new driver is installed. This opcode is normally used only by hard disk
drivers (such as HDDRIVER). (*)
<br>&nbsp;
<br>As of MagiC 6: MX_KER_DOSLIMITS (0x6d01) (1)
<br>&nbsp;
<a name="KER_INTMAVAIL"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">KER_INTMAVAIL (0x102)</td>
<td valign="top"> &nbsp;
<br>&nbsp;
<a name="KER_INTGARBC"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">KER_INTGARBC (0x103)</td>
<td valign="top"> These functions exist in versions of MagiC prior to Version
4.01, and are converted to <a href="gemdos_system.html#Sconfig">Sconfig</a> calls to avoid conflicts with
drivers that have problems with unknown opcodes (*).
<br>&nbsp;
<a name="KER_DRVSTAT"></a>
<a name="MX_KER_DRVSTAT"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">KER_DRVSTAT (0x0104)</td>
<td valign="top"> Obtains simple information about a drive. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Is ignored
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Pointer to two int16_ts.

</td></tr>
</table>

<br>The first int16_t here must hold a NULL, into the second a drive
number from 0..25 (A..Z) will be written. The possible return values
for this opcode are:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EDRIVE">EDRIVE</a> :</td>
<td valign="top"> Invalid drive number
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ELOCKED">ELOCKED</a> :</td>
<td valign="top"> Drived locked at present

</td></tr>
</table>

<br>A value of 0 or &gt;0 indicates that the drive is at present
mounted or not mounted respectively. This opcode is only available
from the MagiC Version of 09.09.95 onwards (*).
<br>&nbsp;
<br>As of MagiC 6: MX_KER_DRVSTAT (0x6d04) (1)
<br>&nbsp;
<a name="KER_XFSNAME"></a>
<a name="MX_KER_XFSNAME"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">KER_XFSNAME (0x0105)</td>
<td valign="top"> Obtains the name of the driver that is responsible for a given
directory.
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Pathname (not filename!)
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Pointer to a buffer at least 9 characters long which has to lie
at an even address.

</td></tr>
</table>

<br>A return value &lt; 0 denotes no error; otherwise the name of
the driver will be stored in the specified buffer; at present the
following driver names are known:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">(a) &quot;DOS_XFS&quot;:</td>
<td valign="top"> Old DOS-XFS
</td></tr>

<tr><td nowrap="nowrap" valign="top">(b) &quot;VDOS_XFS&quot;:</td>
<td valign="top"> DOS-XFS with VFAT
</td></tr>

<tr><td nowrap="nowrap" valign="top">(c) &quot;MMAC_HFS&quot;:</td>
<td valign="top"> MagiCMac-HFS

</td></tr>
</table>

<br>This opcode is only available from the MagiC Version of
15.06.1996 onwards (*).
<br>&nbsp;
<br>As of MagiC 6: MX_KER_XFSNAME (0x6d05) (1)
<br>&nbsp;
<a name="KER_INSTXFS"></a>
<a name="MX_KER_INSTXFS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">KER_INSTXFS (0x0200)</td>
<td valign="top"> Invites the kernel of MagiC to install an XFS (*)
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> NULL-pointer
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Driver to install

</td></tr>
</table>

<br>As of MagiC 6: MX_KER_INSTXFS (0x6d02) (1)
<br>&nbsp;
<a name="KER_SETWBACK"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">KER_SETWBACK (0x0300)</td>
<td valign="top"> Invites the kernel of MagiC to configure the WriteBack. As of
MagiC Version 4.01, this opcode was converted to a <a href="gemdos_system.html#Sconfig">Sconfig</a> call, to
prevent conflicts with drivers that have problems with unknown opcodes
(*).
<br>&nbsp;
<a name="DFS_GETINFO"></a>
<a name="MX_DFS_GETINFO"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DFS_GETINFO (0x1100)</td>
<td valign="top"> Obtains a pointer to the DOS_XFS functions of MagiC. The
parameters <i>name</i> and <i>arg</i> must have NULL-values. The
return is a pointer to a ??? structure. (*)
<br>&nbsp;
<br>As of MagiC 6: MX_DFS_GETINFO (0x6d40) (1)
<br>&nbsp;
<a name="DFS_INSTDFS"></a>
<a name="MX_DFS_INSTDFS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DFS_INSTDFS (0x1200)</td>
<td valign="top"> Installs a DFS under <a href="magic.html">MagiC</a> (*).
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> NULL-pointer
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Driver to install

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_file.html#CDROMEJECT">CDROMEJECT</a> (0x4309)</td>
<td valign="top"> Takes charge of ejection of media.
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Path of the medium to be ejected
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> NULL

</td></tr>
</table>

<br>The ejection function is supported for all drives that are
accessed via an <a href="xhdi.html#XHDI">XHDI</a>-compatible driver, as well as for Macintosh
volumes (under MagiCMac).
<br>&nbsp;
<br>As of MagiC 6: MX_DFS_INSTDFS (0x6d41) (1)
<br>&nbsp;
<a name="VFAT_CNFDFLN"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">VFAT_CNFDFLN (0x5600)</td>
<td valign="top"> Configures a VFAT file-system
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> U:\\
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Bit-vector that determines which drives permit long filenames

</td></tr>
</table>

<br>The setting only becomes active on mounting a file-system, so
that already mounted file-systems can <i>not</i> be affected by it.
This opcode is only available from the MagiC Version of 02.01.96
onwards. (*).
<br>&nbsp;
<a name="VFAT_CNFLN"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">VFAT_CNFLN (0x5601)</td>
<td valign="top"> Serves for the configuration of a VFAT file-system. More
exactly: Determines whether a mounted drive supports long filenames,
or not. With this opcode therefore one can <i>supplant</i> the
default value set by VFAT_CNFDFLN. So that the change becomes visible
to the user, a <a href="evnt.html#SH_WDRAW">SH_WDRAW</a> message should be sent to the system shell.
This opcode is only available as of the MagiC Version of 02.01.96
(*).
<br>&nbsp;
<a name="PROC_CREATE"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">PROC_CREATE (0xcc00)</td>
<td valign="top"> This function is reserved in MagiC for future use (*). It is
no longer used as of MagiC 6.
<br>&nbsp;

</td></tr>
</table>

<br><b>The file-system U:\DEV knows the following commands:</b>
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Command</td>
<td valign="top"> Description
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
<br>&nbsp;
<a name="DEV_INSTALL"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DEV_INSTALL (0xde02)</td>
<td valign="top"> Installs a new driver for a device.
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Complete pathname of the driver
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Pointer to <a href="magic_xfs.html#dev_descr">dev_descr</a> structure

</td></tr>
</table>

<br>The device installed in this way may only be accessed via GEMDOS
operations.
<br>&nbsp;
<a name="DEV_M_INSTALL"></a>
<a name="MX_DEV_INSTALL"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DEV_M_INSTALL (0xcd00)</td>
<td valign="top"> Corresponds to DEV_INSTALL and has to be used in MagiC due to
the incompatible driver format to MultiTOS. (*)
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Complete pathname of the driver
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Pointer to MX_DDEV structure

</td></tr>
</table>

<br>As of MagiC 6: MX_DEV_INSTALL (0x6d20) (1)
<br>&nbsp;
<a name="DEV_NEWTTY"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DEV_NEWTTY (0xde00)</td>
<td valign="top"> Installs drivers for a new BIOS terminal
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Name of the terminal (in the form 'U:\DEV\DEVNAME')
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> BIOS device number of the terminal

</td></tr>
</table>

<br>The BIOS must have been informed about the device via <a href="xbios_interface.html#Bconmap">Bconmap</a>,
else any attempt to access the device will be punished with <a href="bios_errors.html#EUNDEV">EUNDEV</a>.
<br>&nbsp;
<a name="DEV_NEWBIOS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DEV_NEWBIOS (0xde01)</td>
<td valign="top"> Installs a driver for a new BIOS non-terminal device (devices
that must have their data transmitted raw, such as SCSI devices).
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">name:</td>
<td valign="top"> Complete name of the device
</td></tr>

<tr><td nowrap="nowrap" valign="top">arg:</td>
<td valign="top"> Associated BIOS device number

</td></tr>
</table>

<br>The BIOS must have been informed about the device via <a href="xbios_interface.html#Bconmap">Bconmap</a>,
else any attempt to access the device will be punished with <a href="bios_errors.html#EUNDEV">EUNDEV</a>.
<br>&nbsp;

</td></tr>
</table>

<br><b>Note:</b> The opcodes marked with (*) here are only
available under <a href="magic.html">MagiC</a>, all others only under MiNT or MultiTOS.
Exceptions: The opcodes <a href="gemdos_file.html#FUTIME">FUTIME</a> and <a href="gemdos_file.html#CDROMEJECT">CDROMEJECT</a> are avaiable both under
MiNT/MultiTOS as well as under MagiC.
<br>&nbsp;
<br>(1): Unfortunately there were collisions between MagiC and the
Minix-XFS for MiNT. Hence MagiC as of Version 6 contains new codes,
though the old ones are still supported. The new codes have 0x6d in
the upper WORD; this ID is reserved for MagiC.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The return value depends on the desired operation and the
underlying file-system. With a value &gt;= 0 everything was
successful. An exception is the value for DEV_INSTALL, which either
points to an information structure of the kernel, or else has the
value 0.
<br>&nbsp;
<br>For an invalid opcode, <a href="gemdos_errors.html#EINVFN">EINVFN</a> will be returned.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Available when a 'MiNT' cookie with a version of at least 0.90
exists, and <a href="magic.html">MagiC</a> as of Version 3.0.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dcntl">Binding</a> &nbsp; <a href="magic_xfs.html">XFS-concept in MagiC</a> &nbsp; <a href="xbios_interface.html#Bconmap">Bconmap</a> &nbsp; <a href="gemdos_file.html#Fcntl">Fcntl</a> &nbsp; <a href="magic.html">MagiC</a> &nbsp; <a href="xbios_drive.html#Metaioctl">Metaioctl</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dcntl">5.15.3.1 Bindings for Dcntl</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dcntl">Dcntl</a> ( int16_t cmd, int8_t *name, int32_t arg );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    arg,-(sp)    ; Offset 8
pea       name         ; Offset 4
move.w    cmd,-(sp)    ; Offset 2
move.w    #304,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $C(sp),sp    ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dcreate">5.15.4 Dcreate</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Create directory« - Create a directory.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 57
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dcreate ( CONST int8_t *path );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Dcreate creates a directory with the
pathname <i>path</i>, which has to be terminated with the ASCII
character 0, on the specified drive.
<br>&nbsp;
<br><b>Note:</b> Due to defective error-handling in GEMDOS Versions
&lt; 0.15, the file-system could be damaged in some circumstances.
Furthermore, no check was made whether a file with the specified name
already exists.
<br>&nbsp;
<br>Atari <a href="gemdos_main.html">GEMDOS</a> Reference Manual from April 4, 1986 warns about
passing paths ending with a trailing backslash and indeed, the
function fails at least on <a href="tos_main.html">TOS</a> 1.0x in such case with <a href="gemdos_errors.html#EPTHNF">EPTHNF</a>.
<br>&nbsp;
<br>As of <a href="magic.html">MagiC</a> 3, the call is passed on by the kernel as
<a href="magic_xfs.html#xfs_dcreate">xfs_dcreate</a> with creation mode <a href="gemdos_file.html#Fxattr">Fxattr</a> %0100000111101101 (i.e. a
'directory file' with access permissions RWXRwXRwX). The XFS should
not delete any files or subdirectories of the same name, but return
the error-code <a href="gemdos_errors.html#EACCDN">EACCDN</a> in this case. Invalid filenames &quot;.&quot; or
&quot;..&quot; must also be intercepted by the XFS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a></td>
<td valign="top"> No error has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EPTHNF">EPTHNF</a></td>
<td valign="top"> Directory not found
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EACCDN">EACCDN</a></td>
<td valign="top"> Access denied

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dcreate">Binding</a> &nbsp; <a href="#Ddelete">Ddelete</a> &nbsp; <a href="ascii.html">ASCII table</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dcreate">5.15.4.1 Bindings for Dcreate</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dcreate">Dcreate</a> ( CONST int8_t *path );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       path         ; Offset 2
move.w    #57,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top"> Fehler%=Gemdos(&amp;H39,L:path%)
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Ddelete">5.15.5 Ddelete</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Delete directory« - Delete a directory.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 58
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Ddelete ( CONST int8_t *path );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Ddelete deletes a directory with the
pathname <i>path</i>, which may not contain any files or
subdirectories. The string <i>path</i> must be terminated with the
ASCII character 0.
<br>&nbsp;
<br><b>Note:</b> In GEMDOS Versions &lt; 0.15 a call of <a href="#Dcreate">Dcreate</a>
with an immediately following Ddelete did not work - only a further
Ddelete achieved the desired result.
<br>&nbsp;
<br>In <a href="magic.html">MagiC</a> the kernel first checks whether the directory is a
current path and if appropriate returns an error-message. If possible,
only empty directories should be deleted; this is however up to the
XFS. As of MagiC Version 4.01, symbolic links too can be deleted with
this function; older versions always deleted the directory to which
the link pointed.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a></td>
<td valign="top"> No eror has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EPTHNF">EPTHNF</a></td>
<td valign="top"> Directory not found
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EACCDN">EACCDN</a></td>
<td valign="top"> Access denied
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EINTRN">EINTRN</a></td>
<td valign="top"> Internal error of the GEMDOS

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Ddelete">Binding</a> &nbsp; <a href="#Dcreate">Dcreate</a> &nbsp; <a href="magic_xfs.html">XFS-concept in MagiC</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Ddelete">5.15.5.1 Bindings for Ddelete</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Ddelete">Ddelete</a> ( CONST int8_t *path );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       path         ; Offset 2
move.w    #58,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top"> Fehler%=Gemdos(&amp;H3A,L:path%)
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Dfree">5.15.6 Dfree</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Free disk space« - Obtain free and total capacity of a
drive.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 54
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t Dfree ( <a href="gemdos_structures.html#DISKINFO">DISKINFO</a> *buf, int16_t driveno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Dfree obtains the capacity and current
occupancy of a drive. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">buf</td>
<td valign="top"> Address of the information buffer
</td></tr>

<tr><td nowrap="nowrap" valign="top">driveno</td>
<td valign="top">
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top"> Current drive
</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top"> Drive A:
</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top"> Drive B: (etc.)

</td></tr>
</table>


</td></tr>
</table>

<br><b>Note:</b> In GEMDOS Versions &lt; 0.15 this function is
unbelievably slow when used on a hard drive.
<br>&nbsp;
<br>Applied to the directory U:\PROC, from <a href="magic.html">MagiC</a> 3 onwards this
function returns the minimum, actual block length (as sectors per
cluster). Presently the memory is allocated word-wise, i.e. the
'sector size' is 1 int8_t and the cluster size comprises 2 sectors
(i.e. 2 int8_ts).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns a 0 for a correct execution, or a negative
number if an error arose.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dfree">Binding</a> &nbsp; <a href="gemdos_file.html#Fdelete">Fdelete</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dfree">5.15.6.1 Bindings for Dfree</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#Dfree">Dfree</a> ( <a href="gemdos_structures.html#DISKINFO">DISKINFO</a> *buf, int16_t driveno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    driveno,-(sp)  ; Offset 6
pea       buf            ; Offset 2
move.w    #54,-(sp)      ; Offset 0
trap      #1             ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #8,sp          ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top"> Fehler%=Gemdos(&amp;H36,L:buf%,W:driveno%)
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Dgetcwd">5.15.7 Dgetcwd</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dgetcwd« - Obtain the current directory of a process.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 315
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dgetcwd ( int8_t *path, int16_t drv, int16_t size );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The current working directory of the active process in drive
<i>drv</i> is returned. The parameter <i>size</i> gives the size of
the buffer for accommodating the name.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> <i>path</i>: Directory of the current process.
<br>&nbsp;
<br>The return value of the function is either 0 (all OK), <a href="gemdos_errors.html#ERANGE">ERANGE</a>
(the size of the buffer is insufficient to hold the exact description
of the directory), or <a href="gemdos_errors.html#EDRIVE">EDRIVE</a> (invalid GEMDOS ignore} drive).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Available when a 'MiNT' cookie with a version of at least 0.96
exists, and <a href="magic.html">MagiC</a> as of Version 3.0.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dgetcwd">Binding</a> &nbsp; <a href="#Dgetpath">Dgetpath</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dgetcwd">5.15.7.1 Bindings for Dgetcwd</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dgetcwd">Dgetcwd</a> ( int8_t *path, int16_t drv, int16_t size );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    size,-(sp)   ; Offset 8
move.w    drv,-(sp)    ; Offset 6
pea       path         ; Offset 2
move.w    #315,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $A(sp),sp    ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dgetdrv">5.15.8 Dgetdrv</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Disk get drive« - Obtain the current drive.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 25
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t Dgetdrv ( VOID );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Dgetdrv obtains the current drive.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns a number, which is coded as follows:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Value</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"> Drive A:
</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> Drive B:
</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"> Drive C:
</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top"> Drive D: (etc.)

</td></tr>
</table>

<br><b>Note:</b> As of MagiC 3, drives from A: to Z:, i.e. values
from 0 to 25, are permissible.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dgetdrv">Binding</a> &nbsp; <a href="#Dsetdrv">Dsetdrv</a> &nbsp; <a href="bios_sysvars.html#UDO__drvbits">_drvbits</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dgetdrv">5.15.8.1 Bindings for Dgetdrv</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#Dgetdrv">Dgetdrv</a> ( VOID );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    #25,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #2,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top"> Fehler%=Gemdos(&amp;H19)
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Dgetpath">5.15.9 Dgetpath</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Get path« - Obtain current path specification.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 71
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t Dgetpath ( int8_t *path, int16_t driveno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Dgetpath obtains the current directory on
the drive <i>driveno</i>. The designation of the drives are coded in
the parameter <i>driveno</i> as follows:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">driveno</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"> Current drive
</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> Drive A:
</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"> Drive B:
</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top"> Drive C: (etc.)

</td></tr>
</table>

<br>The path is stored in buffer <i>path</i> as a string. As the
maximum path length is not restricted in GEMDOS, and can be obtained
only with the existence of the function <a href="#Dpathconf">Dpathconf</a>, the receiving
buffer should offer sufficient space (256 bytes ought to be enough).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a></td>
  <td align="left" valign="top">:</td>
  <td align="left" valign="top">No eror has arisen</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="gemdos_errors.html#EDRIVE">EDRIVE</a></td>
  <td align="left" valign="top">:</td>
  <td align="left" valign="top">Invalid drive number</td>
</tr>
</table>
</div>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dgetpath">Binding</a> &nbsp; <a href="#Dsetpath">Dsetpath</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dgetpath">5.15.9.1 Bindings for Dgetpath</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#Dgetpath">Dgetpath</a> ( int8_t *path, int16_t driveno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    driveno,-(sp)  ; Offset 6
pea       path           ; Offset 2
move.w    #71,-(sp)      ; Offset 0
trap      #1             ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #8,sp          ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top"> Fehler%=Gemdos(&amp;H47,L;path%,W:driveno%)
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Dlock">5.15.10 Dlock</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dlock« - Lock a BIOS device or releases it again.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 309
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dlock ( int16_t mode, int16_t drv );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Dlock permits the locking of the BIOS device
<i>drv</i>, or releasing it again. On a locked drive no GEMDOS file
operations are permitted; <a href="About_the_BIOS.html#Rwabs">Rwabs</a> is only allowed for the locking
process.
<br>&nbsp;
<br>The purpose of the function is to allow low-level programs (such
as those for formatting) to perform (X)BIOS functions, while the
device remains locked for normal file accesses.
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="right" valign="top">Bit 0 of <i>mode</i> = 1:</td>
  <td align="left" valign="top">Lock device</td>
</tr>
<tr>
  <td align="right" valign="top">= 0:</td>
  <td align="left" valign="top">Release device</td>
</tr>
</table>
</div>

<br>If a process is terminated that still holds a lock on a device,
then this lock will be lifted.
<br>&nbsp;
<br>Bit 1 of <i>mode</i> indicates which return values are desired.
If this bit is set, and the corresponding device is already locked by
another process (or if another process has opened files on this
device), then this process' ID will be returned. This permits more
meaningful error-messages to the user, as one can now disclose which
process is using the device if the locking should go wrong.
<br>&nbsp;
<br>All other bits of <i>mode</i> are reserved and must be set to
0.
<br>&nbsp;
<br>Locking of a device with immediately following release of the
same is very similar to a media change. One should merely note that it
is not possible to lock if files are still open on the specified
device.
<br>&nbsp;
<br><b>Note for <a href="magic.html">MagiC</a>:</b> Before locking of the drive, provided a
file-system exists for the drive, the caches will be written back via
the vector <a href="magic_xfs.html#xfs_sync">xfs_sync</a>. Then the kernel inquires via <a href="magic_xfs.html#xfs_drv_close">xfs_drv_close</a>
whether the drive may be locked. If so, the XFS releases its
structures and then signals the kernel that it too can release its
structures for the drive, and perform the lock.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following values:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a> :</td>
<td valign="top"> No error has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EACCDN">EACCDN</a> :</td>
<td valign="top"> Device could not be locked, as open files or directories exist
on it
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EDRIVE">EDRIVE</a> :</td>
<td valign="top"> <i>drv</i> is not a valid BIOS device
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ELOCKED">ELOCKED</a> :</td>
<td valign="top"> Device is already locked by another process
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ENSLOCK">ENSLOCK</a> :</td>
<td valign="top"> Device has been released already

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Available when a 'MiNT' cookie with a version of at least 0.93
exists, and <a href="magic.html">MagiC</a> as of Version 3.0.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dlock">Binding</a> &nbsp; <a href="gemdos_file.html#Fxattr">Fxattr</a> &nbsp; <a href="magic_xfs.html">XFS-concept in MagiC</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dlock">5.15.10.1 Bindings for Dlock</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dlock">Dlock</a> ( int16_t mode, int16_t drv );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    drv,-(sp)    ; Offset 4
move.w    mode,-(sp)   ; Offset 2
move.w    #309,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dopendir">5.15.11 Dopendir</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dopendir« - Open a specified directory for reading.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 296
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dopendir ( int8_t *name, int16_t flag );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Dopendir opens the directory <i>name</i> for
reading. <i>name</i> should be NULL-terminated and should not contain
a trailing backslash. The parameter <i>flag</i> describes the manner
in which the directory is to be opened:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">flag</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"> <b>Normal mode</b>
<br>In this mode an attempt is made not to restrict the length of the
filename. Also, <a href="#Dreaddir">Dreaddir</a> in this mode return an index number (similar
to the UNIX inode's) in the first 4 bytes of the filename.
</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> <b>Compatibility mode</b>
<br>In this mode file-systems behave as if <a href="gemdos_file.html#Fsfirst">Fsfirst</a> or <a href="gemdos_file.html#Fsnext">Fsnext</a> calls
were being used. In particular, filenames will be truncated according
to the DOS-convention to 8+3 characters, if that is possible.

</td></tr>
</table>

<br>Newer programs should always use the normal mode if possible, in
order to exploit the full functionaity.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns a 32-bit directory handle if successful;
this may also be negative, but in no case may contain the value 0xff
in the higher byte, through which it can be differentiated from
errors.
<br>&nbsp;
<br>In case of error, the following returns are possible:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EPTHNF">EPTHNF</a> :</td>
<td valign="top"> <i>name</i> is not a valid directory
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EACCDN">EACCDN</a> :</td>
<td valign="top"> The directory is not addressable by this program
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ENSMEM">ENSMEM</a> :</td>
<td valign="top"> The kernel cannot allocate memory for this operation

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Available when a 'MiNT' cookie with a version of at least 0.90
exists, and in <a href="magic.html">MagiC</a> as of Version 3.0.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dopendir">Binding</a> &nbsp; <a href="#Dclosedir">Dclosedir</a> &nbsp; <a href="#Dreaddir">Dreaddir</a> &nbsp; <a href="#Drewinddir">Drewinddir</a> &nbsp; <a href="gemdos_process.html#Pdomain">Pdomain</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dopendir">5.15.11.1 Bindings for Dopendir</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dopendir">Dopendir</a> ( int8_t *name, int16_t flag );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    flag,-(sp)   ; Offset 6
pea       name         ; Offset 2
move.w    #296,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #8,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dpathconf">5.15.12 Dpathconf</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dpathconf« - Obtain information about a file-system.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 292
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dpathconf ( BYTE *name, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Dpathconf makes it possible to obtain information
about the file-system that contains the file <i>name</i>.
<br>&nbsp;
<br>The parameter <i>mode</i> specifies which possibilities or
restrictions of the file-systems are to be inquired. Possible values
here are:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top"> Meaning
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">-1:</td>
<td valign="top"> Maximum permissible value for Dpathconf itself
<br>&nbsp;
<a name="DP_IOPEN"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_IOPEN (0):</td>
<td valign="top"> Maximum number of opened files
<br>&nbsp;
<a name="DP_MAXLINKS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_MAXLINKS (1):</td>
<td valign="top"> Maximum number of references (links) to a file
<br>&nbsp;
<a name="DP_PATHMAX"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_PATHMAX (2):</td>
<td valign="top"> Maximum length of the full pathname
<br>&nbsp;
<a name="DP_NAMEMAX"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_NAMEMAX (3):</td>
<td valign="top"> Maximum length of a filename
<br>&nbsp;
<a name="DP_ATOMIC"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_ATOMIC (4):</td>
<td valign="top"> Number of bytes that may be written at a time per write
operation
<br>&nbsp;
<a name="DP_TRUNC"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_TRUNC (5):</td>
<td valign="top"> <b>Information about truncation of filenames:</b>
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top"> Filenames are not truncated; if the maximum filename length is
exceeded at a system call, the value <a href="gemdos_errors.html#ERANGE">ERANGE</a> will be returned
</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top"> Filenames are truncated automatically to the maximum possible
length
</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top"> Filenames are truncated according to the DOS convention (i.e. 8
characters for the name, 3 characters for the extension)

</td></tr>
</table>

<a name="DP_CASE"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_CASE (6):</td>
<td valign="top"> <b>Information about case sensitivity:</b>
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top"> Differentiation between capitals and lower case (file-system is
case-sensitive)
</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top"> No differentiation between capitals and lower case (all
characters are converted to either capitals or lower case -
file-system is not case-sensitive)
</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top"> No differentiation between capitals and lower case; however the
file-system saves the path and filenames with the original values
<br>Example: The displayed file 'HelloWorld' can also be accessed
with 'HELLOWorld' or 'HeLLoWORLD'

</td></tr>
</table>

<a name="UDO__25dpthconf_7"></a>
<a name="DP_MODEATTR"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_MODEATTR (7):</td>
<td valign="top"> <b>Information about mode-bits of a file:</b>
<br>&nbsp;
<br>This mode returns information about the validity of the values
defined in the <i>mode</i> and <i>attr</i> fields of the <a href="gemdos_structures.html#XATTR">XATTR</a>
structure. The bits 0..5 describe which flags of the component
<i>attr</i> are valid. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">FA_RDONLY (0x01):</td>
<td valign="top"> Is set only if the read permission is controlled via this bit,
and <i>not</i> when it is emulated via the meaning of the mode-bits
</td></tr>

<tr><td nowrap="nowrap" valign="top">FA_<a href="aes_fundamentals.html#HIDDEN">HIDDEN</a> (0x02):</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">FA_SYSTEM (0x04):</td>
<td valign="top"> Is set if the file-system supports these specific attributes
(normally only the case for DOS file-systems)
</td></tr>

<tr><td nowrap="nowrap" valign="top">FA_LABEL (0x08):</td>
<td valign="top"> Is set if the file-system label can be obtained with
<a href="gemdos_file.html#Fsfirst">Fsfirst</a>/<a href="gemdos_file.html#Fsnext">Fsnext</a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">FA_DIR (0x10):</td>
<td valign="top"> Reserved; to decide whether one is dealing with a folder on the
file-system, one should fall back to the filetype bits (see below)
</td></tr>

<tr><td nowrap="nowrap" valign="top">FA_CHANGED (0x20):</td>
<td valign="top"> Is set if the file-system knows the concept of archive bits,
and the <i>attr</i> field is used for this purpose

</td></tr>
</table>

<br>The bits 6 and 7 are reserved. The bits 8..19 store information
about whether the lower 12 bits of the <i>mode</i> component are
valid. The bits 20..27 describe which filetypes are supported by the
file-system. The following applies:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">DP_FT_DIR (0x00100000L):</td>
<td valign="top"> Folder
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_FT_CHR (0x00200000L):</td>
<td valign="top"> Special character-files
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_FT_BLK (0x00400000L):</td>
<td valign="top"> Special block-files (unused at present)
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_FT_REG (0x00800000L):</td>
<td valign="top"> Regular files
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_FT_LNK (0x01000000L):</td>
<td valign="top"> Symbolic links
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_FT_SOCK (0x02000000L):</td>
<td valign="top"> Sockets (unused at present)
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_FT_FIFO (0x04000000L):</td>
<td valign="top"> <a href="magic_driveu.html#Pipes">Pipes</a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_FT_MEM (0x08000000L):</td>
<td valign="top"> <a href="magic_driveu.html#Shared_20memory">Shared memory</a> or process files

</td></tr>
</table>

<br>The bits 28..31 are reserved.
<br>&nbsp;
<a name="UDO__25dpthconf_8"></a>
<a name="DP_XATTRFIELDS"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_XATTRFIELDS (8):</td>
<td valign="top"> <b>Information about extended attributes:</b>
<br>&nbsp;
<br>In this mode a bit-mask of the supported fields (specified in
the <a href="gemdos_structures.html#XATTR">XATTR</a> structure) is returned. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">DP_INDEX</td>
<td valign="top"> (0x0001): Unambiguous index field for each file on the
file-system
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_DEV</td>
<td valign="top"> (0x0002): Device number
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_RDEV</td>
<td valign="top"> (0x0004): <i>rdev</i> field valid, and <b>not</b> identical
to the <i>dev</i> field
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_NLINK</td>
<td valign="top"> (0x0008): Number of links
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_UID</td>
<td valign="top"> (0x0010): User number
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_GID</td>
<td valign="top"> (0x0020): Group number
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_BLKSIZE</td>
<td valign="top"> (0x0040): Block size
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_SIZE</td>
<td valign="top"> (0x0080): File length
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_NBLOCKS</td>
<td valign="top"> (0x0100): Number of blocks
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_ATIME</td>
<td valign="top"> (0x0200): Time of last access
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_CTIME</td>
<td valign="top"> (0x0400): Time of file creation
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_MTIME</td>
<td valign="top"> (0x0800): Time of last change

</td></tr>
</table>

<br>All other bits are reserved for future purposes.
<br>&nbsp;
<a name="DP_VOLNAMEMAX"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">DP_VOLNAMEMAX (9):</td>
<td valign="top"> Maximum length of a volume name (0 if volume names not
supported)
<br>&nbsp;

</td></tr>
</table>

<br>A return value of 0x7fffffff (2^31 -1) means that there is no
limit for the component inquired about.
<br>&nbsp;
<br><b>Note:</b> In <a href="magic.html">MagiC</a> the function can also be applied to
<i>files</i>. However the filename is ignored in this case, i.e. only
the path will be evaluated. The function should be called in MagiC
after <a href="#Dopendir">Dopendir</a> if necessary, as Dpathconf does not recognise disk
changes (reason: if the path is still in the cache, <i>no</i> disk
access is performed and hence no disk change is recognised).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the properties/limitations of the
file-system paying regard to the parameter <i>mode</i> (see above).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> As of the first in MultiTOS integrated MiNT version 1.04, and
in MagiC as of Version 3.0.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dpathconf">Binding</a> &nbsp; <a href="gemdos_system.html#Sysconf">Sysconf</a> &nbsp; <a href="magic_xfs.html">XFS-concept in MagiC</a> &nbsp; <a href="gemdos_pipes.html">Test for pipes</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dpathconf">5.15.12.1 Bindings for Dpathconf</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dpathconf">Dpathconf</a> ( BYTE *name, int16_t mode );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    mode,-(sp)   ; Offset 6
pea       name         ; Offset 2
move.w    #292,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #8,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dreaddir">5.15.13 Dreaddir</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dreaddir« - Read directory information.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 297
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dreaddir ( int16_t len, int32_t dirhandle, int8_t *buf
);
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Dreaddir returns the next file in the directory
<i>dirhandle</i>. The filename and an optional 4-byte index for the
file are written to <i>buf</i>.
<br>&nbsp;
<br>The file index is omitted if the directory was opened im
compatibility mode, otherwise it appears as the first in <i>buf</i>
followed by a (NULL-terminated) filename.
<br>&nbsp;
<br>(Possibly different) names with the same index belong to the
same file. (Possibly same) names with different indexes belong to
different files.
<br>&nbsp;
<br><b>Note about MagiC:</b> For FAT file-systems the function
returns the following index data:
<br>&nbsp;
<ul>
<li> Directories: Start cluster in Motorola format
</li>
<li> Other files:
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">High word =</td>
<td valign="top"> Start cluster of the directory
</td></tr>

<tr><td nowrap="nowrap" valign="top">Low word =</td>
<td valign="top"> Position within the directory &gt;&gt; 5

</td></tr>
</table>

</li>
</ul>

<br>This procedure is similar to that used by Linux and Solaris. The
drawback is that files alter their index during a move.
<br>&nbsp;
<br>In <i>len</i> the size of the receiving buffers has to be
specified.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a> :</td>
<td valign="top"> No error has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ENMFIL">ENMFIL</a> :</td>
<td valign="top"> No further files present
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ERANGE">ERANGE</a> :</td>
<td valign="top"> The buffer length is insufficient

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Available when a 'MiNT' cookie with a version of at least 0.90
exists, and in <a href="magic.html">MagiC</a> as of Version 3.0.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dreaddir">Binding</a> &nbsp; <a href="#Dclosedir">Dclosedir</a> &nbsp; <a href="#Dopendir">Dopendir</a> &nbsp; <a href="#Drewinddir">Drewinddir</a> &nbsp; <a href="#Dxreaddir">Dxreaddir</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dreaddir">5.15.13.1 Bindings for Dreaddir</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dreaddir">Dreaddir</a> ( int16_t len, int32_t dirhandle, int8_t *buf
);
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       buf          ; Offset 8
move.l    dirhandle    ; Offset 4
move.w    len          ; Offset 2
move.w    #297,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $C(sp),sp    ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dreadlabel">5.15.14 Dreadlabel</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dreadlabel« - Read file-system label.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 338 (0x0152)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dreadlabel ( CONST int8_t *path, int8_t *label, int16_t
length );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Dreadlabel returns in <i>label</i> the name of
the file-system lying in <i>path</i>. The parameter <i>length</i>
specifies the size of the receiving buffer for <i>label</i>.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a> :</td>
<td valign="top"> No eror has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ENAMETOOLONG">ENAMETOOLONG</a> :</td>
<td valign="top"> The name of the file-system is longer than the size of the
receiving buffer

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> In MagiC as of Version 3.0, from MiNT 1.12 onwards.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dreadlabel">Binding</a> &nbsp; <a href="#Dwritelabel">Dwritelabel</a> &nbsp; <a href="magic_xfs.html#XFS-concept_20in_20MagiC">XFS-concept in MagiC</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dreadlabel">5.15.14.1 Bindings for Dreadlabel</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dreadlabel">Dreadlabel</a> ( CONST int8_t *path, int8_t *label, int16_t
length );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    length,-(sp)  ; Offset 10
pea       label         ; Offset  6
pea       path          ; Offset  2
move.w    #338,-(sp)    ; Offset  0
trap      #1            ; <a href="gemdos_main.html">GEMDOS</a>
lea       $C(sp),sp     ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Drewinddir">5.15.15 Drewinddir</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Drewinddir« - Rewind the pointer for the specified directory
to the first file.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 298
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Drewinddir ( int32_t handle );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Drewinddir resets the directory <i>handle</i> to
the start, so that the next call of Dreaddir reads the first entry in
the directory once more.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a> :</td>
<td valign="top"> No error has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EINVFN">EINVFN</a> :</td>
<td valign="top"> Directory cannot be rewound
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EBADF">EBADF</a> :</td>
<td valign="top"> The directory <i>handle</i> is not open

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Available when a 'MiNT' cookie with a version of at least 0.90
exists, and in <a href="magic.html">MagiC</a> as of Version 3.0.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Drewinddir">Binding</a> &nbsp; <a href="#Dopendir">Dopendir</a> &nbsp; <a href="#Dreaddir">Dreaddir</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Drewinddir">5.15.15.1 Bindings for Drewinddir</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Drewinddir">Drewinddir</a> ( int32_t handle );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    handle,-(sp)  ; Offset 2
move.w    #298,-(sp)    ; Offset 0
trap      #1            ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #6,sp         ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dsetdrv">5.15.16 Dsetdrv</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Disk set drive« - Set the current drive and returns a
bit-map of mounted drives.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 14
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dsetdrv ( int16_t drv );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Dsetdrv makes the drive <i>drv</i> the
current default drive. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">drv</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"> Drive A:
</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> Drive B:
</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"> Drive C: (etc.)

</td></tr>
</table>

<br><b>Note:</b> An incorrect drive number can lead to serious
damage in GEMDOS-internal structures. The drives supported by GEMDOS
are best interrogated as follows:
<br>&nbsp;
<pre>Dsetdrv (<a href="#Dgetdrv">Dgetdrv</a> ());
</pre>
<br>As of MagiC 3, drives from A to Z, i.e. values from 0 to 25 are
permissible. No check is made whether the specified drive even exists.
<br>&nbsp;
<br>GEMDOS 0.30 (TOS 4.00-4.04) returns erroneous EDRIVEs for
drives above P:!
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> <b>Return value:</b> The function returns a bit-table with all
mounted drives. Each mounted drive is shown as one set bit.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dsetdrv">Binding</a> &nbsp; <a href="#Dgetdrv">Dgetdrv</a> &nbsp; <a href="bios_sysvars.html#UDO__drvbits">_drvbits</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dsetdrv">5.15.16.1 Bindings for Dsetdrv</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dsetdrv">Dsetdrv</a> ( int16_t drv );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    drv,-(sp)    ; Offset 2
move.w    #14,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #4,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top"> Fehler%=Gemdos(&amp;H0E,W:drv%)
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Dsetkey">5.15.17 Dsetkey</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Set key« - Set the key/passphrase for a drive.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 333 (0x014d)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dsetkey ( int32_t hidev, int32_t lowdev, int8_t *key,
int16_t cipher );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Dsetkey set the key/passphrase for the drive
specified by <i>hidev</i> and <i>lowdev</i>. Drive will be
deferenced if it is an alias.
<br>&nbsp;
<br>The parameter <i>key</i> is a pointer to the new passhrase; if
this is an empty string, ciphering will be disabled for the drive; if
it is a NULL pointer, the function checks the current ciphering mode.
<br>&nbsp;
<br>The parameter <i>cipher</i> specifies the cipher type to use.
Currently, only zero (Blowfish) is supported. Other values are
reserved for future expansion.
<br>&nbsp;
<br>As changing the key directly influences data access, the drive
is <a href="#Dlock">Dlock</a>()ed during this process to prevent data loss.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> If <i>key</i> is NULL, the function returns 0 if ciphering is
disabled on dev, or any other value if ciphering is enabled.
<br>&nbsp;
<br>If <i>key</i> is not NULL, the following return values are
possible:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a></td>
<td valign="top"> No error has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EDRIVE">EDRIVE</a></td>
<td valign="top"> Drive is invalid
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EINVAL">EINVAL</a></td>
<td valign="top"> Cipher is invalid
</td></tr>

<tr><td nowrap="nowrap" valign="top">Otherwise</td>
<td valign="top"> Any <a href="gemdos_main.html">GEMDOS</a> error code returned by <a href="#Dlock">Dlock</a>()

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> This function is available as of FreeMiNT 1.15.4.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dsetkey">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dsetkey">5.15.17.1 Bindings for Dsetkey</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dsetkey">Dsetkey</a> ( int32_t hidev, int32_t lowdev, int8_t *key,
int16_t cipher );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    cipher,-(sp) ; Offset 14
pea       key          ; Offset 10
move.l    lowdev,-(sp) ; Offset 6
move.l    hidev,-(sp)  ; Offset 2
move.w    #333,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       16(sp),sp    ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top"> Fehler%=Gemdos(&amp;H14D,L:hidev%,L:lowdev%,L:key%,W:cipher%)
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Dsetpath">5.15.18 Dsetpath</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Set path« - Set the current directory.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 59
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int16_t Dsetpath ( CONST int8_t *path );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The GEMDOS routine Dsetpath sets a new access path for the
current drive. The parameter <i>path</i> contains the new current
access path for the drive.
<br>&nbsp;
<br><b>Note:</b> For each drive, GEMDOS will remember the current
directory. However, the function Dsetpath should be used only for the
current drive. For other drives the following method should be applied
instead:
<br>&nbsp;
<ul>
<li> Establish current drive
</li>
<li> Set desired drive
</li>
<li> Set path for this drive
</li>
<li> Make the old (remembered) drive the current one again
</li>
</ul>

<br>On some (older) versions of GEMDOS, a too frequent setting of
non-existing paths can lead to disturbance in the internal structures.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a></td>
<td valign="top"> No eror has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EPTHNF">EPTHNF</a></td>
<td valign="top"> Directory not found

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dsetpath">Binding</a> &nbsp; <a href="#Dgetpath">Dgetpath</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dsetpath">5.15.18.1 Bindings for Dsetpath</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int16_t <a href="#Dsetpath">Dsetpath</a> ( CONST int8_t *path );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       path         ; Offset 2
move.w    #59,-(sp)    ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top"> Fehler%=Gemdos(&amp;H3B,L:path%)
<br>&nbsp;

</td></tr>
</table>

<h3><a name="Dwritelabel">5.15.19 Dwritelabel</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dwritelabel« - Set file-system label.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 339 (0x0153)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dwritelabel ( CONST int8_t *path, CONST int8_t *label
);
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Dwritelabel writes the name specified in
<i>label</i> to the file-system specified in <i>path</i>.
<br>&nbsp;
<br>Prior to MiNT version 1.14.5 this call contained a bug that
allowed the label to be changed by all users.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> <a href="gemdos_errors.html#E_OK">E_OK</a> if successful, else a negative GEMDOS error-code.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> MagiC as of Version 3.0, MiNT 1.12
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dwritelabel">Binding</a> &nbsp; <a href="#Dreadlabel">Dreadlabel</a> &nbsp; <a href="magic_xfs.html">XFS-concept in MagiC</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dwritelabel">5.15.19.1 Bindings for Dwritelabel</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dwritelabel">Dwritelabel</a> ( CONST int8_t *path, CONST int8_t *label
);
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       label        ; Offset 6
pea       path         ; Offset 2
move.w    #339,-(sp)   ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $A(sp),sp    ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dxopendir">5.15.20 Dxopendir</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dxopendir« - Open directory for reading.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 1296
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dxopendir ( int8_t *name, int16_t flag );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Dxopendir calls the normal <a href="#Dopendir">Dopendir</a>, but then saves the
returned handle and flag in a chained list, so that <a href="#Dreaddir">Dreaddir</a> and
<a href="#Dxreaddir">Dxreaddir</a> know what they have to convert for this directory.
Dcloseddir deletes the handle again from the list.
<br>&nbsp;
<br>Dreaddir and Dxreaddir convert the returned name to lower case.
<br>&nbsp;
<br>The function opens the directory <i>name</i> for reading. The
parameter <i>flag</i> describes the manner how the directory is to be
opened:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">flag</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"> <b>Normal mode</b>
<br>In this mode an attempt is made not to restrict the length of the
filename. Also, <a href="#Dreaddir">Dreaddir</a> in this mode return an index number (similar
to the UNIX inode's) in the first 4 bytes of the filename.
</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> <b>Compatibility mode</b>
<br>In this mode file-systems behave as if <a href="gemdos_file.html#Fsfirst">Fsfirst</a> or <a href="gemdos_file.html#Fsnext">Fsnext</a> calls
were being used. In particular, filenames will be truncated according
to the DOS-convention to 8+3 characters, if that is possible.

</td></tr>
</table>

<br>Newer programs should always use the normal mode if possible, in
order to exploit the full functionaity.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns a 32-bit directory handle if successful;
this may also be negative, but in no case may contain the value 0xff
in the higher byte, through which it can be differentiated from
errors.
<br>&nbsp;
<br>In case of error, the following returns are possible:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EPTHNF">EPTHNF</a> :</td>
<td valign="top"> <i>name</i> is not a valid directory
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#EACCDN">EACCDN</a> :</td>
<td valign="top"> The directory is not addressable by this program
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ENSMEM">ENSMEM</a> :</td>
<td valign="top"> The kernel cannot allocate memory for this operation

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> When the system extension Dir_Lwr (supplied with Égale 4.2) is
<a href="xbios_sound.html#installed">installed</a>. Creates the cookie 'DYDL'.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dxopendir">Binding</a> &nbsp; <a href="#Dclosedir">Dclosedir</a> &nbsp; <a href="#Dreaddir">Dreaddir</a> &nbsp; <a href="#Drewinddir">Drewinddir</a> &nbsp; <a href="gemdos_process.html#Pdomain">Pdomain</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dxopendir">5.15.20.1 Bindings for Dxopendir</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dxopendir">Dxopendir</a> ( int8_t *name, int16_t flag );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    flag,-(sp)   ; Offset 6
pea       name         ; Offset 2
move.w    #1296,-(sp)  ; Offset 0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
addq.l    #8,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dxreaddir">5.15.21 Dxreaddir</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dxreaddir« - Read directory information, obtain attributes.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 322, (0x142)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Dxreaddir ( int16_t ln, int32_t dirh, int8_t *buf,
<a href="gemdos_structures.html#XATTR">XATTR</a> *xattr, int32_t *xr );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The function Dxreaddir returns the next file from the directory
with the handle <i>dirh</i>. The filename and the optional 4 byte
long file index are stored in the buffer specified in <i>buf</i>.
<br>&nbsp;
<br>The file index is omitted if the compatibility mode was
specified for <a href="#Dopendir">Dopendir</a>. If two filenames have the same index, they
represent the same file.
<br>&nbsp;
<br>MagiC returns for FAT file-systems the following index data:
<br>&nbsp;
<ul>
<li> Directories: Start cluster in Motorola format
</li>
<li> Other files:
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">High word =</td>
<td valign="top"> Start cluster of the directory
</td></tr>

<tr><td nowrap="nowrap" valign="top">Low word =</td>
<td valign="top"> Position within the directory &gt;&gt; 5

</td></tr>
</table>

</li>
</ul>

<br>This procedure is similar to that used by Linux and Solaris. The
drawback is that files alter their index during a move.
<br>&nbsp;
<br>The parameter <i>ln</i> specifies the length of the receiving
buffer <i>buf</i>. The extended file attributes are stored similarly
to <a href="gemdos_file.html#Fxattr">Fxattr</a> in the <i>xattr</i> structure, where symbolic links are not
dissolved.
<br>&nbsp;
<br><b>Note:</b> This part of the call may fail even though the
filename was readable. In that case a separate return code will be
stored in the LONG value to which the parameter <i>xr</i> points.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#E_OK">E_OK</a> :</td>
<td valign="top"> No error has arisen
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ENMFIL">ENMFIL</a> :</td>
<td valign="top"> No further files found
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="gemdos_errors.html#ERANGE">ERANGE</a> :</td>
<td valign="top"> The receiving buffer is not large enoough

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> MagiC as of Version 3.0, MiNT 1.11 onwards.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Directory_20functions">Directory functions</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dxreaddir">Binding</a> &nbsp; <a href="#Dreaddir">Dreaddir</a> &nbsp; <a href="#Dopendir">Dopendir</a> &nbsp; <a href="#Dclosedir">Dclosedir</a> &nbsp; <a href="#Drewinddir">Drewinddir</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dxreaddir">5.15.21.1 Bindings for Dxreaddir</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="#Dxreaddir">Dxreaddir</a> ( int16_t ln, int32_t dirh, int8_t *buf,
<a href="gemdos_structures.html#XATTR">XATTR</a> *xattr, int32_t *xr );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       xr           ; Offset 16
pea       xattr        ; Offset 12
pea       buf          ; Offset  8
move.l    dirh         ; Offset  4
move.w    ln           ; Offset  2
move.w    #322,-(sp)   ; Offset  0
trap      #1           ; <a href="gemdos_main.html">GEMDOS</a>
lea       $14(sp),sp   ; Correct stack
</pre>

</td></tr>
</table>

<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="gemdos_main.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24">GEMDOS</a>
<a name="UDO_nav_lf_FOOT" href="gemdos_system.html"><img src="udo_lf.gif" alt="System functions" title="System functions" border="0" width="24" height="24">System functions</a>
<a name="UDO_nav_rg_FOOT" href="gemdos_chrinout.html"><img src="udo_rg.gif" alt="Character input/output" title="Character input/output" border="0" width="24" height="24">Character input/output</a>
</body>
</html>
