<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 2025/12/20 -->
<html lang="en">
<head>
<title>
The documentation for TOS: Memory-Control-Block (MCB) in MagiC
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="typedefs.html"><img src="udo_up.gif" alt="Type definitions" title="Type definitions" border="0" width="24" height="24">Type definitions</a>
<a name="UDO_nav_lf_HEAD" href="MacVersion.html"><img src="udo_lf.gif" alt="MacVersion" title="MacVersion" border="0" width="24" height="24">MacVersion</a>
<a name="UDO_nav_rg_HEAD" href="MD.html"><img src="udo_rg.gif" alt="Memory Descriptor (MD) in TOS" title="Memory Descriptor (MD) in TOS" border="0" width="24" height="24">Memory Descriptor (MD) in TOS</a>

<hr>

<h1><a name="Memory-Control-Block_20_28MCB_29_20in_20MagiC">I.10 Memory-Control-Block (MCB) in MagiC</a></h1>
<a name="Memory_20management_20in_20MagiC"></a>
<a name="MagiC_2C_20Memory_20management_20in"></a>
<a name="MCB"></a>
<pre>typedef struct
{
    int32_t mcb_magic;        /* 'ANDR' or 'KROM' (last)       */
    int32_t mcb_len;          /* Nett length                   */
    int32_t mcb_owner;        /* Pointer to <a href="gemdos_structures.html#PD">PD</a> structure       */
    int32_t mcb_prev;         /* Previous block, or NULL       */
    int8_t mcb_data[0];
} MCB;
</pre>
<p><b>Note:</b> The component <i>mcb_magic</i> has the value
'KROM' if no futher MCB follows, else the value 'ANDR'. In the latter
case the next MCB lies <i>mcb_len</i> bytes behind the currrent MCB.
The list is chained backwards with <i>mcb_prev</i> which considerably
speeds up many operations.
</p>
<p>With all memory operations the component <i>mcb_magic</i> is
always checked, and if an error is found the system is halted
immediately. For a halt due to a memory error the address of the
faulty MCB as well as the data (4 LONGwords) are output. Subsequently
one is asked on which
</p>
<a name="Core_20dump"></a>
<p>drive one would like a <b>core dump</b> to be saved. If one
specifies a valid drive, then the whole ST memory from 0 to <a href="bios_sysvars.html#phystop">phystop</a> is
written to the root directory of the specified drive, and is assigned
the
</p>
<a name="Core_20dump_2C_20Name_20for"></a>
<p>name '_sys_'. The file, depending on the ST model, can be up to
4 or even 16 MB long, of course.
</p>
<p>Memory-resident programs (terminating themselves with <a href="gemdos_process.html#Ptermres">Ptermres</a>)
now work - unlike earlier - in a way that the blocks are <i>not</i>
released, all MCBs remain <a href="xbios_sound.html#intact">intact</a> and continue to be used (each time
one clicks in the menu-bar the free memory is output, for which the
whole list is run through once and during this all MCBs are checked).
Those who wish to do so can therefore release memory-resident programs
(or also parts of them) subsequently.
</p>
<p>See also: <a href="gemdos_main.html">GEMDOS</a> &nbsp; <a href="magic.html">MagiC</a> &nbsp; <a href="MD.html">MD</a> &nbsp; <a href="gemdos_memory.html">Memory management</a>
</p>
<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="typedefs.html"><img src="udo_up.gif" alt="Type definitions" title="Type definitions" border="0" width="24" height="24">Type definitions</a>
<a name="UDO_nav_lf_FOOT" href="MacVersion.html"><img src="udo_lf.gif" alt="MacVersion" title="MacVersion" border="0" width="24" height="24">MacVersion</a>
<a name="UDO_nav_rg_FOOT" href="MD.html"><img src="udo_rg.gif" alt="Memory Descriptor (MD) in TOS" title="Memory Descriptor (MD) in TOS" border="0" width="24" height="24">Memory Descriptor (MD) in TOS</a>
</body>
</html>
