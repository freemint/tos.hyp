<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 2025/08/02 -->
<html lang="en">
<head>
<title>
The documentation for TOS: Hatari DHS XBIOS extension
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="xbios_main.html"><img src="udo_up.gif" alt="XBIOS" title="XBIOS" border="0" width="24" height="24">XBIOS</a>
<a name="UDO_nav_lf_HEAD" href="xbios_dsp56001.html"><img src="udo_lf.gif" alt="DSP programming" title="DSP programming" border="0" width="24" height="24">DSP programming</a>
<a name="UDO_nav_rg_HEAD" href="xbios_interrupt.html"><img src="udo_rg.gif" alt="Interrupt functions" title="Interrupt functions" border="0" width="24" height="24">Interrupt functions</a>

<hr>

<h1><a name="Hatari_20DHS_20XBIOS_20extension">4.12 Hatari DHS XBIOS extension</a></h1>
<p>Some specific patches by DHS are applied to the Hatari sources
for Mac OS X to enhance the debug and trace functions. These features
are of great help for demo hacking in overscan since ordinary debug
tools is very hard to use in such conditions.
</p>
<p>Binaries and patches are available on <a href="https://dhs.nu/hatari/">DHS website</a>.
</p>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#CounterRead">CounterRead</a>&nbsp;</td>
<td valign="top"> Stop a cycle counter.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#CounterStart">CounterStart</a></td>
<td valign="top"> Start or restart a cycle counter.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#CPUFreq">CPUFreq</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Set Hatari CPU frequency.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Debug">Debug</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Debug output to console.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#DebugUI">DebugUI</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Enter Hatari debug UI.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#HatariOption">HatariOption</a></td>
<td valign="top"> Change emulator options.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Registers">Registers</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Dump all registers to console.

</td></tr>
</table>

<h3><a name="CounterRead">4.12.1 CounterRead</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Stop counter« - Read a cycle counter.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 252 (0x00fc)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> See <a href="#Bindings_20for_20CounterRead">Bindings for CounterRead</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Stop a cycle counter.
<br>&nbsp;
<br>The <i>id</i> argument to the call can provide an identifier
for the current timer and several counters can be activated
simulaneously. Valid values are between 0 and 255.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> None.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Hatari for Mac OS X with specific patches by DHS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Hatari_20DHS_20XBIOS_20extension">Hatari DHS XBIOS extension</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20CounterRead">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20CounterRead">4.12.1.1 Bindings for CounterRead</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void <a href="xbios_trap.html#xbios">xbios</a> ( 252, int16_t id );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    id,-(sp)        ; Offset 2
move.w    #252,-(sp)      ; Offset 0
trap      #14             ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #4,sp           ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="CounterStart">4.12.2 CounterStart</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Start counter« - Start or restart a cycle counter.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 253 (0x00fd)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> See <a href="#Bindings_20for_20CounterStart">Bindings for CounterStart</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Start a new cycle counter or restart an existing one.
<br>&nbsp;
<br>Count the number of cycles between two successive calls to <a href="xbios_main.html">XBIOS</a>
functions.
<br>&nbsp;
<br>The <i>id</i> argument to the call can provide an identifier
for the current timer and several counters can be activated
simulaneously. Valid values are between 0 and 255.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> None.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Hatari for Mac OS X with specific patches by DHS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Hatari_20DHS_20XBIOS_20extension">Hatari DHS XBIOS extension</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20CounterStart">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20CounterStart">4.12.2.1 Bindings for CounterStart</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void <a href="xbios_trap.html#xbios">xbios</a> ( 253, int16_t id );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    id,-(sp)        ; Offset 2
move.w    #253,-(sp)      ; Offset 0
trap      #14             ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #4,sp           ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="CPUFreq">4.12.3 CPUFreq</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Set Frequency« - Set Hatari CPU frequency.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 249 (0x00f9)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> See <a href="#Bindings_20for_20CPUFreq">Bindings for CPUFreq</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Set Hatari CPU frequency.
<br>&nbsp;
<br>Maximum <i>frequency</i> is 511 MHz. The frequency can be set
up to 128 MHz in the SDL and the OSX GUI.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> None.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Hatari for Mac OS X with specific patches by DHS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Hatari_20DHS_20XBIOS_20extension">Hatari DHS XBIOS extension</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20CPUFreq">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20CPUFreq">4.12.3.1 Bindings for CPUFreq</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void <a href="xbios_trap.html#xbios">xbios</a> ( 249, int16_t frequency );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    frequency,-(sp) ; Offset 2
move.w    #249,-(sp)      ; Offset 0
trap      #14             ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #4,sp           ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Debug">4.12.4 Debug</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Debug output to console« - Dump memory area to Hatari
console.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 254 (0x00fe)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> See <a href="#Bindings_20for_20Debug">Bindings for Debug</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Memory dump.
<br>&nbsp;
<br>Hatari can dump the content of a memory area to the console.
This is useful for debugging.
<br>&nbsp;
<br><i>memptr</i> and <i>length</i> specifiy the start address and
length of the area. Maximum length is 256 bytes.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> None.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Hatari for Mac OS X with specific patches by DHS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Hatari_20DHS_20XBIOS_20extension">Hatari DHS XBIOS extension</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Debug">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Debug">4.12.4.1 Bindings for Debug</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void <a href="xbios_trap.html#xbios">xbios</a> ( 254, int32_t memptr, int32_t length );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    length,-(sp)    ; Offset 6
move.l    memptr,-(sp)    ; Offset 2
move.w    #254,-(sp)      ; Offset 0
trap      #14             ; Call <a href="xbios_main.html">XBIOS</a>
lea       10(sp),sp       ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="DebugUI">4.12.5 DebugUI</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Enter Debug UI« - Enter Hatari Debug UI.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 251 (0x00fb)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> See bindings for <a href="#Debug">Debug</a> UI
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Debugger with instruction stepping.
<br>&nbsp;
<br>Step through the code from the OSX console. By calling <a href="xbios_main.html">XBIOS</a>,
Hatari will enter the debugger. A new command <i>i</i> will then step
the emulator one (1) instruction and then return to the debugger.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> None.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Hatari for Mac OS X with specific patches by DHS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Hatari_20DHS_20XBIOS_20extension">Hatari DHS XBIOS extension</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20DebugUI">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20DebugUI">4.12.5.1 Bindings for DebugUI</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void <a href="xbios_trap.html#xbios">xbios</a> ( 251 );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    #251,-(sp)      ; Offset 0
trap      #14             ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #2,sp           ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="HatariOption">4.12.6 HatariOption</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Change options« - Change emulator options.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 255
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> See <a href="#Bindings_20for_20HatariOption">Bindings for HatariOption</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> This function changes the given <i>option</i>. The following
apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Option</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> Reset the normal ST speed (disable Fast Forward).
</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"> Set Hatari into max speed mode (enable Fast Forward). Useful
for assembling, packing and so on.
</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top"> Enable debugger.
</td></tr>

<tr><td nowrap="nowrap" valign="top">4</td>
<td valign="top"> Disable debugger.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns 0, or -1 if the specified option is out of
range.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Hatari for Mac OS X with specific patches by DHS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Hatari_20DHS_20XBIOS_20extension">Hatari DHS XBIOS extension</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20HatariOption">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20HatariOption">4.12.6.1 Bindings for HatariOption</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> int32_t <a href="xbios_trap.html#xbios">xbios</a> ( 255, int16_t option );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    option,-(sp)    ; Offset 2
move.w    #255,-(sp)      ; Offset 0
trap      #14             ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #4,sp           ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Registers">4.12.7 Registers</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dump Registers« - Dump all registers to console.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 250 (0x00fa)
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> See <a href="#Bindings_20for_20Registers">Bindings for Registers</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> Dump all registers to console.
<br>&nbsp;
<br>Hatari can dump the CPU data+address registers to the console.
This is useful for debugging.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> None.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> Hatari for Mac OS X with specific patches by DHS.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Hatari_20DHS_20XBIOS_20extension">Hatari DHS XBIOS extension</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Registers">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Registers">4.12.7.1 Bindings for Registers</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> void <a href="xbios_trap.html#xbios">xbios</a> ( 250 );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    #250,-(sp)      ; Offset 0
trap      #14             ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #2,sp           ; Correct stack
</pre>

</td></tr>
</table>

<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="xbios_main.html"><img src="udo_up.gif" alt="XBIOS" title="XBIOS" border="0" width="24" height="24">XBIOS</a>
<a name="UDO_nav_lf_FOOT" href="xbios_dsp56001.html"><img src="udo_lf.gif" alt="DSP programming" title="DSP programming" border="0" width="24" height="24">DSP programming</a>
<a name="UDO_nav_rg_FOOT" href="xbios_interrupt.html"><img src="udo_rg.gif" alt="Interrupt functions" title="Interrupt functions" border="0" width="24" height="24">Interrupt functions</a>
</body>
</html>
