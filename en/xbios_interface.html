<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- last modified on 2025/08/02 -->
<html lang="en">
<head>
<title>
The documentation for TOS: Interface programming
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO Version 7.12 (1248) for Linux">
</head>
<body style="position: relative;">

<a name="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_HEAD" href="xbios_main.html"><img src="udo_up.gif" alt="XBIOS" title="XBIOS" border="0" width="24" height="24">XBIOS</a>
<a name="UDO_nav_lf_HEAD" href="PCI_BIOS.html"><img src="udo_lf.gif" alt="PCI-BIOS" title="PCI-BIOS" border="0" width="24" height="24">PCI-BIOS</a>
<a name="UDO_nav_rg_HEAD" href="xbios_sound.html"><img src="udo_rg.gif" alt="Sound routines" title="Sound routines" border="0" width="24" height="24">Sound routines</a>

<hr>

<h1><a name="Interface_20programming">4.18 Interface programming</a></h1>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Bconmap">Bconmap</a></td>
<td valign="top"> Selects a serial port.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Dosound">Dosound</a></td>
<td valign="top"> Programs sound generator.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#ExtRsConf">ExtRsConf</a></td>
<td valign="top"> Configures the RS-232/RS-485 port.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Giaccess">Giaccess</a></td>
<td valign="top"> Reads from and writes to the GI sound chip.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Ikbdws">Ikbdws</a></td>
<td valign="top"> Programs the keyboard chip.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Iorec">Iorec</a></td>
<td valign="top"> Obtains address of the input/output buffer of RS-232, keyboard
chip or MIDI port serial device.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Kbdvbase">Kbdvbase</a></td>
<td valign="top"> Obtains buffer and interrupt vectors for mouse, MIDI and
intelligent keyboard.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Mfpint">Mfpint</a></td>
<td valign="top"> Initializes the multi-function peripheral chip interrupt.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Midiws">Midiws</a></td>
<td valign="top"> Writes string of characters to the MIDI port.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Offgibit">Offgibit</a></td>
<td valign="top"> Clears a bit in port A register of the GI sound chip.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Ongibit">Ongibit</a></td>
<td valign="top"> Sets a bit in port A register of the GI sound chip.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&#x2022; <a href="#Rsconf">Rsconf</a></td>
<td valign="top"> Configures the RS-232 port.

</td></tr>
</table>

<p>See also: <a href="xbios_interrupt.html">Interrupt functions</a>
</p>
<h3><a name="Bconmap">4.18.1 Bconmap</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Select serial port« - Select a default port.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 44
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Bconmap( int16_t devno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Bconmap selects one of the serial ports for
Bios output. In addition one can inquire for a pointer to the <a href="xbios_structures.html#BCONMAP">BCONMAP</a>
structure, with which one can query for the highest BIOS device
number and also install new device drivers. <i>devno</i> can assume
the following values:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="right" valign="top">devno</td>
  <td align="left" valign="top">Meaning</td>
</tr>
<tr>
  <td align="right" valign="top">-402</td>
  <td align="left" valign="top">Remove device / RSVF list (HSMODA)</td>
</tr>
<tr>
  <td align="right" valign="top">-401</td>
  <td align="left" valign="top">Append entry  (HSMODA)</td>
</tr>
<tr>
  <td align="right" valign="top">-400</td>
  <td align="left" valign="top">Overwrite selected entry (HSMODA)</td>
</tr>
<tr>
  <td align="right" valign="top">-2</td>
  <td align="left" valign="top">Return pointer to <a href="xbios_structures.html#BCONMAP">BCONMAP</a> structure</td>
</tr>
<tr>
  <td align="right" valign="top">-1</td>
  <td align="left" valign="top">Only inquire current channel</td>
</tr>
<tr>
  <td align="right" valign="top">0</td>
  <td align="left" valign="top">Test whether Bconmap is present</td>
</tr>
<tr>
  <td align="right" valign="top">6</td>
  <td align="left" valign="top">ST-compatible RS-232 port (U:\dev\modem1)</td>
</tr>
<tr>
  <td align="right" valign="top">7</td>
  <td align="left" valign="top">SCC Channel B  (U:\dev\modem2)</td>
</tr>
<tr>
  <td align="right" valign="top">8</td>
  <td align="left" valign="top">TTMFP RS-232 port (U:\dev\serial1)</td>
</tr>
<tr>
  <td align="right" valign="top">9</td>
  <td align="left" valign="top">SCC Channel A (U:\dev\serial2)</td>
</tr>
<tr>
  <td align="right" valign="top">&gt;10</td>
  <td align="left" valign="top">Own driver</td>
</tr>
</table>
</div>

<br>The function affects both the BIOS vector table in the <a href="bios_sysvars.html">system variables</a>,
as well as the behaviour of the functions Rsconf and Iorec.
<br>&nbsp;
<br><b>Note:</b> In <a href="tos_main.html">TOS</a> 4.04, and when no TT-MFP is present, SCC
Channel A will be device #8.
<br>&nbsp;
<br><b>HSMODA</b>
<br>These functions are only present if the HSMODA package is installed.
<br>&nbsp;
<br><u>int32_t Bconmap((int16_t)-400, (int16_t)dev_nr,
(int32_t)ptr_to_6_longs)</u>
<br>The constant MAPT_OVE is defined as -400. This function serves for
overwriting already existing <a href="xbios_structures.html#MAPTAB">MAPTAB</a> entries. <i>dev_nr</i> is a
device number from 6 upwards that already has to exist in <a href="xbios_structures.html#MAPTAB">MAPTAB</a>,
otherwise the error-code -15 <a href="bios_errors.html#EUNDEV">EUNDEV</a> will be returned.
<i>ptr_to_6_longs</i> points to a structure that corresponds to a
<a href="xbios_structures.html#MAPTAB">MAPTAB</a> entry. This structure will be copied to the corresponding place
in the <a href="xbios_structures.html#MAPTAB">MAPTAB</a>. If the addressed device is the one currently set by
Bconmap for AUX, then the newly hooked-in routines will also be copied
to xco* and into the current <a href="#Rsconf">Rsconf</a> and <a href="#Iorec">Iorec</a> cells. This function
serves only for hooking in <a href="magic.html">MagiC</a>-friendly routines. If successful, the
device number to which the entry refers will be returned, i.e.
<i>dev_nr.</i>
<br>&nbsp;
<br>To install devices on the BIOS numbers that are permanently
assigned to a computer, one should always use MAPT_OVE. For the ST
this pertains for instance to number 6, for a MegaSTE to numbers 6 to
8 and for a TT030 to numbers 6 to 9.
<br>&nbsp;
<br><u>int32_t Bconmap((int16_t)-401, (int32_t)ptr_to_6_longs)</u>
<br>The constant MAPT_APP is defined as -401. This function serves for
appending a channel to the <a href="xbios_structures.html#MAPTAB">MAPTAB</a> or for writing to an empty channel.
<i>ptr_to_6_longs</i> points to a structure that corresponds to a
<a href="xbios_structures.html#MAPTAB">MAPTAB</a> entry. The return is either the channel number selected by this
function for the entry, or the error-code -12 <a href="bios_errors.html#EGENRL">EGENRL</a> if there is no
room for a <a href="xbios_structures.html#MAPTAB">MAPTAB</a> augmentation. Here it cannot happen that the vectors
are transferred immediately to xco*, as a previously absent channel,
or one in use, can not have been set as AUX.
<br>&nbsp;
<br>MAPT_APP searches for the first free channel after those BIOS
numbers that are permanently assigned to a computer and can therefore
only be used for installing additional devices.
<br>&nbsp;
<br><u>int32_t Bconmap((int16_t)-402, (int16_t) dev_nr,
(int32_t)ptr_to_listentry)</u>
<br>The constant MAPT_DEL is defined as -402. This function serves for
deleting a device from the <a href="xbios_structures.html#MAPTAB">MAPTAB</a> and for unhooking a RSVF list from
the RSVF daisy chain.
<br>&nbsp;
<br><i>dev_nr</i> is either the BIOS channel number of the device
to be removed from the <a href="xbios_structures.html#MAPTAB">MAPTAB</a>, or -1 for doing nothing. The
corresponding <a href="xbios_structures.html#MAPTAB">MAPTAB</a> entry is cleared by entering special
dummy-routine pointers that point to the assembler command RTS. The
<a href="#Iorec">Iorec</a> pointer entry is set to 0. If the deleted channel was also set
as the BIOS AUX device, then BIOS AUX will be reset as number 6,
even if number 6 has just been deleted.
<br>&nbsp;
<br><i>ptr_to_listentry</i> is either the pointer to the RSVF list
to be unhooked, or 0 for doing nothing. The pointer must refer to the
start of a list, which is then removed completely, even if it contains
more than one interface object and end or daisy-chain object.
<br>&nbsp;
<br>MAPT_DEL returns 1 if successful, or -1 in case of error.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> Bconmap returns the old setting. If <i>devno</i> equals -2,
then the function returns a pointer to <a href="xbios_structures.html#BCONMAP">BCONMAP</a>.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> According to Atari one should test one's TOS version for the
presence of Bconmap in the following manner:
<br>&nbsp;
<pre>WORD has_bconmap ( VOID )
{
   return (0L == Bconmap (0));
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Bconmap">Binding</a> &nbsp; <a href="About_the_BIOS.html#Bconout">Bconout</a> &nbsp; <a href="About_the_BIOS.html#Bconin">Bconin</a> &nbsp; <a href="About_the_BIOS.html#Bcostat">Bcostat</a> &nbsp; <a href="About_the_BIOS.html#Bconstat">Bconstat</a> &nbsp; <a href="#Iorec">Iorec</a> &nbsp; <a href="#Rsconf">Rsconf</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Bconmap">4.18.1.1 Bindings for Bconmap</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>int32_t <a href="#Bconmap">Bconmap</a>( int16_t devno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    devno,-(sp)  ; Offset 2
move.w    #44,-(sp)    ; Offset 0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #4,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Dosound">4.18.2 Dosound</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Dosound« - Program the sound generator (PSG).
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 32
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void *Dosound( const int8_t *buf );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Dosound starts a process for control of the
programmable sound generator. The buffer <i>buf</i> holds commands
for the programming of the sound generator. The following commands are
supported:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Command</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0x0x byte</td>
<td valign="top"> Write byte into register x of the sound chip
</td></tr>

<tr><td nowrap="nowrap" valign="top">0x80 byte</td>
<td valign="top"> Load bytes into temporary register for use by command 0x81
</td></tr>

<tr><td nowrap="nowrap" valign="top">0x81 byte1</td>
<td valign="top"> Number of the sound register into which the value of the
temporary register is to be transferred.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;&nbsp; byte2</td>
<td valign="top"> Signed value to be added to the temporary register until value
in third byte is met.
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;&nbsp;&nbsp;&nbsp; byte3</td>
<td valign="top"> Value of the temporary register at which the loop is
terminated.
</td></tr>

<tr><td nowrap="nowrap" valign="top">0x82 byte</td>
<td valign="top"> The number of 50 Hz ticks (20 ms) to wait for the next command.
If the byte holds the value 0 the processing is terminated.
</td></tr>

<tr><td nowrap="nowrap" valign="top">...</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">0xff byte</td>
<td valign="top"> &nbsp;

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the previous playing sound buffer, if any.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Dosound">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Dosound">4.18.2.1 Bindings for Dosound</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>void <a href="#Dosound">Dosound</a>( const int8_t *buf );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       buf          ; Offset 2
move.w    #32,-(sp)    ; Offset 0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #6,sp        ; Correct stack
move.l    d0,a0
</pre>

</td></tr>
</table>

<h3><a name="ExtRsConf">4.18.3 ExtRsConf</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »RS-232/RS485 configuration« - Configure the
RS-232/RS-485-port.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 162
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Xbios( 162, int16_t command, int16_t device, int32_t
param );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine ExtRsConf configures the serial port.
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Parameter</td>
  <td align="left" valign="top">Meaning</td>
</tr>
<tr>
  <td align="left" valign="top">command</td>
  <td align="left" valign="top">0x0000 - Return 0 to check that ExtRsConf</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is present</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">0x0001 - Set port driver mode:</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param = 0 -&gt; RS232</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param = 1 -&gt; RS422</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param = 2 -&gt; RS485</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">device</td>
  <td align="left" valign="top">BIOS device (6 = MFP serial, ...)</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">param</td>
  <td align="left" valign="top">See above.</td>
</tr>
</table>
</div>

<br><b>Note:</b> The function is only for the hardware of the Milan
2.1. However, it only exists as a special version and is not freely
available.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> <a href="gemdos_errors.html#E_OK">E_OK</a> (0) - OK
<br><a href="bios_errors.html#EUNCMD">EUNCMD</a> (-3) - Unknown command
<br><a href="bios_errors.html#ERROR">ERROR</a> (-1) - General error
<br><a href="bios_errors.html#EUNDEV">EUNDEV</a> (-15) - Unknown device
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> The function is present as of the MilanTOS dated 2002-06-09.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20ExtRsConf">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20ExtRsConf">4.18.3.1 Bindings for ExtRsConf</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>int32_t Xbios( 162, int16_t command, int16_t device, int32_t
param );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.l    param,-(sp)     ; Offset  6
move.w    device,-(sp)    ; Offset  4
move.w    command,-(sp)   ; Offset  2
move.w    #162,-(sp)      ; Offset  0
trap      #14             ; Call <a href="xbios_main.html">XBIOS</a>
lea       10(sp),sp       ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Giaccess">4.18.4 Giaccess</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »access GI sound chip« - Permit access to the registers of
the GI sound chip.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 28
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int8_t Giaccess( int16_t data, int16_t regno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Giaccess reads or sets the registers in the
GI sound chip. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">data</td>
<td valign="top"> Is written at a write access to the register specified in
<i>regno</i>
</td></tr>

<tr><td nowrap="nowrap" valign="top">regno</td>
<td valign="top"> Number of the desired register (0..15). At write accesses bit 7
is also set.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the contents of the specified register.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Giaccess">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Giaccess">4.18.4.1 Bindings for Giaccess</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>int8_t <a href="#Giaccess">Giaccess</a>( int16_t data, int16_t regno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    regno,-(sp)  ; Offset 4
move.w    data,-(sp)   ; Offset 2
move.w    #28,-(sp)    ; Offset 0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #6,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Ikbdws">4.18.5 Ikbdws</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »write string to keyboard« - Program the keyboard chip.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 25
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void Ikbdws( int16_t count, const int8_t *ptr );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Ikbdws passes a string to the intelligent
keyboard controller. The following apply:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Parameter</td>
  <td align="left" valign="top">Meaning</td>
</tr>
<tr>
  <td align="left" valign="top">count</td>
  <td align="left" valign="top">Number of bytes to be output - 1</td>
</tr>
<tr>
  <td align="left" valign="top">ptr</td>
  <td align="left" valign="top">Pointer to the bytes in memory</td>
</tr>
</table>
</div>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function does not return a result.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Ikbdws">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Ikbdws">4.18.5.1 Bindings for Ikbdws</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>void <a href="#Ikbdws">Ikbdws</a>( int16_t count, const int8_t *ptr );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       ptr          ; Offset 4
move.w    count,-(sp)  ; Offset 2
move.w    #25,-(sp)    ; Offset 0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #8,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Iorec">4.18.6 Iorec</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »input output record« - Obtain address of the input/ output
buffer of a serial device.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 14
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> <a href="xbios_structures.html#IOREC">IOREC</a> *Iorec( int16_t dev );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Iorec returns the address of the
input/output buffer of a serial device (RS-232, keyboard chip or MIDI
port). The parameter <i>dev</i> can take the following values:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="center" valign="top">dev</td>
  <td align="left" valign="top">Meaning</td>
</tr>
<tr>
  <td align="center" valign="top">0</td>
  <td align="left" valign="top">RS-232</td>
</tr>
<tr>
  <td align="center" valign="top">1</td>
  <td align="left" valign="top">Keyboard</td>
</tr>
<tr>
  <td align="center" valign="top">2</td>
  <td align="left" valign="top">MIDI</td>
</tr>
</table>
</div>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns a pointer to the <a href="xbios_structures.html#IOREC">IOREC</a> array.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Iorec">Binding</a> &nbsp; <a href="#Bconmap">Bconmap</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Iorec">4.18.6.1 Bindings for Iorec</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br><a href="xbios_structures.html#IOREC">IOREC</a> *<a href="#Iorec">Iorec</a>( int16_t dev );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    dev,-(sp)    ; Offset 2
move.w    #14,-(sp)    ; Offset 0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #4,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Kbdvbase">4.18.7 Kbdvbase</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »keyboard vectors« - Return a pointer to the IKBD
(intelligent keyboard), and MIDI interrupt vectors.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 34
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> <a href="xbios_structures.html#KBDVBASE">KBDVBASE</a> *Kbdvbase( void );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Kbdvbase returns a pointer to a <a href="xbios_structures.html#KBDVBASE">KBDVBASE</a>
structure contaning a 'jump' table to system vector handlers.
<br>&nbsp;
<br><b>Note:</b> Before one of the vectors specified in the
structure is altered, one must ensure that a packet is not currently
being sent (element <i>drvstat</i> = 0). Subsequently all interrupts
should be blocked and a test performed to check that there really is
no packet on the way.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns a pointer to a <a href="xbios_structures.html#KBDVBASE">KBDVBASE</a> structure.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Kbdvbase">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Kbdvbase">4.18.7.1 Bindings for Kbdvbase</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br><a href="xbios_structures.html#KBDVBASE">KBDVBASE</a> *<a href="#Kbdvbase">Kbdvbase</a>( void );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    #34,-(sp)    ; Offset 0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #2,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Mfpint">4.18.8 Mfpint</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »init MFP interrupt« - Initialize the multi-function
peripheral chip interrupt.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 13
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void Mfpint( int16_t number, int16_t (*vector)() );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Mfpint initializes the multi-function chip
interrupt for the connected peripheral devices. This permits hardware
interrupts being intercepted. The argument <i>vector</i> specifies
the interrupt service routine. The parameter <i>number</i> gives the
number of the interrupt from 0 to 15:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="center" valign="top">number</td>
  <td align="left" valign="top">Description</td>
</tr>
<tr>
  <td align="center" valign="top">0</td>
  <td align="left" valign="top">I/O port bit 0 busy parallel port</td>
</tr>
<tr>
  <td align="center" valign="top">1</td>
  <td align="left" valign="top">RS-232 DCD</td>
</tr>
<tr>
  <td align="center" valign="top">2</td>
  <td align="left" valign="top">RS-232 CTS</td>
</tr>
<tr>
  <td align="center" valign="top">3</td>
  <td align="left" valign="top">Blitter</td>
</tr>
<tr>
  <td align="center" valign="top">4</td>
  <td align="left" valign="top">Timer D, RS-232 Baud rate generator</td>
</tr>
<tr>
  <td align="center" valign="top">5</td>
  <td align="left" valign="top">Timer C, 200-Hz system clock</td>
</tr>
<tr>
  <td align="center" valign="top">6</td>
  <td align="left" valign="top">Keyboard and MIDI</td>
</tr>
<tr>
  <td align="center" valign="top">7</td>
  <td align="left" valign="top">FDC and DMA</td>
</tr>
<tr>
  <td align="center" valign="top">8</td>
  <td align="left" valign="top">Timer B horizontal blank</td>
</tr>
<tr>
  <td align="center" valign="top">9</td>
  <td align="left" valign="top">RS-232 transmit error</td>
</tr>
<tr>
  <td align="center" valign="top">10</td>
  <td align="left" valign="top">RS-232 transmit buffer empty</td>
</tr>
<tr>
  <td align="center" valign="top">11</td>
  <td align="left" valign="top">RS-232 receive buffer full</td>
</tr>
<tr>
  <td align="center" valign="top">12</td>
  <td align="left" valign="top">RS-232 buffer full</td>
</tr>
<tr>
  <td align="center" valign="top">13</td>
  <td align="left" valign="top">Timer A (DMA sound)</td>
</tr>
<tr>
  <td align="center" valign="top">14</td>
  <td align="left" valign="top">RS-232 RI</td>
</tr>
<tr>
  <td align="center" valign="top">15</td>
  <td align="left" valign="top">Mono monitor detect / DMA sound complete</td>
</tr>
</table>
</div>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function does not return a result.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Mfpint">Binding</a> &nbsp; <a href="xbios_interrupt.html#Jdisint">Jdisint</a> &nbsp; <a href="xbios_interrupt.html#Jenabint">Jenabint</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Mfpint">4.18.8.1 Bindings for Mfpint</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>void <a href="#Mfpint">Mfpint</a>( int16_t number, int16_t (*vector)() );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       vector       ; Offset 4
move.w    number,-(sp) ; Offset 2
move.w    #13,-(sp)    ; Offset 0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #8,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Midiws">4.18.9 Midiws</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »Midi write string« - Write string of characters to the MIDI
port.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 12
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void Midiws( int16_t cnt, void *ptr );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Midiws outputs a string from a data buffer
via the MIDI port. The following apply:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top"> Meaning
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">cnt</td>
<td valign="top"> Number of bytes to be output - 1
</td></tr>

<tr><td nowrap="nowrap" valign="top">ptr</td>
<td valign="top"> Pointer to byte string

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function does not return a result.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Midiws">Binding</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Midiws">4.18.9.1 Bindings for Midiws</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>void <a href="#Midiws">Midiws</a>( int16_t cnt, void *ptr );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>pea       ptr          ; Offset 4
move.w    cnt,-(sp)    ; Offset 2
move.w    #12,-(sp)    ; Offset 0
trap      #14          ; <a href="xbios_main.html">XBIOS</a> aufrufen
addq.l    #8,sp        ; Stack korrigieren
</pre>

</td></tr>
</table>

<h3><a name="Offgibit">4.18.10 Offgibit</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »GI bit off« - Clear individual bits in the port A register
of the GI sound chip.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 29
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void Offgibit( int16_t bitno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Offgibit clears a bit in register A of the
GI sound chip. <i>bitno</i> specifies the value with which the
register should be ANDed. The bits in this register have the following
meaning:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Bit</td>
<td valign="top"> Description
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0</td>
<td valign="top"> Floppy disk side select
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;1</td>
<td valign="top"> Select drive A:
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;2</td>
<td valign="top"> Select drive B:
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;3</td>
<td valign="top"> RS-232 RTS
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;4</td>
<td valign="top"> RS-232 DTR
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;5</td>
<td valign="top"> Centronics Strobe
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;6</td>
<td valign="top"> PIN 3 Monitor port
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;7</td>
<td valign="top"> Unused
<br>As of TOS030 of the TT, however Modem 4 (1) or LAN (0)

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function does not return a result.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Offgibit">Binding</a> &nbsp; <a href="#Ongibit">Ongibit</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Offgibit">4.18.10.1 Bindings for Offgibit</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>void <a href="#Offgibit">Offgibit</a>( int16_t bitno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    bitno,-(sp)  ; Offset 2
move.w    #29,-(sp)    ; Offset 0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #4,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Ongibit">4.18.11 Ongibit</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »GI bit on« - Set individual bits in the port A register of
the GI sound chip.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 30
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> void Ongibit( int16_t bitno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Ongibit sets a bit in register A of the GI
sound chip. <i>bitno</i> specifies the value with which the register
should be ORed. The bits in this register have the following meaning:
<br>&nbsp;
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Bit</td>
<td valign="top"> Description
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top"> &nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0</td>
<td valign="top"> Floppy disk side select
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;1</td>
<td valign="top"> Select drive A:
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;2</td>
<td valign="top"> Select drive B:
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;3</td>
<td valign="top"> RS-232 RTS
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;4</td>
<td valign="top"> RS-232 DTR
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;5</td>
<td valign="top"> Centronics strobe
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;6</td>
<td valign="top"> PIN 3 monitor port
</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;7</td>
<td valign="top"> Unused
<br>As of TOS030 of the TT, however Modem 4 (1) or LAN (0)

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function does not return a result.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Ongibit">Binding</a> &nbsp; <a href="#Offgibit">Offgibit</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Ongibit">4.18.11.1 Bindings for Ongibit</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>void <a href="#Ongibit">Ongibit</a>( int16_t bitno );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    bitno,-(sp)  ; Offset 2
move.w    #30,-(sp)    ; Offset 0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
addq.l    #4,sp        ; Correct stack
</pre>

</td></tr>
</table>

<h3><a name="Rsconf">4.18.12 Rsconf</a></h3>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top"> »RS-232 configuration« - Configure the RS-232 port.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top"> 15
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"> int32_t Rsconf( int16_t baud, int16_t ctr, int16_t ucr, int16_t
rsr, int16_t tsr, int16_t scr );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top"> The XBIOS routine Rsconf configures the serial port. Since
different hardware components may be in use with various computers,
the function has to be used with care, i.e.:
<br>&nbsp;
<ul>
<li> Current settings should be established with Rsconf
(-1,-1,-1,-1,-1,-1)
</li>
<li> Only manipulate the necessary bits
</li>
<li> Then set the new values.
</li>
</ul>

<br>Due to the possibility that various components may be in use,
the usable values have been restricted in the following way:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Parameter</td>
  <td align="left" valign="top">Restriction</td>
</tr>
<tr>
  <td align="left" valign="top">ucr</td>
  <td align="left" valign="top">Bit 1: <b>Type of parity</b></td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 = Odd</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 = Even</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;2: <b>Parity</b></td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 = No</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 = Yes</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;3+4: <b>Number of stop bits</b></td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 = Invalid</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 = 1 stop bit</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 = 1.5 stop bits</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3 = 2 stop bits</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;5+6: <b>Word length</b></td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 = 8 bits</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 = 7 bits</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 = 6 bits</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3 = 5 bits</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">rsr</td>
  <td align="left" valign="top">Not usable</td>
</tr>
<tr>
  <td align="left" valign="top">tsr</td>
  <td align="left" valign="top">Bit 3: (1 = Break)</td>
</tr>
<tr>
  <td align="left" valign="top">scr</td>
  <td align="left" valign="top">Not usable</td>
</tr>
</table>
</div>

<br>Technically impossible values must therefore be ignored.
Otherwise the following assignments apply:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Parameter</td>
  <td align="left" valign="top">Meaning</td>
</tr>
<tr>
  <td align="left" valign="top">baud</td>
  <td align="left" valign="top"><b>Baud rate</b></td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">-1: Don't change</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;0: 19200 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;1:  9600 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;2:  4800 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;3:  3600 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;4:  2400 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;5:  2000 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;6:  1800 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;7:  1200 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;8:   600 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;9:   300 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">10:   200 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">11:   150 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">12:   134 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">13:   110 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">14:    75 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">15:    50 Baud</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">ctr</td>
  <td align="left" valign="top"><b>Type of flow control</b></td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">-1: Don't change</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;0: No flow control [powerup default]</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;1: XON/XOFF (Control-S, Control-Q)</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;2: RTS/CTS</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;3: RTS/CTS and XON/XOFF</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">ucr</td>
  <td align="left" valign="top">New value for register, or -1</td>
</tr>
<tr>
  <td align="left" valign="top">tsr</td>
  <td align="left" valign="top">New value for register, or -1</td>
</tr>
<tr>
  <td align="left" valign="top">rsr</td>
  <td align="left" valign="top">New value for register, or -1</td>
</tr>
<tr>
  <td align="left" valign="top">scr</td>
  <td align="left" valign="top">New value for register, or -1</td>
</tr>
</table>
</div>

<br><b>Note:</b> As of TOS 1.04 the last Baud rate set can be
established with Rsconf (-2,-1,-1,-1,-1). One should never rely on the
fact that all the settings could actually be made as desired, and
hence pay close attention to the return value of the function.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns in packed form the values of the registers
<i>ucr,</i> <i>rsr,</i> <i>scr</i> and <i>tsr</i> as follows:
<br>&nbsp;
<br><br>
<div align="left"><table border="0" class="UDO_env_table">
<tr>
  <td align="left" valign="top">Bits</td>
  <td align="left" valign="top">0..7:</td>
  <td align="left" valign="top">scr register</td>
</tr>
<tr>
  <td align="left" valign="top">Bits</td>
  <td align="left" valign="top">8..15:</td>
  <td align="left" valign="top">tsr register</td>
</tr>
<tr>
  <td align="left" valign="top">Bits</td>
  <td align="left" valign="top">16..23:</td>
  <td align="left" valign="top">rsr register</td>
</tr>
<tr>
  <td align="left" valign="top">Bits</td>
  <td align="left" valign="top">24..31:</td>
  <td align="left" valign="top">ucr register</td>
</tr>
</table>
</div>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All TOS versions.
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"> <a href="#Interface_20programming">Interface programming</a>
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Rsconf">Binding</a> &nbsp; <a href="#Bconmap">Bconmap</a>
<br>&nbsp;

</td></tr>
</table>

<h4><a name="Bindings_20for_20Rsconf">4.18.12.1 Bindings for Rsconf</a></h4>
<table class="UDO_env_xlist">
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"> #include &lt;tos.h&gt;
<br>&nbsp;
<br>int32_t <a href="#Rsconf">Rsconf</a>( int16_t baud, int16_t ctr, int16_t ucr, int16_t
rsr, int16_t tsr, int16_t scr );
<br>&nbsp;
</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top">
<br>&nbsp;
<pre>move.w    scr,-(sp)    ; Offset 12
move.w    tsr,-(sp)    ; Offset 10
move.w    rsr,-(sp)    ; Offset  8
move.w    ucr,-(sp)    ; Offset  6
move.w    ctr,-(sp)    ; Offset  4
move.w    baud,-(sp)   ; Offset  2
move.w    #15,-(sp)    ; Offset  0
trap      #14          ; Call <a href="xbios_main.html">XBIOS</a>
lea       $E(sp),sp    ; Correct stack
</pre>

</td></tr>
</table>

<hr>

<a name="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a>
<a name="UDO_nav_up_FOOT" href="xbios_main.html"><img src="udo_up.gif" alt="XBIOS" title="XBIOS" border="0" width="24" height="24">XBIOS</a>
<a name="UDO_nav_lf_FOOT" href="PCI_BIOS.html"><img src="udo_lf.gif" alt="PCI-BIOS" title="PCI-BIOS" border="0" width="24" height="24">PCI-BIOS</a>
<a name="UDO_nav_rg_FOOT" href="xbios_sound.html"><img src="udo_rg.gif" alt="Sound routines" title="Sound routines" border="0" width="24" height="24">Sound routines</a>
</body>
</html>
